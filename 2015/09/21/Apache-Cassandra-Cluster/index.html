<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="Apache-Cassandra-Cluster">




  <meta name="keywords" content="cassandra,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2015/09/21/Apache-Cassandra-Cluster/">


<meta name="description" content="简介：Cassandra 是一个分布式的存储引擎，用来管理分布在大量普通商用级别服务器上面的海量的结构化数据，可以提供高可用性，不存在单点故障。Cassandra设计目标，是运行在千台规模的服务器节点上面，节点可以跨越IDC.在这个规模上，大小组件都会频繁的发生故障。当故障发生时，Cassandra通过对持久层状态的有效管理，来达成整个系统的可靠性和扩展性。在很多场合，Cassandra作为一个数">
<meta name="keywords" content="cassandra">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache-Cassandra-Cluster">
<meta property="og:url" content="http://itweet.github.io/2015/09/21/Apache-Cassandra-Cluster/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="简介：Cassandra 是一个分布式的存储引擎，用来管理分布在大量普通商用级别服务器上面的海量的结构化数据，可以提供高可用性，不存在单点故障。Cassandra设计目标，是运行在千台规模的服务器节点上面，节点可以跨越IDC.在这个规模上，大小组件都会频繁的发生故障。当故障发生时，Cassandra通过对持久层状态的有效管理，来达成整个系统的可靠性和扩展性。在很多场合，Cassandra作为一个数">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://www.itweet.github.io/screenshots/cassandra-mon.png">
<meta property="og:image" content="http://www.itweet.github.io/screenshots/cassandra-mon2.png">
<meta property="og:image" content="http://www.itweet.github.io/screenshots/cassandra-home.png">
<meta property="og:image" content="http://www.itweet.github.io/screenshots/cassandra-home1.png">
<meta property="og:image" content="http://www.itweet.github.io/screenshots/cassandra-hosts.png">
<meta property="og:updated_time" content="2019-12-25T14:39:06.103Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache-Cassandra-Cluster">
<meta name="twitter:description" content="简介：Cassandra 是一个分布式的存储引擎，用来管理分布在大量普通商用级别服务器上面的海量的结构化数据，可以提供高可用性，不存在单点故障。Cassandra设计目标，是运行在千台规模的服务器节点上面，节点可以跨越IDC.在这个规模上，大小组件都会频繁的发生故障。当故障发生时，Cassandra通过对持久层状态的有效管理，来达成整个系统的可靠性和扩展性。在很多场合，Cassandra作为一个数">
<meta name="twitter:image" content="http://www.itweet.github.io/screenshots/cassandra-mon.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b75d841b3068f7782eac9af2c8c866e7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154998721-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154998721-1');
</script>


    <title> Apache-Cassandra-Cluster - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Apache-Cassandra-Cluster
        
      </h1>

      <time class="post-time">
          9月 21 2015
      </time>
    </header>



    
            <div class="post-content">
            <h1 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h1><p>Cassandra 是一个分布式的存储引擎，用来管理分布在大量普通商用级别服务器上面的海量的结构化数据，可以提供高可用性，不存在单点故障。Cassandra设计目标，是运行在千台规模的服务器节点上面，节点可以跨越IDC.在这个规模上，大小组件都会频繁的发生故障。当故障发生时，Cassandra通过对持久层状态的有效管理，来达成整个系统的可靠性和扩展性。在很多场合，Cassandra作为一个数据库来使用，因此他借鉴了很多数据库的设计和实现策略，但是他不能支持完整的关系数据库模型；相反，他提供给客户端一个简单的数据模型，客户端可以通过这个模型，来动态控制数据的布局和格式。Cassandra系统设计成可以运行在大量廉价商用机上面，具备高写吞吐量的同时，不牺牲读性能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 特性</span><br><span class="line">  ● 分布式</span><br><span class="line">  ● 基于column的结构化</span><br><span class="line">  ● 高伸展性</span><br></pre></td></tr></table></figure>
<h1 id="get-cassandra-package"><a href="#get-cassandra-package" class="headerlink" title="get cassandra package"></a>get cassandra package</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ tar -zxvf /data/software/</span><br><span class="line">apache-cassandra-2.2.1-bin.tar.gz -C ./</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ ln -s apache-cassandra-2.2.1 cassandra</span><br></pre></td></tr></table></figure>
<h1 id="configing"><a href="#configing" class="headerlink" title="configing"></a>configing</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">----server1</span><br><span class="line">[whoami@server1 conf]$ tail -3 cassandra.yaml </span><br><span class="line">data_file_directories:</span><br><span class="line">        - /data/whoami/cassandra/data</span><br><span class="line">commitlog_directory: /data/whoami/cassandra/commitlog</span><br><span class="line">saved_caches_directory: /data/whoami/cassandra/saved_caches</span><br><span class="line"></span><br><span class="line">seed_provider:    </span><br><span class="line">    - class_name: org.apache.cassandra.locator.SimpleSeedProvider</span><br><span class="line">      parameters:</span><br><span class="line">          # seeds is actually a comma-delimited list of addresses.</span><br><span class="line">          # Ex: &quot;&lt;ip1&gt;,&lt;ip2&gt;,&lt;ip3&gt;&quot;</span><br><span class="line">          - seeds: &quot;server1&quot;</span><br><span class="line"></span><br><span class="line">listen_address: server1</span><br><span class="line"></span><br><span class="line">rpc_address: server1</span><br><span class="line"></span><br><span class="line">cluster_name: &apos;Test Cluster&apos;</span><br><span class="line"></span><br><span class="line">1、data_file_directories 可以一次同时设置几个不同目录，cassandra 会自动同步所有目录的数据。</span><br><span class="line">2、由于 Cassandra 采用去中心化结构，所以当集群里的一台机器（节点）启动之后需要一个途径通知当前集群（有新节点加入啦），Cassandra 的配置文件里有一个 seeds 的设置项，所谓的 seeds 就是能够联系集群中所有节点的一台计算机，假如集群中所有的节点位于同一个机房同一个子网，那么只要随意挑选几台比较稳定的计算机即可。在当前的例子中因为只有3台机器，所以我挑选第一台作为种子节点，配置如下：</span><br><span class="line">    seed_provider:</span><br><span class="line">    # Addresses of hosts that are deemed contact points. </span><br><span class="line">    # Cassandra nodes use this list of hosts to find each other and learn</span><br><span class="line">    # the topology of the ring.  You must change this if you are running</span><br><span class="line">    # multiple nodes!</span><br><span class="line">    - class_name: org.apache.cassandra.locator.SimpleSeedProvider</span><br><span class="line">      parameters:</span><br><span class="line">          # seeds is actually a comma-delimited list of addresses.</span><br><span class="line">          # Ex: &quot;&lt;ip1&gt;,&lt;ip2&gt;,&lt;ip3&gt;&quot;</span><br><span class="line">          - seeds: &quot;server1&quot;</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ scp -rq apache-cassandra-2.2.1 server2:/home/whoami/</span><br><span class="line">  </span><br><span class="line">配置好的 Cassandra 复制到第2和第3台机器，同时创建相关的目录，还需要修改</span><br><span class="line">listen_address 和 rpc_address 为实际机器的IP地址。至此所有的配置完成了。</span><br><span class="line"></span><br><span class="line">----server2</span><br><span class="line"></span><br><span class="line">cluster_name: &apos;mycluster&apos;</span><br><span class="line">seed_provider:    </span><br><span class="line">    - class_name: org.apache.cassandra.locator.SimpleSeedProvider</span><br><span class="line">      parameters:</span><br><span class="line">          # seeds is actually a comma-delimited list of addresses.</span><br><span class="line">          # Ex: &quot;&lt;ip1&gt;,&lt;ip2&gt;,&lt;ip3&gt;&quot;</span><br><span class="line">          - seeds: &quot;server1&quot;</span><br><span class="line">        </span><br><span class="line">listen_address: server2</span><br><span class="line">rpc_address: server2</span><br><span class="line"></span><br><span class="line">data_file_directories:</span><br><span class="line">        - /data/whoami/cassandra/data</span><br><span class="line">commitlog_directory: /data/whoami/cassandra/commitlog</span><br><span class="line">saved_caches_directory: /data/whoami/cassandra/saved_caches</span><br><span class="line"></span><br><span class="line">----server3,server4</span><br><span class="line">省略，参考server2</span><br></pre></td></tr></table></figure>
<h1 id="start-cassandra"><a href="#start-cassandra" class="headerlink" title="start cassandra"></a>start cassandra</h1><p>在相应的节点执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/cassandra -f or bin/cassandra</span><br></pre></td></tr></table></figure></p>
<p>参数 -f 的作用是让 Cassandra 以前端程序方式运行，这样有利于调试和观察日志信息，而在实际生产环境中这个参数是不需要的（即 Cassandra 会以 daemon 方式运行）。</p>
<p>所有节点启动后可以通过 bin/nodetool 工具管理集群，比如查看所有节点运行情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[whoami@server1 ~]$ cassandra/bin/nodetool status</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">=======================</span><br><span class="line">Status=Up/Down</span><br><span class="line">|/ State=Normal/Leaving/Joining/Moving</span><br><span class="line">--  Address          Load       Tokens       Owns    Host ID                               Rack</span><br><span class="line">UN  192.168.111.200  131.22 KB  256          ?       c88dce49-f6bc-43a4-adfb-597694faae9e  rack1</span><br><span class="line">UN  192.168.111.201  103.11 KB  256          ?       1cfc5153-f974-44b3-bb5e-b9a54759d023  rack1</span><br><span class="line"></span><br><span class="line">Note: Non-system keyspaces don&apos;t have the same replication settings, effective ownership information is meaningless</span><br></pre></td></tr></table></figure></p>
<h1 id="show-cluster-status"><a href="#show-cluster-status" class="headerlink" title="show cluster status"></a>show cluster status</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ cassandra/bin/nodetool status</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">=======================</span><br><span class="line">Status=Up/Down</span><br><span class="line">|/ State=Normal/Leaving/Joining/Moving</span><br><span class="line">--  Address          Load       Tokens       Owns    Host ID                               Rack</span><br><span class="line">UN  192.168.111.202  108.12 KB  256          ?       334d3c5f-3265-47da-adc0-d6b21a8d569c  rack1</span><br><span class="line">UN  192.168.111.203  14.39 KB   256          ?       9b67e6c0-0e6d-4787-9858-504765f97126  rack1</span><br><span class="line">UN  192.168.111.200  196.94 KB  256          ?       c88dce49-f6bc-43a4-adfb-597694faae9e  rack1</span><br><span class="line">UN  192.168.111.201  181.84 KB  256          ?       1cfc5153-f974-44b3-bb5e-b9a54759d023  rack1</span><br><span class="line"></span><br><span class="line">Note: Non-system keyspaces don&apos;t have the same replication settings, effective ownership information is meaningless</span><br></pre></td></tr></table></figure>
<h1 id="cfstats-查询各个CF详细的统计信息，包括写入次数，相响应时间，memtable信息等。"><a href="#cfstats-查询各个CF详细的统计信息，包括写入次数，相响应时间，memtable信息等。" class="headerlink" title="cfstats 查询各个CF详细的统计信息，包括写入次数，相响应时间，memtable信息等。"></a>cfstats 查询各个CF详细的统计信息，包括写入次数，相响应时间，memtable信息等。</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ cassandra/bin/nodetool -h localhost  cfstats       </span><br><span class="line">Keyspace: system_traces</span><br><span class="line">        Read Count: 0</span><br><span class="line">        Read Latency: NaN ms.</span><br><span class="line">        Write Count: 0</span><br><span class="line">        Write Latency: NaN ms.</span><br><span class="line">        Pending Flushes: 0</span><br></pre></td></tr></table></figure>
<h1 id="异常一个下线节点"><a href="#异常一个下线节点" class="headerlink" title="异常一个下线节点"></a>异常一个下线节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ cassandra/bin/nodetool -h localhost info</span><br><span class="line">ID                     : c88dce49-f6bc-43a4-adfb-597694faae9e</span><br><span class="line">Gossip active          : true</span><br><span class="line">Thrift active          : false</span><br><span class="line">Native Transport active: true</span><br><span class="line">Load                   : 196.94 KB</span><br><span class="line">Generation No          : 1442595318</span><br><span class="line">Uptime (seconds)       : 724</span><br><span class="line">Heap Memory (MB)       : 47.95 / 1198.00</span><br><span class="line">Off Heap Memory (MB)   : 0.00</span><br><span class="line">Data Center            : datacenter1</span><br><span class="line">Rack                   : rack1</span><br><span class="line">Exceptions             : 0</span><br><span class="line">Key Cache              : entries 11, size 864 bytes, capacity 59 MB, 32 hits, 45 requests, 0.711 recent hit rate, 14400 save period in seconds</span><br><span class="line">Row Cache              : entries 0, size 0 bytes, capacity 0 bytes, 0 hits, 0 requests, NaN recent hit rate, 0 save period in seconds</span><br><span class="line">Counter Cache          : entries 0, size 0 bytes, capacity 29 MB, 0 hits, 0 requests, NaN recent hit rate, 7200 save period in seconds</span><br><span class="line">Token                  : (invoke with -T/--tokens to see all 256 tokens)</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ bin/nodetool -host 192.168.0.101 removetoken c88dce49-f6bc-43a4-adfb-597694faae9e</span><br></pre></td></tr></table></figure>
<h1 id="备份数据"><a href="#备份数据" class="headerlink" title="备份数据"></a>备份数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建一个快照</span><br><span class="line">$ bin/nodetool -host server1 snapshot</span><br></pre></td></tr></table></figure>
<h1 id="cassandra-cql"><a href="#cassandra-cql" class="headerlink" title="cassandra-cql"></a>cassandra-cql</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 cassandra]$ bin/cqlsh server1</span><br><span class="line">Connected to mycluster at server1:9042.</span><br><span class="line">[cqlsh 5.0.1 | Cassandra 2.2.1 | CQL spec 3.3.0 | Native protocol v4]</span><br><span class="line">Use HELP for help.</span><br><span class="line">cqlsh&gt; help</span><br><span class="line"></span><br><span class="line">Documented shell commands:</span><br><span class="line">===========================</span><br><span class="line">CAPTURE  CLS          COPY  DESCRIBE  EXPAND  LOGIN   SERIAL  SOURCE </span><br><span class="line">CLEAR    CONSISTENCY  DESC  EXIT      HELP    PAGING  SHOW    TRACING</span><br><span class="line"></span><br><span class="line">CQL help topics:</span><br><span class="line">================</span><br><span class="line">ALTER                        CREATE_TABLE_TYPES  PERMISSIONS        </span><br><span class="line">ALTER_ADD                    CREATE_USER         REVOKE             </span><br><span class="line">ALTER_ALTER                  DATE_INPUT          REVOKE_ROLE        </span><br><span class="line">ALTER_DROP                   DELETE              SELECT             </span><br><span class="line">ALTER_RENAME                 DELETE_COLUMNS      SELECT_COLUMNFAMILY</span><br><span class="line">ALTER_USER                   DELETE_USING        SELECT_EXPR        </span><br><span class="line">ALTER_WITH                   DELETE_WHERE        SELECT_LIMIT       </span><br><span class="line">APPLY                        DROP                SELECT_TABLE       </span><br><span class="line">ASCII_OUTPUT                 DROP_AGGREGATE      SELECT_WHERE       </span><br><span class="line">BEGIN                        DROP_COLUMNFAMILY   TEXT_OUTPUT        </span><br><span class="line">BLOB_INPUT                   DROP_FUNCTION       TIMESTAMP_INPUT    </span><br><span class="line">BOOLEAN_INPUT                DROP_INDEX          TIMESTAMP_OUTPUT   </span><br><span class="line">COMPOUND_PRIMARY_KEYS        DROP_KEYSPACE       TIME_INPUT         </span><br><span class="line">CREATE                       DROP_ROLE           TRUNCATE           </span><br><span class="line">CREATE_AGGREGATE             DROP_TABLE          TYPES              </span><br><span class="line">CREATE_COLUMNFAMILY          DROP_USER           UPDATE             </span><br><span class="line">CREATE_COLUMNFAMILY_OPTIONS  GRANT               UPDATE_COUNTERS    </span><br><span class="line">CREATE_COLUMNFAMILY_TYPES    GRANT_ROLE          UPDATE_SET         </span><br><span class="line">CREATE_FUNCTION              INSERT              UPDATE_USING       </span><br><span class="line">CREATE_INDEX                 INT_INPUT           UPDATE_WHERE       </span><br><span class="line">CREATE_KEYSPACE              LIST                USE                </span><br><span class="line">CREATE_ROLE                  LIST_PERMISSIONS    UUID_INPUT         </span><br><span class="line">CREATE_TABLE                 LIST_ROLES        </span><br><span class="line">CREATE_TABLE_OPTIONS         LIST_USERS        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1、创建空间，可以理解为创建数据库</span><br><span class="line">cqlsh&gt; CREATE KEYSPACE mykeyspace</span><br><span class="line">   ... WITH REPLICATION = &#123; &apos;class&apos; : &apos;SimpleStrategy&apos;, &apos;replication_factor&apos; : 1 &#125;;</span><br><span class="line"></span><br><span class="line">2、使用mykeyspace</span><br><span class="line">cqlsh&gt; USE mykeyspace;</span><br><span class="line"></span><br><span class="line">3、创建表</span><br><span class="line">cqlsh:mykeyspace&gt; CREATE TABLE users (</span><br><span class="line">              ...   user_id int PRIMARY KEY,</span><br><span class="line">              ...   fname text,</span><br><span class="line">              ...   lname text</span><br><span class="line">              ... );</span><br><span class="line"></span><br><span class="line">4、插入数据</span><br><span class="line">INSERT INTO users (user_id,  fname, lname) VALUES (1745, &apos;john&apos;, &apos;smith&apos;);</span><br><span class="line">INSERT INTO users (user_id,  fname, lname) VALUES (1744, &apos;john&apos;, &apos;doe&apos;);</span><br><span class="line">INSERT INTO users (user_id,  fname, lname) VALUES (1746, &apos;john&apos;, &apos;smith&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5、查询</span><br><span class="line">cqlsh:mykeyspace&gt; SELECT * FROM users;</span><br><span class="line"></span><br><span class="line"> user_id | fname | lname</span><br><span class="line">---------+-------+-------</span><br><span class="line">    1745 |  john | smith</span><br><span class="line">    1744 |  john |   doe</span><br><span class="line">    1746 |  john | smith</span><br><span class="line"></span><br><span class="line">(3 rows)</span><br><span class="line"></span><br><span class="line">6、创建索引</span><br><span class="line">cqlsh:mykeyspace&gt; CREATE INDEX ON users (lname);</span><br><span class="line">cqlsh:mykeyspace&gt; SELECT * FROM users WHERE lname = &apos;smith&apos;;</span><br><span class="line"></span><br><span class="line"> user_id | fname | lname</span><br><span class="line">---------+-------+-------</span><br><span class="line">    1745 |  john | smith</span><br><span class="line">    1746 |  john | smith</span><br><span class="line"></span><br><span class="line">(2 rows)</span><br><span class="line"></span><br><span class="line">7、查询节点</span><br><span class="line">cqlsh:mykeyspace&gt; SELECT peer,data_center,host_id FROM system.peers; </span><br><span class="line"></span><br><span class="line"> peer            | data_center | host_id</span><br><span class="line">-----------------+-------------+--------------------------------------</span><br><span class="line"> 192.168.111.202 | datacenter1 | 334d3c5f-3265-47da-adc0-d6b21a8d569c</span><br><span class="line"> 192.168.111.203 | datacenter1 | 9b67e6c0-0e6d-4787-9858-504765f97126</span><br><span class="line"> 192.168.111.201 | datacenter1 | 1cfc5153-f974-44b3-bb5e-b9a54759d023</span><br><span class="line"></span><br><span class="line">(3 rows)</span><br><span class="line"></span><br><span class="line">cqlsh:mykeyspace&gt; SHOW version</span><br><span class="line">[cqlsh 5.0.1 | Cassandra 2.2.1 | CQL spec 3.3.0 | Native protocol v4]</span><br><span class="line">cqlsh:mykeyspace&gt; SHOW host</span><br><span class="line">Connected to mycluster at server1:9042.</span><br><span class="line">cqlsh:mykeyspace&gt; SHOW SESSION;</span><br><span class="line"></span><br><span class="line">cqlsh:mykeyspace&gt; DESCRIBE mykeyspace.users;</span><br><span class="line"></span><br><span class="line">CREATE TABLE mykeyspace.users (</span><br><span class="line">    user_id int PRIMARY KEY,</span><br><span class="line">    fname text,</span><br><span class="line">    lname text</span><br><span class="line">) WITH bloom_filter_fp_chance = 0.01</span><br><span class="line">    AND caching = &apos;&#123;&quot;keys&quot;:&quot;ALL&quot;, &quot;rows_per_partition&quot;:&quot;NONE&quot;&#125;&apos;</span><br><span class="line">    AND comment = &apos;&apos;</span><br><span class="line">    AND compaction = &#123;&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;&#125;</span><br><span class="line">    AND compression = &#123;&apos;sstable_compression&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;&#125;</span><br><span class="line">    AND dclocal_read_repair_chance = 0.1</span><br><span class="line">    AND default_time_to_live = 0</span><br><span class="line">    AND gc_grace_seconds = 864000</span><br><span class="line">    AND max_index_interval = 2048</span><br><span class="line">    AND memtable_flush_period_in_ms = 0</span><br><span class="line">    AND min_index_interval = 128</span><br><span class="line">    AND read_repair_chance = 0.0</span><br><span class="line">    AND speculative_retry = &apos;99.0PERCENTILE&apos;;</span><br><span class="line">CREATE INDEX users_lname_idx ON mykeyspace.users (lname);</span><br><span class="line"></span><br><span class="line">cqlsh:mykeyspace&gt; SELECT keyspace_name,columnfamily_name,cf_id FROM system.schema_columnfamilies WHERE keyspace_name = &apos;mykeyspace&apos;;</span><br><span class="line"></span><br><span class="line"> keyspace_name | columnfamily_name | cf_id</span><br><span class="line">---------------+-------------------+--------------------------------------</span><br><span class="line">    mykeyspace |             users | f45405a0-5e2b-11e5-adb6-bfcb7a5c7b40</span><br><span class="line"></span><br><span class="line">(1 rows)</span><br><span class="line"></span><br><span class="line">cqlsh:mykeyspace&gt;  SELECT keyspace_name,columnfamily_name,column_name,component_index,index_name,index_options,index_type,type FROM system.schema_columns WHERE keyspace_name = &apos;mykeyspace&apos;;</span><br><span class="line"></span><br><span class="line"> keyspace_name | columnfamily_name | column_name | component_index | index_name      | index_options | index_type | type</span><br><span class="line">---------------+-------------------+-------------+-----------------+-----------------+---------------+------------+---------------</span><br><span class="line">    mykeyspace |             users |       fname |               0 |            null |          null |       null |       regular</span><br><span class="line">    mykeyspace |             users |       lname |               0 | users_lname_idx |            &#123;&#125; | COMPOSITES |       regular</span><br><span class="line">    mykeyspace |             users |     user_id |            null |            null |          null |       null | partition_key</span><br><span class="line"></span><br><span class="line">(3 rows)</span><br><span class="line"></span><br><span class="line">[whoami@server1 bin]$ nodetool proxyhistograms</span><br><span class="line">proxy histograms</span><br><span class="line">Percentile      Read Latency     Write Latency     Range Latency</span><br><span class="line">                    (micros)          (micros)          (micros)</span><br><span class="line">50%                  4055.27           5839.59          12108.97</span><br><span class="line">75%                 17436.92          14530.76          25109.16</span><br><span class="line">95%                 52066.35          14530.76         962624.93</span><br><span class="line">98%                 62479.63          14530.76        1386179.89</span><br><span class="line">99%                 89970.66          14530.76        1386179.89</span><br><span class="line">Min                   263.21           1358.10           2346.80</span><br><span class="line">Max                 89970.66          14530.76        1386179.89</span><br><span class="line"></span><br><span class="line">[whoami@server1 bin]$  nodetool status mykeyspace</span><br><span class="line">Datacenter: datacenter1</span><br><span class="line">=======================</span><br><span class="line">Status=Up/Down</span><br><span class="line">|/ State=Normal/Leaving/Joining/Moving</span><br><span class="line">--  Address          Load       Tokens       Owns (effective)  Host ID                               Rack</span><br><span class="line">UN  192.168.111.202  699.43 KB  256          22.9%             334d3c5f-3265-47da-adc0-d6b21a8d569c  rack1</span><br><span class="line">UN  192.168.111.203  667.12 KB  256          25.6%             9b67e6c0-0e6d-4787-9858-504765f97126  rack1</span><br><span class="line">UN  192.168.111.200  1.4 MB     256          26.0%             c88dce49-f6bc-43a4-adfb-597694faae9e  rack1</span><br><span class="line">UN  192.168.111.201  757.62 KB  256          25.5%             1cfc5153-f974-44b3-bb5e-b9a54759d023  rack1</span><br><span class="line"></span><br><span class="line">[whoami@server1 bin]$ nodetool -h localhost -p 7199 cfstats|wc -l</span><br><span class="line">966</span><br></pre></td></tr></table></figure>
<h1 id="Monitoring-with-MX4J"><a href="#Monitoring-with-MX4J" class="headerlink" title="Monitoring with MX4J"></a>Monitoring with MX4J</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://downloads.sourceforge.net/project/mx4j/MX4J%20Binary/3.0.2/mx4j-3.0.2.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fmx4j%2Ffiles%2FMX4J%2520Binary%2F3.0.2%2F&amp;ts=1442568047&amp;use_mirror=nchc</span><br></pre></td></tr></table></figure>
<h1 id="Monitoring-a-Cassandra-cluster"><a href="#Monitoring-a-Cassandra-cluster" class="headerlink" title="Monitoring a Cassandra cluster"></a>Monitoring a Cassandra cluster</h1><p>  <a href="http://docs.datastax.com/en/cassandra/2.2/cassandra/operations/opsMonitoring.html" target="_blank" rel="noopener">http://docs.datastax.com/en/cassandra/2.2/cassandra/operations/opsMonitoring.html</a><br>  <a href="http://pimin.net/archives/388" target="_blank" rel="noopener">http://pimin.net/archives/388</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">install Manage Existing Cluster</span><br><span class="line"></span><br><span class="line">wget http://downloads.datastax.com/community/opscenter.tar.gz</span><br><span class="line">[whoami@server1 ~]$ tar -zxvf opscenter-5.2.1.tar.gz </span><br><span class="line">[whoami@server1 ~]$ cd opscenter-5.2.1</span><br><span class="line">[whoami@server1 opscenter-5.2.1]$ bin/opscenter </span><br><span class="line">[whoami@server1 opscenter-5.2.1]$ lsof -i :8888</span><br><span class="line">COMMAND     PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">python2.6 18406 whoami    6u  IPv4 525585      0t0  TCP *:ddi-tcp-1 (LISTEN)</span><br><span class="line"></span><br><span class="line">install agent</span><br><span class="line">手动安装agent：在OpsCenter的目录下有个agent目录，我们需要的agent就在里面。不安装agent无法显示监控指标...所有节点stomp_interface配置项一致！</span><br><span class="line"></span><br><span class="line">[whoami@server1 opscenter-5.2.1]$ cd agent</span><br><span class="line">[whoami@server1 agent]$ echo &quot;stomp_interface: server1&quot; &gt;&gt; ./conf/address.yaml</span><br><span class="line">[whoami@server1 agent]$ bin/datastax-agent</span><br></pre></td></tr></table></figure></p>
<ul>
<li>address.yaml详细参数说明<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">The address.yaml configuration file</span><br><span class="line"></span><br><span class="line">The address.yaml file contains configuration options for the DataStax Agent.</span><br><span class="line"></span><br><span class="line">Note: As of version 5.1 of OpsCenter, the hosts option in address.yaml now determines which nodes the agent connects to. For further information on configuration changes and migration paths, see the Upgrade Guide.</span><br><span class="line">Configuration options</span><br><span class="line"></span><br><span class="line">stomp_interface</span><br><span class="line">(Required) Reachable IP address of the opscenterd machine. The connection is made on stomp_port.</span><br><span class="line">stomp_port</span><br><span class="line">The stomp_port used by opscenterd. Default: 61620.</span><br><span class="line">use_ssl</span><br><span class="line">Whether to use SSL communication between the agent and opscenterd. Affects both the STOMP connection and agent HTTP server. Corresponds to [agents] use_ssl in opscenterd.conf. Setting this option to 1 turns on SSL connections. Default: 0.</span><br><span class="line">local_interface</span><br><span class="line">The IP used to identify the node in opscenterd. If broadcast_address is set in cassandra.yaml, this should be the same as that; otherwise, it is typically the same as listen_address in cassandra.yaml. A good check is to confirm that this address is the same as the address that nodetool ring outputs. If not set, the agent attempts to determine the proper IP address via JMX.</span><br><span class="line">agent_rpc_interface</span><br><span class="line">The IP that the agent HTTP server listens on. In a multiple region deployment, this is typically a private IP. Default: Matches rpc_interface from cassandra.yaml.</span><br><span class="line">agent_rpc_broadcast_address</span><br><span class="line">The IP that the central OpsCenter process uses to connect to the DataStax agent. Default: Matches agent_rpc_interface.</span><br><span class="line">api_port</span><br><span class="line">The port used for the agent&apos;s HTTP endpoint. Default: 61621.</span><br><span class="line">hosts</span><br><span class="line">The DataStax Enterprise node or nodes responsible for storing OpsCenter data. By default, this will be the local node, but may be configured to store data on a separate cluster. The hosts option accepts an array of strings specifying the IP addresses of the node or nodes. For example, [&quot;1.2.3.4&quot;] or [&quot;1.2.3.4&quot;, &quot;1.2.3.5&quot;].</span><br><span class="line">cassandra_port</span><br><span class="line">Port used to connect to the local cassandra node. The native transport port.</span><br><span class="line">cassandra_user</span><br><span class="line">The username used to connect to cassandra when authentication is enabled.</span><br><span class="line">cassandra_pass</span><br><span class="line">The password used to connect to cassandra when authentication is enabled.</span><br><span class="line">jmx_host</span><br><span class="line">Host used to connect to local JMX server. Default: 127.0.0.1.</span><br><span class="line">jmx_port</span><br><span class="line">Port used to connect to local JMX server. Default: 7199.</span><br><span class="line">jmx_user</span><br><span class="line">The username used to connect to the local JMX server if JMX authentication is enabled on the node.</span><br><span class="line">jmx_pass</span><br><span class="line">The password used to connect to the local JMX server if JMX authentication is enabled on the node.</span><br><span class="line">cassandra-conf</span><br><span class="line">The agent attempts to auto-detect the location of the cassandra.yaml file via JMX, but if it cannot, this option must be set to the full path of cassandra.yaml. By default /etc/cassandra/cassandra.yaml on Installer-Services or package installations or /path/to/install/conf/cassandra.yaml on Installer-No Services or tarball installations.</span><br><span class="line">cassandra_install_location</span><br><span class="line">The base directory where DataStax Enterprise or Cassandra is installed. When not set, the agent attempts to auto-detect the location but cannot do so in all cases.</span><br><span class="line">cassandra_log_location</span><br><span class="line">The location of the Cassandra system.log file. This option is only used for the diagnostics tarball, and should only be set if system.log is in a non-standard location.</span><br><span class="line">poll_period</span><br><span class="line">The length of time in seconds between attempts to collect metrics. Default: 60.</span><br><span class="line">disk_usage_update_period</span><br><span class="line">The length of time in seconds to wait between attempts to poll the disk for usage. Default: 60.</span><br><span class="line">jmx_thread_pool_size</span><br><span class="line">The size of the thread pool used for long-running JMX connections. Default: 5.</span><br><span class="line">jmx_operations_pool_size</span><br><span class="line">The size of the JMX connection pool used for JMX operations. Default: 4.</span><br><span class="line">jmx_retry_timeout</span><br><span class="line">The number of retries to attempt while establishing the cassandra host id. Default: 30.</span><br><span class="line">nodedetails_threadpool_size</span><br><span class="line">The size of the thread pool used to obtain node details. Default: 3.</span><br><span class="line">realtime_interval</span><br><span class="line">The length of time in seconds between polling attempts to capture rapidly changing real-time information. Default: 5.</span><br><span class="line">shorttime_interval</span><br><span class="line">The length of time in seconds between polling attempts to capture information that changes frequently (e.g., OS load, data size, running tasks). Default: 10.</span><br><span class="line">longtime_interval</span><br><span class="line">The length of time in seconds between polling attempts to capture information that changes infrequently. Default: 300.</span><br><span class="line">ec2_metadata_api_host</span><br><span class="line">The EC2 metadata api host used to determine information about the node if it is on EC2. Default: 169.254.169.254.</span><br><span class="line">metrics_enabled</span><br><span class="line">Whether to collect and store metrics for the local node. Setting this option to 0 turns off metrics collection. Default: 1.</span><br><span class="line">jmx_metrics_threadpool_size</span><br><span class="line">The size of the thread pool used for collecting metrics over JMX. Default: 4.</span><br><span class="line">metrics_ignored_keyspaces</span><br><span class="line">A comma-separated list of keyspaces ignored by metrics collection. Example: &quot;ks1, ks2, ks3&quot;.</span><br><span class="line">metrics_ignored_column_families</span><br><span class="line">A comma-separated list of tables (formerly referred to as column families) ignored by metrics collection. Example: &quot;ks1.cf1, ks1.cf2, ks2.cf1&quot;.</span><br><span class="line">metrics_ignored_solr_cores</span><br><span class="line">A comma-separated list of solr cores ignored by metrics collection. Example: &quot;ks1.cf1, ks1.cf2, ks2.cf1&quot;.</span><br><span class="line">async_queue_size</span><br><span class="line">The maximum number of queued cassandra operations. If your cluster experiences bursty cassandra stress, increasing this queue size might help. Default: 5000.</span><br><span class="line">async_pool_size</span><br><span class="line">The pool size to use for async operations to cassandra. Default when using local storage: 2. Default when using remote storage: 4.</span><br><span class="line">max_pending_repairs</span><br><span class="line">The maximum number of repairs that might be pending. Exceeding this number blocks new repairs. Default: 5.</span><br><span class="line">ssl_keystore</span><br><span class="line">The SSL keystore location for agents to use to connect to CQL.</span><br><span class="line">ssl_keystore_password</span><br><span class="line">The SSL truststore password for agents to use to connect to CQL.</span><br><span class="line">kerberos_service</span><br><span class="line">The Kerberos service name to use when using Kerberos authentication within DSE.</span><br><span class="line">storage_keyspace</span><br><span class="line">The keyspace that the agent uses to store data.</span><br><span class="line">runs_sudo</span><br><span class="line">Sets whether the DataStax Agent runs using sudo. Setting this option to false means the agent does not use sudo, and the agent user does not run using elevated privileges. Setting this option to true means the agent runs with elevated privileges using sudo.</span><br><span class="line">restore_req_update_period</span><br><span class="line">The frequency in seconds with which status updates are sent to opscenterd during Restore operations in the Backup Service. Default: 60.</span><br><span class="line">backup_staging_dir</span><br><span class="line">The directory used for staging commitlogs to be backed up.</span><br><span class="line">tmp_dir</span><br><span class="line">The location of the Backup Service staging directory for backups. The default location is /var/lib/datastax-agent/tmp.</span><br><span class="line">remote_backup_retries</span><br><span class="line">The number of attempts to make when file download fails during a restore. Default: 3.</span><br><span class="line">remote_backup_timeout</span><br><span class="line">The timeout in milliseconds for the connection used to push backups to remote destinations. Default: 1000.</span><br><span class="line">remote_backup_retry_delay</span><br><span class="line">The delay in milliseconds between remote backup retries. Default: 5000.</span><br><span class="line">remote_verify_initial_delay</span><br><span class="line">Initial delay in milliseconds to wait before checking if a file was successfully uploaded during a backup operation. This configuration option works in conjunction with the remote_verify_max option to distinguish between broken versus tardy backups when cleaning up SSTables. The remote_verify_initial_delay value doubles each time a file transfer validation failure occurs until the value exceeds the remote_verify_max value. Default: 1000 (1 second).</span><br><span class="line">remote_verify_max</span><br><span class="line">The maximum time period in milliseconds to wait after a file upload has completed but is still unreadable from the remote destination. When this delay is exceeded, the file transfer is considered failed. This configuration option works in conjunction with the remote_verify_initial_delay option to distinguish between broken versus tardy backups when cleaning up SSTables. Default: 30000 (30 seconds).</span><br><span class="line">restore_on_transfer_failure</span><br><span class="line">When set to true, a failed file transfer from the remote destination does not halt the restore process. A future restore attempt uses any successfully transferred files. Default: false.</span><br><span class="line">backup_file_queue_max</span><br><span class="line">The maximum number of files that can be queued for an upload to a remote destination. Increasing this number consumes more memory. Default: 10000.</span><br><span class="line">remote_backup_region</span><br><span class="line">The AWS region to use for remote backup transfers. Default: us-west-1.</span><br><span class="line">max_file_transfer_attempts</span><br><span class="line">The maximum number of attempts to upload a file or create a remote destination. Default: 30.</span><br><span class="line">trace_delay</span><br><span class="line">The time in milliseconds to wait between issuing a query to trace and fetching trace events in the Performance Service Slow Query panel. Default: 300.</span><br><span class="line">max-seconds-to-sleep</span><br><span class="line">When stream throttling is configured in Backup Service transfers to or from a remote destination, this setting acts as a cap on how long to sleep when throttling. The cap prevents prematurely closing connections due to inactivity. Default: 25 (seconds).</span><br><span class="line">seconds-to-read-kill-channel</span><br><span class="line">Delay in seconds used to verify that the Backup Service transfer should stop. Default: 0.005.</span><br><span class="line">unthrottled-default</span><br><span class="line">A very large number used for bytes per second if no throttle is selected. Default: 10000000000.</span><br><span class="line">slow_query_past</span><br><span class="line">How far into the past in milliseconds to look for slow queries. Default: 3600000 (1,000 hours).</span><br><span class="line">slow_query_refresh</span><br><span class="line">Time in seconds between slow query refreshes. Default: 5.</span><br><span class="line">slow_query_fetch_size</span><br><span class="line">The limit to how many slow queries are fetched. Default: 2000.</span><br><span class="line">slow_query_ignore</span><br><span class="line">A list of keyspaces to ignore in the slow query log of the Performance Service. Default: [&quot;OpsCenter&quot; &quot;dse_perf&quot;].</span><br><span class="line">config_encryption_active</span><br><span class="line">Specifies whether opscenter should attempt to decrypt sensitive config values. Default: False.</span><br><span class="line">config_encryption_key_name</span><br><span class="line">Filename to use for the encryption key. If a custom name is not specified, opsc_system_key is used by default.</span><br><span class="line">config_encryption_key_path</span><br><span class="line">Path where the encryption key should be located. If unspecified, the directory of address.yaml is used by default.</span><br><span class="line">max_reconnect_time</span><br><span class="line">Maximum delay in ms for an agent to attempt reconnecting to Cassandra. The default is 15000 ms (15 s).</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">浏览器输入：http://server1:8888,做一些相应的设置即可监控到cassandra集群.击“Manage Existing Cluster”，输入监控节点--&gt;Enter at least one host / IP in the cluster (newline delimited)</span><br><span class="line"></span><br><span class="line">1、进入系统后，提示需要安装4个agent，因为这里有四个cassandra节点！参考install agent</span><br></pre></td></tr></table></figure>
<p><img src="http://www.itweet.github.io/screenshots/cassandra-mon.png" alt="1"></p>
<p><img src="http://www.itweet.github.io/screenshots/cassandra-mon2.png" alt="2"></p>
<p><img src="http://www.itweet.github.io/screenshots/cassandra-home.png" alt="3"></p>
<p><img src="http://www.itweet.github.io/screenshots/cassandra-home1.png" alt="4"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2、问题：手动安装某些功能无法使用，比如重启集群，无法使用！建议rpm包安装！</span><br><span class="line">Error restarting cluster: Unable to find scripts for cassandra or dse in /etc/init.d/. If you are running Cassandra or DSE from a tarball installation, please fill out the custom scripts at /usr/share/datastax-agent/bin/(start|stop)-cassandra, or bin/(start|stop)-cassandra if the agent is running from a tarball installation. Dismiss</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3、注意添加主机，需要所有cassandra节点都加入，不然agent会运行不正常!</span><br><span class="line"></span><br><span class="line">http://docs.datastax.com/en/opscenter/5.2/opsc/online_help/opscAddingCluster_t.html</span><br></pre></td></tr></table></figure>
<p><img src="http://www.itweet.github.io/screenshots/cassandra-hosts.png" alt="5"></p>
<h1 id="stoping-cluster"><a href="#stoping-cluster" class="headerlink" title="stoping cluster"></a>stoping cluster</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps auwx | grep cassandra</span><br><span class="line">$ sudo kill pid</span><br></pre></td></tr></table></figure>
<h1 id="java-connect-cassandra"><a href="#java-connect-cassandra" class="headerlink" title="java connect cassandra"></a>java connect cassandra</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.datastax.cassandra&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;cassandra-driver-core&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.2.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Configuring-authentication"><a href="#Configuring-authentication" class="headerlink" title="Configuring authentication"></a>Configuring authentication</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Configuring authentication</span><br><span class="line">Steps for configuring authentication.</span><br><span class="line">About this task</span><br><span class="line">To configure Cassandra to use internal authentication, first make a change to the cassandra.yaml file and</span><br><span class="line">increase the replication factor of the system_auth keyspace, as described in this procedure. Next, start up</span><br><span class="line">Cassandra using the default user name and password (cassandra/cassandra), and start cqlsh using the</span><br><span class="line">same credentials. Finally, use these CQL statements to set up user accounts to authorize users to access</span><br><span class="line">the database objects:</span><br><span class="line">Configuration</span><br><span class="line">101</span><br><span class="line">• ALTER ROLE</span><br><span class="line">• ALTER USER</span><br><span class="line">• CREATE ROLE</span><br><span class="line">• CREATE USER</span><br><span class="line">• DROP ROLE</span><br><span class="line">• DROP USER</span><br><span class="line">• LIST ROLES</span><br><span class="line">• LIST USERS</span><br><span class="line">Note: To configure authorization, see Internal authorization.</span><br><span class="line">Procedure</span><br><span class="line">1. Change the authenticator option in the cassandra.yaml file to PasswordAuthenticator.</span><br><span class="line">By default, the authenticator option is set to AllowAllAuthenticator.</span><br><span class="line">authenticator: PasswordAuthenticator</span><br><span class="line">2. Increase the replication factor for the system_auth keyspace to N (number of nodes).</span><br><span class="line">If you use the default, 1, and the node with the lone replica goes down, you will not be able to log into</span><br><span class="line">the cluster because the system_auth keyspace was not replicated.</span><br><span class="line">3. Restart the Cassandra client.</span><br><span class="line">The default superuser name and password that you use to start the client is stored in Cassandra.</span><br><span class="line">$ client_startup_string -u cassandra -p cassandra</span><br><span class="line">4. Start cqlsh using the superuser name and password.</span><br><span class="line">$ cqlsh -u cassandra -p cassandra</span><br><span class="line">5. Create another superuser, not named cassandra. This step is optional but highly recommended.</span><br><span class="line">6. Log in as that new superuser.</span><br><span class="line">7. Change the cassandra user password to something long and incomprehensible, and then forget about</span><br><span class="line">it. It won&apos;t be used again.</span><br><span class="line">8. Take away the cassandra user&apos;s superuser status.</span><br><span class="line">9. Use the CQL statements listed previously to set up user accounts and then grant permissions to access</span><br><span class="line">the database objects.</span><br><span class="line"></span><br><span class="line">http://heipark.iteye.com/blog/2004118</span><br></pre></td></tr></table></figure>
<h1 id="datastax-by-rpm-install-cassandra-cluster"><a href="#datastax-by-rpm-install-cassandra-cluster" class="headerlink" title="datastax by rpm install cassandra cluster"></a>datastax by rpm install cassandra cluster</h1><ul>
<li><a href="http://docs.datastax.com/en/landing_page/doc/landing_page/current.html" target="_blank" rel="noopener">http://docs.datastax.com/en/landing_page/doc/landing_page/current.html</a></li>
</ul>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/cassandra/">cassandra</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2015/09/30/net-snmp/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">net-snmp</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2015/09/15/hdfs-balancer均衡器使用/">
        <span class="next-text nav-default">hdfs-balancer均衡器使用</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">加载 Disqus 评论</button>
    </div>
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2023
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/realXuJiang/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'itweet-cn';
  var disqus_identifier = '2015/09/21/Apache-Cassandra-Cluster/';

  var disqus_title = "Apache-Cassandra-Cluster";


  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
