<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="tez-use">




  <meta name="keywords" content="Tez,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2015/07/20/tez-use/">


<meta name="description" content="为了更高效地运行存在依赖关系的作业（比如Pig和Hive产生的MapReduce作业），减少磁盘和网络IO，Hortonworks开发了DAG计算框架Tez。Tez是从MapReduce计算框架演化而来的通用DAG计算框架，可作为MapReduceR/Pig/Hive等系统的底层数据处理引擎，它天生融入Hadoop 2.0中的资源管理平台YARN，且由Hadoop 2.0核心人员精心打造，势必">
<meta name="keywords" content="Tez">
<meta property="og:type" content="article">
<meta property="og:title" content="tez-use">
<meta property="og:url" content="http://itweet.github.io/2015/07/20/tez-use/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="为了更高效地运行存在依赖关系的作业（比如Pig和Hive产生的MapReduce作业），减少磁盘和网络IO，Hortonworks开发了DAG计算框架Tez。Tez是从MapReduce计算框架演化而来的通用DAG计算框架，可作为MapReduceR/Pig/Hive等系统的底层数据处理引擎，它天生融入Hadoop 2.0中的资源管理平台YARN，且由Hadoop 2.0核心人员精心打造，势必">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://tez.apache.org/images/ApacheTezLogo_lowres.png">
<meta property="og:image" content="http://tez.apache.org/images/PigHiveQueryOnMR.png">
<meta property="og:image" content="http://tez.apache.org/images/PigHiveQueryOnTez.png">
<meta property="og:image" content="https://jikelab.github.io/tech-labs/screenshots/tez-demo.png">
<meta property="og:image" content="https://jikelab.github.io/tech-labs/screenshots/yarn-tez-hive.png">
<meta property="og:image" content="https://jikelab.github.io/tech-labs/screenshots/tez-runting.png">
<meta property="og:image" content="https://jikelab.github.io/tech-labs/screenshots/tez-runting_dag.png">
<meta property="og:updated_time" content="2018-07-02T13:09:15.486Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="tez-use">
<meta name="twitter:description" content="为了更高效地运行存在依赖关系的作业（比如Pig和Hive产生的MapReduce作业），减少磁盘和网络IO，Hortonworks开发了DAG计算框架Tez。Tez是从MapReduce计算框架演化而来的通用DAG计算框架，可作为MapReduceR/Pig/Hive等系统的底层数据处理引擎，它天生融入Hadoop 2.0中的资源管理平台YARN，且由Hadoop 2.0核心人员精心打造，势必">
<meta name="twitter:image" content="http://tez.apache.org/images/ApacheTezLogo_lowres.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> tez-use - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          tez-use
        
      </h1>

      <time class="post-time">
          7月 20 2015
      </time>
    </header>



    
            <div class="post-content">
            <p><img src="http://tez.apache.org/images/ApacheTezLogo_lowres.png" alt></p>
<blockquote>
<p>为了更高效地运行存在依赖关系的作业（比如Pig和Hive产生的MapReduce作业），减少磁盘和网络IO，Hortonworks开发了DAG计算框架Tez。Tez是从MapReduce计算框架演化而来的通用DAG计算框架，可作为MapReduceR/Pig/Hive等系统的底层数据处理引擎，它天生融入Hadoop 2.0中的资源管理平台YARN，且由Hadoop 2.0核心人员精心打造，势必将会成为计算框架中的后起之秀。本文将重点介绍Tez的最新进展。</p>
</blockquote>
<p>Tez有以下几个特色：</p>
<ul>
<li>（1） 丰富的数据流（dataflow，NOT Streaming！）编程接口；</li>
<li>（2） 扩展性良好的“Input-Processor-Output”运行模型；</li>
<li>（3） 简化数据部署（充分利用了YARN框架，Tez本身仅是一个客户端编程库，无需事先部署相关服务）</li>
<li>（4） 性能优于MapReduce</li>
<li>（5）  优化的资源管理（直接运行在资源管理系统YARN之上）</li>
<li>（6） 动态生成物理数据流（dataflow）</li>
</ul>
<h2 id="DAG-task"><a href="#DAG-task" class="headerlink" title="DAG task"></a><code>DAG task</code></h2><p><img src="http://tez.apache.org/images/PigHiveQueryOnMR.png" alt><br><img src="http://tez.apache.org/images/PigHiveQueryOnTez.png" alt></p>
<h1 id="git获取源码"><a href="#git获取源码" class="headerlink" title="git获取源码"></a>git获取源码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git@github.com:apache/tez.git</span><br></pre></td></tr></table></figure>
<h1 id="一、安装必要软件"><a href="#一、安装必要软件" class="headerlink" title="一、安装必要软件"></a>一、安装必要软件</h1><h2 id="1、安装java"><a href="#1、安装java" class="headerlink" title="1、安装java"></a>1、安装java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># wget http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br><span class="line"># tar -zxvf jdk-7u79-linux-x64.tar.gz </span><br><span class="line"># ln -s jdk1.7.0_79 jdk</span><br><span class="line"></span><br><span class="line">加入环境变量</span><br><span class="line"># source ~/.bash_profile </span><br><span class="line"># java -version </span><br><span class="line">java version &quot;1.7.0_79&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.79-b02, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="2、安装apache-maven"><a href="#2、安装apache-maven" class="headerlink" title="2、安装apache maven"></a>2、安装apache maven</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># wget http://archive.apache.org/dist/maven/maven-3/3.0.5/binaries/apache-maven-3.0.5-bin.tar.gz</span><br><span class="line"># tar -zxf apache-maven-3.0.5-bin.tar.gz</span><br><span class="line"># ln -s apache-maven-3.0.5 maven</span><br><span class="line"># echo &quot;export MAVEN_HOME=/usr/local/maven&quot; &gt;&gt; ~/.bash_profile</span><br><span class="line"># echo &quot;export PATH=$MAVEN_HOME/bin:$PATH:$HOME/bin&quot; &gt;&gt; ~/.bash_profile</span><br><span class="line"># source ~/.bash_profile </span><br><span class="line"># mvn -version</span><br><span class="line">Apache Maven 3.0.5 (r01de14724cdef164cd33c7c8c2fe155faf9602da; 2013-02-19 21:51:28+0800)</span><br><span class="line">Maven home: /usr/local/maven</span><br><span class="line">Java version: 1.7.0_79, vendor: Oracle Corporation</span><br><span class="line">Java home: /usr/local/jdk1.7.0_79/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;2.6.32-504.el6.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure>
<h2 id="3、Protocol-Buffers-2-5-0"><a href="#3、Protocol-Buffers-2-5-0" class="headerlink" title="3、Protocol Buffers 2.5.0"></a>3、Protocol Buffers 2.5.0</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># tar -zxvf protobuf-2.5.0.tar.gz </span><br><span class="line"># cd protobuf-2.5.0</span><br><span class="line"># ./configure --prefix=/usr/local/protobuf-2.5/</span><br><span class="line"># make &amp;&amp; make install</span><br><span class="line"># ln -s protobuf-2.5 protobuf</span><br><span class="line">#在~/.bash_porfile添加 export PATH=/usr/local/protobuf/bin</span><br><span class="line"># source ~/.bash_profile </span><br><span class="line"># protoc --version</span><br><span class="line">libprotoc 2.5.0</span><br></pre></td></tr></table></figure>
<p><code>注意: 如果是ubuntu系统,编译报错,执行sudo apt-get install build-essential,来安装许多基本库,然后编译即可顺利完成！</code></p>
<h2 id="4、编译tez"><a href="#4、编译tez" class="headerlink" title="4、编译tez"></a>4、编译tez</h2><h2 id="github获取某个release版本"><a href="#github获取某个release版本" class="headerlink" title="github获取某个release版本"></a>github获取某个release版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># git clone https://github.com/apache/tez.git</span><br><span class="line"># cd tez/</span><br><span class="line"></span><br><span class="line">修改pom中hadoop版本为&lt;hadoop.version&gt;2.4.0&lt;/hadoop.version&gt;</span><br><span class="line"></span><br><span class="line"># git tag</span><br><span class="line">  release-0.2.0-rc0</span><br><span class="line">  release-0.3.0-incubating</span><br><span class="line">  release-0.3.0-incubating-rc0</span><br><span class="line">  release-0.3.0-incubating-rc1</span><br><span class="line">  release-0.4.0-incubating</span><br><span class="line">  release-0.4.1-incubating</span><br><span class="line">  release-0.5.0</span><br><span class="line">  release-0.5.1</span><br><span class="line">  release-0.5.2</span><br><span class="line">  release-0.5.3</span><br><span class="line">  release-0.5.4</span><br><span class="line">  release-0.6.0</span><br><span class="line">  release-0.6.1</span><br><span class="line">  release-0.7.0</span><br><span class="line"></span><br><span class="line">  # git show-branch</span><br><span class="line">  [master] TEZ-2610: yarn-swimlanes for DAGs that use containers of a previous DAG (gopalv)</span><br></pre></td></tr></table></figure>
<h2 id="5、-change-hadoop-version为你的版本"><a href="#5、-change-hadoop-version为你的版本" class="headerlink" title="5、 change hadoop-version为你的版本"></a>5、 change hadoop-version为你的版本</h2><h3 id="Build-tez"><a href="#Build-tez" class="headerlink" title="Build tez"></a>Build tez</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"># mvn clean package -DskipTests=true -Dmaven.javadoc.skip=true</span><br><span class="line"></span><br><span class="line">报错1：</span><br><span class="line">[ERROR] Failed to execute goal com.github.eirslett:frontend-maven-plugin:0.0.22:install-node-and-npm (install node and npm) on project tez-ui: Could not download npm: Could not download http://registry.npmjs.org/npm/-/npm-1.3.8.tgz: Unknown host registry.npmjs.org: Name or service not known -&gt; [Help 1]</span><br><span class="line">[ERROR] </span><br><span class="line">[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.</span><br><span class="line">[ERROR] Re-run Maven using the -X switch to enable full debug logging.</span><br><span class="line">[ERROR] </span><br><span class="line">[ERROR] For more information about the errors and possible solutions, please read the following articles:</span><br><span class="line">[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException</span><br><span class="line">[ERROR] </span><br><span class="line">[ERROR] After correcting the problems, you can resume the build with the command</span><br><span class="line">[ERROR]   mvn &lt;goals&gt; -rf :tez-ui</span><br><span class="line"></span><br><span class="line">解决：https://issues.apache.org/jira/browse/TEZ-2229</span><br><span class="line"># cd tez-ui/</span><br><span class="line">then I changed tez-ui/pom.xml, add &apos;--allow-root&apos; argument:</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;workingDirectory&gt;$</span><br><span class="line">&#123;webappDir&#125;</span><br><span class="line">&lt;/workingDirectory&gt;</span><br><span class="line">&lt;executable&gt;$</span><br><span class="line">&#123;node.executable&#125;</span><br><span class="line">&lt;/executable&gt;</span><br><span class="line">&lt;arguments&gt;</span><br><span class="line">&lt;argument&gt;node_modules/bower/bin/bower&lt;/argument&gt;</span><br><span class="line">&lt;argument&gt;install&lt;/argument&gt;</span><br><span class="line">&lt;argument&gt;--remove-unnecessary-resolutions=false&lt;/argument&gt;</span><br><span class="line">&lt;argument&gt;--allow-root&lt;/argument&gt;</span><br><span class="line">&lt;/arguments&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line">--通过手动安装tez后解决问题如下</span><br><span class="line"># wget http://mirror.bit.edu.cn/apache/tez/0.7.0/apache-tez-0.7.0-src.tar.gz</span><br><span class="line"># cd apache-tez-0.7.0-src</span><br><span class="line"># mvn clean package -DskipTests=true -Dmaven.javadoc.skip=true</span><br><span class="line"></span><br><span class="line"># yum -y install gcc make gcc-c++ openssl </span><br><span class="line"># wget http://nodejs.org/dist/v0.10.26/node-v0.10.26.tar.gz</span><br><span class="line"># tar -zxvf node-v0.10.26.tar.gz </span><br><span class="line"># make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"># node -v</span><br><span class="line">  v0.10.26</span><br><span class="line"></span><br><span class="line">--继续编译tez</span><br><span class="line"># mvn -X clean package -DskipTests=true -Dmaven.javadoc.skip=true</span><br><span class="line"></span><br><span class="line">报错2：</span><br><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project tez-yarn-timeline-history-with-acls: Compilation failure: Compilation failure:</span><br><span class="line">[ERROR] symbol:   class TimelineDomain</span><br><span class="line"></span><br><span class="line">原因：由于修改了pom中hadoop.version=2.4.0,而tez-0.7默认是2.6.0版本</span><br><span class="line"></span><br><span class="line">--继续编译</span><br><span class="line"># mvn -X clean package -DskipTests=true -Dmaven.javadoc.skip=true    </span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Reactor Summary:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] tez ............................................... SUCCESS [3.563s]</span><br><span class="line">[INFO] tez-api ........................................... SUCCESS[24.276s]</span><br><span class="line">[INFO] tez-common ........................................ SUCCESS [1.977s]</span><br><span class="line">[INFO] tez-runtime-internals ............................. SUCCESS [3.696s]</span><br><span class="line">[INFO] tez-runtime-library ............................... SUCCESS[11.011s]</span><br><span class="line">[INFO] tez-mapreduce ..................................... SUCCESS [4.218s]</span><br><span class="line">[INFO] tez-examples ...................................... SUCCESS [1.187s]</span><br><span class="line">[INFO] tez-dag ........................................... SUCCESS[10.370s]</span><br><span class="line">[INFO] tez-tests ......................................... SUCCESS [3.100s]</span><br><span class="line">[INFO] tez-ui ............................................ SUCCESS [14.876s]</span><br><span class="line">[INFO] tez-plugins ....................................... SUCCESS [0.097s]</span><br><span class="line">[INFO] tez-yarn-timeline-history ......................... SUCCESS [2.782s]</span><br><span class="line">[INFO] tez-yarn-timeline-history-with-acls ............... SUCCESS [2.044s]</span><br><span class="line">[INFO] tez-mbeans-resource-calculator .................... SUCCESS [2.047s]</span><br><span class="line">[INFO] tez-tools ......................................... SUCCESS [0.263s]</span><br><span class="line">[INFO] tez-dist .......................................... SUCCESS [1:17:56.763s]</span><br><span class="line">[INFO] Tez ............................................... SUCCESS [0.032s]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 1:19:24.309s</span><br><span class="line">[INFO] Finished at: Sat Jul 18 07:33:17 HKT 2015</span><br><span class="line">[INFO] Final Memory: 43M/202M</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># tree -L 1</span><br><span class="line">.</span><br><span class="line">|-- BUILDING.txt</span><br><span class="line">|-- CHANGES.txt</span><br><span class="line">|-- INSTALL.md -&gt; docs/src/site/markdown/install.md</span><br><span class="line">|-- KEYS</span><br><span class="line">|-- LICENSE.txt</span><br><span class="line">|-- NOTICE.txt</span><br><span class="line">|-- README.md</span><br><span class="line">|-- Tez_DOAP.rdf</span><br><span class="line">|-- build-tools</span><br><span class="line">|-- docs</span><br><span class="line">|-- pom.xml</span><br><span class="line">|-- target</span><br><span class="line">|-- tez-api</span><br><span class="line">|-- tez-common</span><br><span class="line">|-- tez-dag</span><br><span class="line">|-- tez-dist</span><br><span class="line">|-- tez-examples</span><br><span class="line">|-- tez-mapreduce</span><br><span class="line">|-- tez-plugins</span><br><span class="line">|-- tez-runtime-internals</span><br><span class="line">|-- tez-runtime-library</span><br><span class="line">|-- tez-tests</span><br><span class="line">|-- tez-tools</span><br><span class="line">`-- tez-ui</span><br><span class="line"></span><br><span class="line"># tar zcf apache-tez-0.7.0.tar.gz apache-tez-0.7.0-src</span><br><span class="line"># sz apache-tez-0.7.0.tar.gz</span><br></pre></td></tr></table></figure>
<p><code>总结：编译阶段不断重试，国内网络大家都懂，各种包下载不惜来，多重试几次就ok了</code></p>
<blockquote>
<p>Tez版本兼容情况<br><a href="https://cwiki.apache.org/confluence/display/TEZ/Version+Compatibility" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/TEZ/Version+Compatibility</a></p>
</blockquote>
<h1 id="二、tez-install"><a href="#二、tez-install" class="headerlink" title="二、tez install"></a>二、tez install</h1><h2 id="1、上传编译后的Tez的tarball到hdfs"><a href="#1、上传编译后的Tez的tarball到hdfs" class="headerlink" title="1、上传编译后的Tez的tarball到hdfs"></a>1、上传编译后的Tez的tarball到hdfs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># rz</span><br><span class="line">rz waiting to receive.</span><br><span class="line">¿ª&apos; zmodem ´«?¡£  °´ Ctrl+C ??¡£</span><br><span class="line">Transferring apache-tez-0.7.0.tar.gz...</span><br><span class="line">  100%  128772 KB 11706 KB/s 00:00:11       0 Errors</span><br><span class="line"></span><br><span class="line"># tar -zxvf apache-tez-0.7.0.tar.gz </span><br><span class="line"># cd tez-dist/target/</span><br><span class="line"># tree -L 2</span><br><span class="line">.</span><br><span class="line">|-- archive-tmp</span><br><span class="line">|-- maven-archiver</span><br><span class="line">|   `-- pom.properties</span><br><span class="line">|-- tez-0.7.0</span><br><span class="line">|   |-- lib</span><br><span class="line">|   |-- tez-api-0.7.0.jar</span><br><span class="line">|   |-- tez-common-0.7.0.jar</span><br><span class="line">|   |-- tez-dag-0.7.0.jar</span><br><span class="line">|   |-- tez-examples-0.7.0.jar</span><br><span class="line">|   |-- tez-mapreduce-0.7.0.jar</span><br><span class="line">|   |-- tez-mbeans-resource-calculator-0.7.0.jar</span><br><span class="line">|   |-- tez-runtime-internals-0.7.0.jar</span><br><span class="line">|   |-- tez-runtime-library-0.7.0.jar</span><br><span class="line">|   |-- tez-tests-0.7.0.jar</span><br><span class="line">|   |-- tez-ui-0.7.0.war</span><br><span class="line">|   |-- tez-yarn-timeline-history-0.7.0.jar</span><br><span class="line">|   `-- tez-yarn-timeline-history-with-acls-0.7.0.jar</span><br><span class="line">|-- tez-0.7.0-minimal.tar.gz</span><br><span class="line">|-- tez-0.7.0.tar.gz</span><br><span class="line">`-- tez-dist-0.7.0-tests.jar</span><br><span class="line"></span><br><span class="line"># ls apache-tez-0.7.0-src/tez-dist/target/</span><br><span class="line"> archive-tmp  maven-archiver  tez-0.7.0  tez-0.7.0-minimal.tar.gz  tez-0.7.0.tar.gz  tez-dist-0.7.0-tests.jar</span><br><span class="line"></span><br><span class="line"># hadoop version</span><br><span class="line">Hadoop 2.4.0</span><br><span class="line">Subversion Unknown -r Unknown</span><br><span class="line">Compiled by root on 2014-07-27T04:58Z</span><br><span class="line">Compiled with protoc 2.5.0</span><br><span class="line">From source with checksum 375b2832a6641759c6eaf6e3e998147</span><br><span class="line">This command was run using /usr/local/hadoop-2.4.0/share/hadoop/common/hadoop-common-2.4.0.jar</span><br><span class="line"></span><br><span class="line"># hadoop fs -mkdir -p /apps/tez-0.7.0</span><br><span class="line"># hadoop fs -copyFromLocal apache-tez-0.7.0-src/tez-dist/target/tez-0.7.0.tar.gz /apps/tez-0.7.0</span><br></pre></td></tr></table></figure>
<h2 id="2、解压tez部署包"><a href="#2、解压tez部署包" class="headerlink" title="2、解压tez部署包"></a>2、解压tez部署包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># tar -zxvf tez-0.7.0.tar.gz </span><br><span class="line"># cp apache-tez-0.7.0-src/tez-dist/target/tez-0.7.0.tar.gz . </span><br><span class="line"># mkdir tez-0.7.0  </span><br><span class="line"># tar zxf tez-0.7.0.tar.gz -C tez-0.7.0</span><br><span class="line"># ln -s tez-0.7.0 tez</span><br></pre></td></tr></table></figure>
<h2 id="3、配置环境变量"><a href="#3、配置环境变量" class="headerlink" title="3、配置环境变量"></a>3、配置环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export TEZ_HOME=/usr/local/tez</span><br><span class="line">export TEZ_CONF_DIR=$TEZ_HOME/conf</span><br><span class="line">export TEZ_JARS=$TEZ_HOME</span><br><span class="line"></span><br><span class="line">export HADOOP_CLASSPATH=$&#123;TEZ_CONF_DIR&#125;:$&#123;TEZ_JARS&#125;/*:$&#123;TEZ_JARS&#125;/lib/*</span><br></pre></td></tr></table></figure>
<h2 id="4、配置文件"><a href="#4、配置文件" class="headerlink" title="4、配置文件"></a>4、配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># mkdir tez/conf</span><br><span class="line"># cat tez/conf/tez-site.xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  &lt;name&gt;tez.lib.uris&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;$&#123;fs.defaultFS&#125;/apps/tez-0.7.0/tez-0.7.0.tar.gz&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h2 id="5、修改-mapred-site-xml"><a href="#5、修改-mapred-site-xml" class="headerlink" title="5、修改 mapred-site.xml"></a>5、修改 mapred-site.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">&lt;value&gt;yarn-tez&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h2 id="6、example-of-using-an-MRR-job-in-the-tez-examples-jar"><a href="#6、example-of-using-an-MRR-job-in-the-tez-examples-jar" class="headerlink" title="6、example of using an MRR job in the tez-examples.jar"></a>6、example of using an MRR job in the tez-examples.jar</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># hadoop fs -cat /testdata/external_table/external_teble  </span><br><span class="line">1       zhangsan</span><br><span class="line">2       lisi</span><br><span class="line">3       wanwu</span><br><span class="line">4       zhaoliu</span><br><span class="line">5       da</span><br><span class="line">6       abc</span><br><span class="line"></span><br><span class="line"># hadoop fs -put tez-0.7.0 /apps</span><br><span class="line"></span><br><span class="line"># hadoop jar tez-examples-0.7.0.jar orderedwordcount  /apps/tez-0.7.0/conf/tez-site.xml /output</span><br><span class="line">INFO client.TezClientUtils: Using tez.lib.uris value from configuration: hdfs://mycluster/apps/tez-0.7.0,hdfs://mycluster/apps/tez-0.7.0/lib/</span><br><span class="line">INFO client.DAGClientImpl: DAG initialized: CurrentState=Running</span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line">15/07/18 02:17:38 INFO examples.OrderedWordCount: DAG diagnostics: [Application application_1437156593890_0002 failed 2 times due to AM Container for appattempt_1437156593890_0002_000002 exited with  exitCode: 1 due to: Exception from container-launch: org.apache.hadoop.util.Shell$ExitCodeException: </span><br><span class="line">org.apache.hadoop.util.Shell$ExitCodeException: </span><br><span class="line">    at org.apache.hadoop.util.Shell.runCommand(Shell.java:505)</span><br><span class="line">    at org.apache.hadoop.util.Shell.run(Shell.java:418)</span><br><span class="line">    at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:650)</span><br><span class="line">    at org.apache.hadoop.yarn.server.nodemanager.DefaultContainerExecutor.launchContainer(DefaultContainerExecutor.java:195)</span><br><span class="line">    at org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.ContainerLaunch.call(ContainerLaunch.java:300)</span><br><span class="line">    at org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.ContainerLaunch.call(ContainerLaunch.java:81)</span><br><span class="line">    at java.util.concurrent.FutureTask.run(FutureTask.java:262)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:744)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Container exited with a non-zero exit code 1</span><br><span class="line">.Failing this attempt.. Failing the application.]</span><br></pre></td></tr></table></figure>
<h2 id="7、hive-on-tez"><a href="#7、hive-on-tez" class="headerlink" title="7、hive on tez"></a>7、hive on tez</h2><blockquote>
<p> hive版本说明：hive-0.14+</p>
</blockquote>
<h3 id="版本为hive-0-13-1和hadoop2-4测试失败"><a href="#版本为hive-0-13-1和hadoop2-4测试失败" class="headerlink" title="版本为hive-0.13.1和hadoop2.4测试失败"></a>版本为hive-0.13.1和hadoop2.4测试失败</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">修改hive的执行引擎为 Tez</span><br><span class="line"> &lt;property&gt;</span><br><span class="line">   &lt;name&gt;hive.execution.engine&lt;/name&gt;</span><br><span class="line">   &lt;value&gt;tez&lt;/value&gt;</span><br><span class="line"> &lt;/property&gt;</span><br><span class="line"></span><br><span class="line"># cp tez-0.7.0/tez-*.jar hive/lib/</span><br><span class="line"># cp tez-0.7.0/lib/* hive/lib/</span><br><span class="line"></span><br><span class="line">hive (default)&gt; set hive.execution.engine;      </span><br><span class="line">hive.execution.engine=mr</span><br><span class="line">hive (default)&gt; set hive.execution.engine=tez;  </span><br><span class="line">hive (default)&gt; select count(*) from order_test;</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Exception in thread &quot;Thread-6&quot; java.lang.NoSuchMethodError: org.apache.tez.mapreduce.hadoop.MRHelpers.updateEnvironmentForMRAM(Lorg/apache/hadoop/conf/Configuration;Ljava/util/Map;)V</span><br></pre></td></tr></table></figure>
<h3 id="升级hadoop版本为2-6-hive版本为1-2-1测试"><a href="#升级hadoop版本为2-6-hive版本为1-2-1测试" class="headerlink" title="升级hadoop版本为2.6,hive版本为1.2.1测试"></a>升级hadoop版本为2.6,hive版本为1.2.1测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">$ mv hadoop-2.6.0/share/hadoop/yarn/lib/jline-0.9.94.jar hadoop-2.6.0/share/hadoop/yarn/lib/jline-0.9.94.jar.bak  </span><br><span class="line"></span><br><span class="line">[hsu@server2 ~]$ hive</span><br><span class="line"></span><br><span class="line">Logging initialized using configuration in file:/home/hsu/apache-hive-1.2.1-bin/conf/hive-log4j.properties</span><br><span class="line">hive (default)&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">test</span><br><span class="line">Time taken: 2.33 seconds, Fetched: 1 row(s)</span><br><span class="line">hive (default)&gt; select * from test;</span><br><span class="line">OK</span><br><span class="line">test.id</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">Time taken: 0.648 seconds, Fetched: 3 row(s)</span><br><span class="line"></span><br><span class="line">hive (default)&gt; set hive.execution.engine;</span><br><span class="line">hive.execution.engine=tez</span><br><span class="line">hive (default)&gt; select count(*) from test;</span><br><span class="line">Query ID = hsu_20150813161742_a64d46a7-7349-41b3-be27-9a91bb490a8b</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Status: Running (Executing on YARN cluster with App id application_1439448136822_0002)</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Map 1 ..........   SUCCEEDED      1          1        0        0       0       0</span><br><span class="line">Reducer 2 ......   SUCCEEDED      1          1        0        0       0       0</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">VERTICES: 02/02  [==========================&gt;&gt;] 100%  ELAPSED TIME: 51.17 s    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line">3</span><br><span class="line">Time taken: 54.354 seconds, Fetched: 1 row(s)</span><br><span class="line"></span><br><span class="line">#队列使用</span><br><span class="line">set tez.queue.name=eda;</span><br><span class="line"></span><br><span class="line">hive (default)&gt;  set tez.queue.name=test;</span><br><span class="line">hive (default)&gt; select count(*) from test;</span><br><span class="line">Query ID = hsu_20150813162458_b0ce5d5f-09d2-40ae-8b6a-90f1f4cebe91</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Status: Running (Executing on YARN cluster with App id application_1439448136822_0003)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">        VERTICES      STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Map 1 ..........   SUCCEEDED      1          1        0        0       0       0</span><br><span class="line">Reducer 2 ......   SUCCEEDED      1          1        0        0       0       0</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">VERTICES: 02/02  [==========================&gt;&gt;] 100%  ELAPSED TIME: 32.71 s    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line">3</span><br><span class="line">Time taken: 84.191 seconds, Fetched: 1 row(s)</span><br><span class="line"></span><br><span class="line">hive (default)&gt; set hive.execution.engine;</span><br><span class="line">hive.execution.engine=tez</span><br><span class="line">hive (default)&gt; set hive.execution.engine=mr;</span><br><span class="line">hive (default)&gt; select count(*) from test;</span><br><span class="line">Query ID = hsu_20150813162723_31559eda-c8ab-4ca6-a445-b75afc908d28</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks determined at compile time: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1439448136822_0004, Tracking URL = http://server1:23188/proxy/application_1439448136822_0004/</span><br><span class="line">Kill Command = /home/hsu/hadoop/bin/hadoop job  -kill job_1439448136822_0004</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">2015-08-13 16:28:33,107 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2015-08-13 16:29:20,688 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 0.99 sec</span><br><span class="line">2015-08-13 16:29:49,215 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.27 sec</span><br><span class="line">MapReduce Total cumulative CPU time: 2 seconds 270 msec</span><br><span class="line">Ended Job = job_1439448136822_0004</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.27 sec   HDFS Read: 210 HDFS Write: 2 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 2 seconds 270 msec</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line">3</span><br><span class="line">Time taken: 148.332 seconds, Fetched: 1 row(s)</span><br></pre></td></tr></table></figure>
<ul>
<li><ol>
<li>hive on tez，直接配置hive支持tez，其实是在yarn上面启动一个app,这个app永久运行,接受不同sql，除非退出hive cli此app才会结束 </li>
</ol>
</li>
<li><ol start="2">
<li>可以通过tez提高的ui查看任务执行情况，需要单独配置tezUI！</li>
</ol>
</li>
<li><ol start="3">
<li>tez runing app在yarn上面和spark on yarn很类似，而且tez,spark底层原理也很相似！</li>
</ol>
</li>
<li><ol start="4">
<li>在切换队列时，会重启一个app运行！</li>
</ol>
</li>
<li><ol start="5">
<li>在切换底层为mr引擎的时候也会重启app运行，但是tez那个app也没结束，等待mr app运行结束后,两个一起结束！</li>
</ol>
</li>
</ul>
<p><img src="https://jikelab.github.io/tech-labs/screenshots/tez-demo.png" alt></p>
<h2 id="8、排查问题"><a href="#8、排查问题" class="headerlink" title="8、排查问题"></a>8、排查问题</h2><ul>
<li><p>1、取消所有tez依赖单独运行</p>
<ul>
<li>结论：可以成功运行yarn任务,断定是不兼容问题，由于我编译tez使用了2.6.0  </li>
<li>编译通过，而是用2.4.0的包编译失败！目前集群hadoop版本2.4.0！</li>
</ul>
</li>
<li><p>2、升级hadoop版本为2.6.0再次测试</p>
</li>
</ul>
<blockquote>
<p>   升级为2.6.0以后测试成功，说明tez兼容性还是比较差。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">$ hadoop jar /usr/local/tez/tez-examples-0.7.0.jar orderedwordcount  /apps/tez- 0.7.0/conf/tez-site.xml /output</span><br><span class="line">15/07/20 13:53:52 INFO client.TezClient: Tez Client Version: [ component=tez-   api, version=0.7.0, revision=$&#123;buildNumber&#125;, SCM-URL=scm:git:https://git-wip-us    .apache.org/repos/asf/tez.git, buildTime=20150718-0613 ]</span><br><span class="line">15/07/20 13:53:52 INFO client.RMProxy: Connecting to ResourceManager at itr-    mastertest01/192.168.2.200:8032</span><br><span class="line">15/07/20 13:54:13 INFO examples.OrderedWordCount: Running OrderedWordCount</span><br><span class="line">15/07/20 13:54:13 INFO client.TezClient: Submitting DAG application with id:    application_1437371604990_0001</span><br><span class="line">15/07/20 13:54:13 INFO client.TezClientUtils: Using tez.lib.uris value from     configuration: hdfs://mycluster/apps/tez-0.7.0,hdfs://mycluster/apps/tez-0.7.0/ lib/</span><br><span class="line">15/07/20 13:54:13 INFO client.TezClient: Stage directory /tmp/hsu/tez/staging   doesn&apos;t exist and is created</span><br><span class="line">15/07/20 13:54:14 INFO client.TezClient: Tez system stage directory hdfs:// mycluster/tmp/hsu/tez/staging/.tez/application_1437371604990_0001 doesn&apos;t    exist and is created</span><br><span class="line">15/07/20 13:54:14 INFO client.TezClient: Submitting DAG to YARN,    applicationId=application_1437371604990_0001, dagName=OrderedWordCount</span><br><span class="line">15/07/20 13:54:14 INFO impl.YarnClientImpl: Submitted application   application_1437371604990_0001</span><br><span class="line">15/07/20 13:54:14 INFO client.TezClient: The url to track the Tez AM: http://   server1:8088/proxy/application_1437371604990_0001/</span><br><span class="line">15/07/20 13:54:14 INFO client.RMProxy: Connecting to ResourceManager at itr-    mastertest01/192.168.2.200:8032</span><br><span class="line">15/07/20 13:54:15 INFO client.DAGClientImpl: Waiting for DAG to start running</span><br><span class="line">15/07/20 13:55:06 INFO client.DAGClientImpl: DAG initialized:   CurrentState=Running</span><br><span class="line">15/07/20 13:55:08 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:08 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:08 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:08 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:13 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:13 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:13 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:13 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:19 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:19 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:19 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:19 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:24 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:24 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:24 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:24 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:29 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:29 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:29 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:29 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:34 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:34 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:34 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:34 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:39 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:39 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:39 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:39 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:44 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:44 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:44 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:44 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:49 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:49 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:49 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:49 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:54 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:54 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:54 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:54 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:59 INFO client.DAGClientImpl: DAG: State: RUNNING Progress: 0%   TotalTasks: 3 Succeeded: 0 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:55:59 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:59 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:55:59 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:01 INFO client.DAGClientImpl: DAG: State: RUNNING Progress:  33.33% TotalTasks: 3 Succeeded: 1 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:01 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 100% TotalTasks: 1 Succeeded: 1 Running: 0 Failed: 0  Killed: 0</span><br><span class="line">15/07/20 13:56:01 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed:    0</span><br><span class="line">15/07/20 13:56:01 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:03 INFO client.DAGClientImpl: DAG: State: RUNNING Progress:  66.67% TotalTasks: 3 Succeeded: 2 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:03 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 100% TotalTasks: 1 Succeeded: 1 Running: 0 Failed: 0  Killed: 0</span><br><span class="line">15/07/20 13:56:03 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 100% TotalTasks: 1 Succeeded: 1 Running: 0 Failed: 0  Killed: 0</span><br><span class="line">15/07/20 13:56:03 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 0% TotalTasks: 1 Succeeded: 0 Running: 1 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:04 INFO client.DAGClientImpl: DAG: State: SUCCEEDED Progress:    100% TotalTasks: 3 Succeeded: 3 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:04 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Tokenizer Progress: 100% TotalTasks: 1 Succeeded: 1 Running: 0 Failed: 0  Killed: 0</span><br><span class="line">15/07/20 13:56:04 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Summation Progress: 100% TotalTasks: 1 Succeeded: 1 Running: 0 Failed: 0  Killed: 0</span><br><span class="line">15/07/20 13:56:04 INFO client.DAGClientImpl:    VertexStatus: VertexName:   Sorter Progress: 100% TotalTasks: 1 Succeeded: 1 Running: 0 Failed: 0 Killed: 0</span><br><span class="line">15/07/20 13:56:04 INFO client.DAGClientImpl: DAG completed. FinalState=SUCCEEDED</span><br></pre></td></tr></table></figure>
<p>$ hadoop jar tez-examples-0.7.0.jar orderedwordcount -DUSE_TEZ_SESSION=true /test /output</p>
<ul>
<li>3、 yarn底层替换为tez,hive直接执行，效果如下！<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[hsu@server1 ~]$ hive</span><br><span class="line">Logging initialized using configuration in file:/home/hsu/apache-hive-1.2.1-bin /conf/hive-log4j.properties</span><br><span class="line">hive (default)&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">test</span><br><span class="line">Time taken: 1.106 seconds, Fetched: 1 row(s)</span><br><span class="line">hive (default)&gt; select count(1) from test;</span><br><span class="line">Query ID = hsu_20150813170521_77b18935-4f38-4f84-8da7-6774b9aff194</span><br><span class="line">Total jobs = 1</span><br><span class="line">Launching Job 1 out of 1</span><br><span class="line">Number of reduce tasks determined at compile time: 1</span><br><span class="line">In order to change the average load for a reducer (in bytes):</span><br><span class="line">  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">In order to limit the maximum number of reducers:</span><br><span class="line">  set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">In order to set a constant number of reducers:</span><br><span class="line">  set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">Starting Job = job_1439456630574_0001, Tracking URL = http://itr-   mastertest01:23188/proxy/application_1439456630574_0001/</span><br><span class="line">Kill Command = /home/hsu/hadoop/bin/hadoop job  -kill job_1439456630574_0001</span><br><span class="line">Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 0</span><br><span class="line">2015-08-13 17:06:36,372 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">2015-08-13 17:07:26,923 Stage-1 map = 100%,  reduce = 100%</span><br><span class="line">Ended Job = job_1439456630574_0001</span><br><span class="line">MapReduce Jobs Launched: </span><br><span class="line">Stage-Stage-1:  HDFS Read: 0 HDFS Write: 0 SUCCESS</span><br><span class="line">Total MapReduce CPU Time Spent: 0 msec</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line">3</span><br><span class="line">Time taken: 126.726 seconds, Fetched: 1 row(s)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>注意：yarn页面：app tyep 直接变成TEZ，但是如上执行还是mr执行程序日志~！这里比较难理解具体是mr执行的还是tez执行的！还得去底层跟踪确认！</code></p>
<p> (1)、yarn mr替换为tez，hive不做任务配置，提交任务到yarn，效果如下图：</p>
<p><img src="https://jikelab.github.io/tech-labs/screenshots/yarn-tez-hive.png" alt></p>
<p> (2)、不同tez版本支持的hadoop版本需要对应<br> (3)、编译时，我手动制定hadoop.version它有回出现yarn模块兼容性编译通不过。而默认的它指定的hadoop版本可以成功编译！<br> (4)、tez从另一个方面讲还不算成熟！~<br> (5)、支持ResourceManager HA</p>
<ul>
<li>3、目前xxx on yarn模式情况</li>
</ul>
<blockquote>
<p> (1) tez on yarn模式主要是hdp在推,相信未来和yarn集成兼容性各种问题都能迎刃而解！</p>
</blockquote>
<blockquote>
<p> (2) spark engine on yarn模式，主要是cdh在推，目前已经完成合并到hive主干！</p>
</blockquote>
<p><code>ps：官网安装文档都说，自己可以修改hadoop.version进行编译，实际修改编译失败，比较费解，也说明tez的兼容性不好！</code></p>
<h1 id="9、tez-ui"><a href="#9、tez-ui" class="headerlink" title="9、tez ui"></a>9、tez ui</h1><h2 id="1-配置tez-site-xml"><a href="#1-配置tez-site-xml" class="headerlink" title="(1) 配置tez-site.xml"></a>(1) 配置tez-site.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ cat tez-site.xml         </span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;   </span><br><span class="line"></span><br><span class="line">  &lt;property&gt;        </span><br><span class="line">  &lt;name&gt;tez.lib.uris&lt;/name&gt;        </span><br><span class="line">  &lt;value&gt;$&#123;fs.defaultFS&#125;/apps/tez-0.7.0,$&#123;fs.defaultFS&#125;/apps/tez-0.7.0/lib/&lt;/value&gt;   </span><br><span class="line">  &lt;/property&gt;</span><br><span class="line"></span><br><span class="line"> &lt;property&gt;</span><br><span class="line">  &lt;description&gt;Enable Tez to use the Timeline Server for History Logging&lt;/description&gt;</span><br><span class="line">   &lt;name&gt;tez.history.logging.service.class&lt;/name&gt;</span><br><span class="line">   &lt;value&gt;org.apache.tez.dag.history.logging.ats.ATSHistoryLoggingService&lt;/value&gt;</span><br><span class="line"> &lt;/property&gt;</span><br><span class="line"></span><br><span class="line"> &lt;property&gt;</span><br><span class="line">  &lt;description&gt;URL for where the Tez UI is hosted&lt;/description&gt;</span><br><span class="line">  &lt;!--tomcat 9999 端口--&gt;</span><br><span class="line">  &lt;name&gt;tez.tez-ui.history-url.base&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;http://server2:9999/tez-ui/&lt;/value&gt;</span><br><span class="line"> &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;description&gt;Publish configuration information to Timeline server.&lt;/description&gt;</span><br><span class="line">    &lt;name&gt;tez.runtime.convert.user-payload.to.history-text&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;tez.task.generate.counters.per.io&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2-配置yarn-site-xml"><a href="#2-配置yarn-site-xml" class="headerlink" title="(2) 配置yarn-site.xml"></a>(2) 配置yarn-site.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;description&gt;Indicate to clients whether Timeline service is enabled or not. If enabled, the TimelineClient library used by end-users will post entities and events to the Timeline server.&lt;/description&gt;</span><br><span class="line">  &lt;name&gt;yarn.timeline-service.enabled&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;description&gt;The hostname of the Timeline service web application.&lt;/description&gt;</span><br><span class="line">  &lt;name&gt;yarn.timeline-service.hostname&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;server2&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;description&gt;Enables cross-origin support (CORS) for web services where cross-origin web response headers are needed. For example, javascript making a web services request to the timeline server.&lt;/description&gt;</span><br><span class="line">  &lt;name&gt;yarn.timeline-service.http-cross-origin.enabled&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;description&gt;Publish YARN information to Timeline Server&lt;/description&gt;</span><br><span class="line">  &lt;name&gt;yarn.resourcemanager.system-metrics-publisher.enabled&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">      &lt;property&gt;</span><br><span class="line">       &lt;description&gt;The http address of the Timeline service web application.&lt;/description&gt;</span><br><span class="line">       &lt;name&gt;yarn.timeline-service.webapp.address&lt;/name&gt;</span><br><span class="line">       &lt;value&gt;$&#123;yarn.timeline-service.hostname&#125;:8188&lt;/value&gt;</span><br><span class="line">     &lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">   &lt;description&gt;The https address of the Timeline service web application.&lt;/description&gt;</span><br><span class="line">  &lt;name&gt;yarn.timeline-service.webapp.https.address&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;$&#123;yarn.timeline-service.hostname&#125;:2191&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-启动hadoop-timeline"><a href="#3-启动hadoop-timeline" class="headerlink" title="(3) 启动hadoop timeline"></a>(3) 启动hadoop timeline</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hsu@server2 hadoop]$ yarn-daemon.sh start timelineserver</span><br><span class="line"></span><br><span class="line">[hsu@server2 ~]$ lsof -i :8188</span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java    7189  hsu  281u  IPv6  71981      0t0  TCP server2:8188 (LISTEN)</span><br></pre></td></tr></table></figure>
<h2 id="4-tez-ui-war包解压放到tomcat的webapps下"><a href="#4-tez-ui-war包解压放到tomcat的webapps下" class="headerlink" title="(4) tez ui war包解压放到tomcat的webapps下"></a>(4) tez ui war包解压放到tomcat的webapps下</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## 在server2上部署tomcat</span><br><span class="line"></span><br><span class="line">$ tar -zxvf apache-tomcat-8.0.24.tar.gz </span><br><span class="line">[hsu@server2 ~]$ ln -s apache-tomcat-8.0.24 tomcat</span><br><span class="line"></span><br><span class="line">[hsu@server2 ~]$ cp /usr/local/tez/tez-ui-0.7.0.war ./tomcat/webapps/</span><br><span class="line"></span><br><span class="line">[hsu@server2 webapps]$ mkdir tez-ui           </span><br><span class="line">[hsu@server2 webapps]$ mv tez-ui-0.7.0.war tez-ui/</span><br><span class="line"></span><br><span class="line">[hsu@server2 webapps]$ cd tez-ui/</span><br><span class="line">[hsu@server2 tez-ui]$ jar xvf tez-ui-0.7.0.war </span><br><span class="line"></span><br><span class="line">## 配置scripts/config.js文件</span><br><span class="line"></span><br><span class="line">--Configuring the Timeline Server URL and Resource Manager UI URL </span><br><span class="line"> </span><br><span class="line"> timelineBaseUrl: &apos;http://server1:8188&apos;,</span><br><span class="line"> RMWebUrl: &apos;http://server1:23188&apos;,</span><br></pre></td></tr></table></figure>
<h2 id="5-启动tomcat"><a href="#5-启动tomcat" class="headerlink" title="(5) 启动tomcat"></a>(5) 启动tomcat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[hsu@server2 ~]$ tomcat/bin/startup.sh </span><br><span class="line">Using CATALINA_BASE:   /home/hsu/tomcat</span><br><span class="line">Using CATALINA_HOME:   /home/hsu/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /home/hsu/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr/local/jdk1.7.0_45</span><br><span class="line">Using CLASSPATH:       /home/hsu/tomcat/bin/bootstrap.jar:/home/hsu/tomcat/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br><span class="line"></span><br><span class="line">#修改端口为9999</span><br><span class="line">[hsu@server2 ~]$ tomcat/bin/shutdown.sh </span><br><span class="line">Using CATALINA_BASE:   /home/hsu/tomcat</span><br><span class="line">Using CATALINA_HOME:   /home/hsu/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /home/hsu/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr/local/jdk1.7.0_45</span><br><span class="line">Using CLASSPATH:       /home/hsu/tomcat/bin/bootstrap.jar:/home/hsu/tomcat/bin/tomcat-juli.jar</span><br><span class="line"></span><br><span class="line">[hsu@server2 ~]$ tomcat/bin/startup.sh </span><br><span class="line">[hsu@server2 ~]$ lsof -i :9999          </span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java    7824  hsu   43u  IPv6  75557      0t0  TCP *:distinct (LISTEN)</span><br></pre></td></tr></table></figure>
<h2 id="6-验证"><a href="#6-验证" class="headerlink" title="(6) 验证"></a>(6) 验证</h2><p>1、webui验证：<a href="http://server2:9999/tez-ui/" target="_blank" rel="noopener">http://server2:9999/tez-ui/</a> </p>
<p><img src="https://jikelab.github.io/tech-labs/screenshots/tez-runting.png" alt="tez-runing"><br><img src="https://jikelab.github.io/tech-labs/screenshots/tez-runting_dag.png" alt="tez-runting_dag"></p>
<p>2、后台执行sql验证前台</p>
<p><code>注意：resourcemanager节点必须为timelineserver配置的节点,如果RS配置HA的需要特别注意！</code></p>
<h1 id="hive-2-0-1-and-tez-0-7-1-兼容性问题"><a href="#hive-2-0-1-and-tez-0-7-1-兼容性问题" class="headerlink" title="hive 2.0.1 and tez 0.7.1 兼容性问题"></a>hive 2.0.1 and tez 0.7.1 兼容性问题</h1><p> 1、整合hive 2.0.1 and tez 0.7.1发现一些class包没用被加载，提示是没用找到类。<br> 2、通过降低hive版本为 1.2.1发现没用任何问题，可以正常执行tez任务！<br> 3、社区查看hive2.0.1依赖的tez版本是0.8.3，打算重新手动编译在测试是否可行，待验证。<br> 4、这一点可以说明tez这个包各个版本直接接口的兼容性非常差，导致升级代价大，难以维护！</p>
<p>参考：<a href="http://zh.hortonworks.com/hadoop-tutorial/supercharging-interactive-queries-hive-tez/" target="_blank" rel="noopener">http://zh.hortonworks.com/hadoop-tutorial/supercharging-interactive-queries-hive-tez/</a></p>
<p><a href="http://tez.apache.org/tez-ui.html" target="_blank" rel="noopener">http://tez.apache.org/tez-ui.html</a></p>
<p><a href="http://zh.hortonworks.com/blog/evaluating-hive-with-tez-as-a-fast-query-engine" target="_blank" rel="noopener">http://zh.hortonworks.com/blog/evaluating-hive-with-tez-as-a-fast-query-engine</a></p>
<p><a href="http://tez.apache.org/install.html" target="_blank" rel="noopener">http://tez.apache.org/install.html</a></p>
<p>原创文章，转载请注明： 转载自<a href="http://www.itweet.cn" target="_blank" rel="noopener">Itweet</a>的博客<br><code>本博客的文章集合:</code> <a href="http://www.itweet.cn/blog/archive/" target="_blank" rel="noopener">http://www.itweet.cn/blog/archive/</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/Tez/">Tez</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2015/07/21/presto-use/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">presto-use</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2015/07/18/drill-use/">
        <span class="next-text nav-default">drill-use</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
