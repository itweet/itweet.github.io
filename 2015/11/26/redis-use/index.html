<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="redis use">




  <meta name="keywords" content="redis,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2015/11/26/redis-use/">


<meta name="description" content="优点：   1、丰富的数据存储类型(string,list,set,zset)  2、丰富的操作方式，都是原子性！ 3、支持主从同步 4、与memcached不同可持久化缓存数据 5、redis提供python,ruby,erlang,php客户端，使用方便   性能：   1、redis支持超过100k+每秒的读写频率 2、丰富的数据类型：redis支持二进制的strings,Lists,Ha">
<meta name="keywords" content="redis">
<meta property="og:type" content="article">
<meta property="og:title" content="redis use">
<meta property="og:url" content="http://itweet.github.io/2015/11/26/redis-use/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="优点：   1、丰富的数据存储类型(string,list,set,zset)  2、丰富的操作方式，都是原子性！ 3、支持主从同步 4、与memcached不同可持久化缓存数据 5、redis提供python,ruby,erlang,php客户端，使用方便   性能：   1、redis支持超过100k+每秒的读写频率 2、丰富的数据类型：redis支持二进制的strings,Lists,Ha">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-25T14:39:06.109Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis use">
<meta name="twitter:description" content="优点：   1、丰富的数据存储类型(string,list,set,zset)  2、丰富的操作方式，都是原子性！ 3、支持主从同步 4、与memcached不同可持久化缓存数据 5、redis提供python,ruby,erlang,php客户端，使用方便   性能：   1、redis支持超过100k+每秒的读写频率 2、丰富的数据类型：redis支持二进制的strings,Lists,Ha">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b75d841b3068f7782eac9af2c8c866e7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154998721-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154998721-1');
</script>


    <title> redis use - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          redis use
        
      </h1>

      <time class="post-time">
          11月 26 2015
      </time>
    </header>



    
            <div class="post-content">
            <blockquote>
<p>优点：</p>
</blockquote>
<ul>
<li>1、丰富的数据存储类型(string,list,set,zset) </li>
<li>2、丰富的操作方式，都是原子性！</li>
<li>3、支持主从同步</li>
<li>4、与memcached不同可持久化缓存数据</li>
<li>5、redis提供python,ruby,erlang,php客户端，使用方便</li>
</ul>
<blockquote>
<p>性能：</p>
</blockquote>
<ul>
<li>1、redis支持超过100k+每秒的读写频率</li>
<li>2、丰富的数据类型：redis支持二进制的strings,Lists,Hashes,Sets与Ordered Sets</li>
<li>3、原子：Redis的所有操作都是原子性的，同时redis还支持几个操作合并后的原子性</li>
<li>执行</li>
<li>4、丰富的特性：Redis还支持publish/pubscribe,订阅发布功能，通知，key过期等等<br>   特性</li>
<li>5、redis支持多机主从同步</li>
</ul>
<blockquote>
<p>redis最佳应用场景：</p>
</blockquote>
<ul>
<li>全部数据in-memory</li>
<li>更多场景作为memcached的替代品</li>
<li>当需要除k,v之外更多数据类型支持时，选择redis更加合适</li>
<li>down机重启数据还可以继续</li>
<li>需要负载均衡的场景(redis主从同步)</li>
</ul>
<blockquote>
<p>业务场景</p>
</blockquote>
<ul>
<li>1、使用Redis bitmap进行活跃用户统计</li>
<li>2、strom流计算的top结果</li>
</ul>
<h1 id="install-redis"><a href="#install-redis" class="headerlink" title="install redis"></a>install redis</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">whoami@ubuntu:~$ wget http://download.redis.io/releases/redis-3.0.5.tar.gz</span><br><span class="line">whoami@ubuntu:~$ tar -zxvf redis-3.0.5.tar.gz</span><br><span class="line">whoami@ubuntu:~$ cd redis-3.0.5/</span><br><span class="line"></span><br><span class="line">whoami@ubuntu:~/redis-3.0.5$ make</span><br><span class="line">  make[1]: Leaving directory `/home/whoami/redis-3.0.5/src&apos;</span><br></pre></td></tr></table></figure>
<h1 id="Starting-Redis"><a href="#Starting-Redis" class="headerlink" title="Starting Redis"></a>Starting Redis</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">whoami@ubuntu:~/redis-3.0.5$ nohup src/redis-server &gt; redis-server.log &amp;</span><br><span class="line"></span><br><span class="line">whoami@ubuntu:~/redis-3.0.5$ src/redis-cli</span><br><span class="line">127.0.0.1:6379&gt; set name &quot;whoami&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;whoami&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; help get</span><br><span class="line"></span><br><span class="line">  GET key</span><br><span class="line">  summary: Get the value of a key</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: string</span><br><span class="line"></span><br><span class="line">#设置超时时间</span><br><span class="line">127.0.0.1:6379&gt; set name &apos;rain&apos; Ex 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;rain&quot;</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;rain&quot;</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<h1 id="python-install-redis-model"><a href="#python-install-redis-model" class="headerlink" title="python install redis model"></a>python install redis model</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">whoami@ubuntu:~/redis-3.0.5$ sudo pip install redis</span><br><span class="line">Downloading/unpacking redis</span><br><span class="line">  Downloading redis-2.10.5-py2.py3-none-any.whl (60kB): 60kB downloaded</span><br><span class="line">Installing collected packages: redis</span><br><span class="line">Successfully installed redis</span><br><span class="line">Cleaning up...</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; import redis</span><br><span class="line">&gt;&gt;&gt; conn = redis.Redis(&apos;localhost&apos;)</span><br><span class="line">&gt;&gt;&gt; conn.set(&apos;name&apos;,&apos;whoami&apos;)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; conn.get(&apos;name&apos;)</span><br><span class="line">&apos;whoami&apos;</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env python</span><br><span class="line"># coding: utf-8</span><br><span class="line">__author__ = &apos;whoami&apos;</span><br><span class="line"></span><br><span class="line">#redis_test.py</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@version: 1.0</span><br><span class="line">@author: whoami</span><br><span class="line">@license: Apache Licence 2.0</span><br><span class="line">@contact: skynetEye@gmail.com</span><br><span class="line">@site: http://www.itweet.cn</span><br><span class="line">@software: PyCharm Community Edition</span><br><span class="line">@file: redis_test.py</span><br><span class="line">@time: 2015-11-25 下午10:51</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import redis</span><br><span class="line"></span><br><span class="line">conn = redis.Redis(host=&apos;localhost&apos;,port=6379,db=0,password=None)</span><br><span class="line"></span><br><span class="line">conn.set(&apos;name&apos;,&apos;whoami&apos;)</span><br><span class="line"></span><br><span class="line">print conn.get(&apos;name&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="Pub-Sub"><a href="#Pub-Sub" class="headerlink" title="Pub/Sub"></a>Pub/Sub</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">http://redis.io/topics/pubsub</span><br><span class="line"></span><br><span class="line">RedisHelper.py</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line"># coding: utf-8</span><br><span class="line">__author__ = &apos;whoami&apos;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@version: 1.0</span><br><span class="line">@author: whoami</span><br><span class="line">@license: Apache Licence 2.0</span><br><span class="line">@contact: skynetEye@gmail.com</span><br><span class="line">@site: http://www.itweet.cn</span><br><span class="line">@software: PyCharm Community Edition</span><br><span class="line">@file: RedisHelper.py</span><br><span class="line">@time: 2015-11-25 下午11:11</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import redis</span><br><span class="line"></span><br><span class="line">class RedisHelper:</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.__conn = redis.Redis(host=&apos;127.0.0.1&apos;)</span><br><span class="line">        self.chan_sub = &apos;fm87.7&apos;</span><br><span class="line">        self.chan_pub = &apos;fm87.7&apos;</span><br><span class="line"></span><br><span class="line">    def get(self,key):</span><br><span class="line">        return self.__conn.get(key)</span><br><span class="line"></span><br><span class="line">    def set(self,key,value):</span><br><span class="line">        return self.__conn.set(key,value)</span><br><span class="line"></span><br><span class="line">    def public(self,msg):</span><br><span class="line">        self.__conn.publish(self.chan_pub,msg)</span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line">    def subscribe(self):</span><br><span class="line">        pub = self.__conn.pubsub()</span><br><span class="line">        pub.subscribe(self.chan_sub)</span><br><span class="line">        pub.parse_response()</span><br><span class="line">        return pub</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    t = RedisHelper()</span><br><span class="line">    t.public(&apos;test&apos;)</span><br><span class="line"></span><br><span class="line">#测试订阅发布功能</span><br><span class="line">whoami@ubuntu:~/py/demo/day8$ python RedisHelper.py</span><br><span class="line"></span><br><span class="line">#此时收不到消息，因为是实时的，只有开启此频道，在发送才能接受到消息</span><br><span class="line">whoami@ubuntu:~/py/demo/day8$ python</span><br><span class="line">Python 2.7.6 (default, Jun 22 2015, 17:58:13) </span><br><span class="line">[GCC 4.8.2] on linux2</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; import tab,RedisHelper</span><br><span class="line">&gt;&gt;&gt; r = RedisHelper.RedisHelper()</span><br><span class="line">&gt;&gt;&gt; recv = r.subscribe()</span><br><span class="line">&gt;&gt;&gt; recv.parse_response()  #这一步的时候在发送就会不断收到客户端发送过来的消息</span><br><span class="line">&gt;&gt;&gt; recv.parse_response()  #阻塞模式，没有数据就阻塞，有数据就返回</span><br><span class="line">[&apos;message&apos;, &apos;fm87.7&apos;, &apos;test&apos;]</span><br><span class="line">&gt;&gt;&gt; recv.parse_response()</span><br><span class="line">[&apos;message&apos;, &apos;fm87.7&apos;, &apos;test1&apos;]</span><br><span class="line">&gt;&gt;&gt; recv.parse_response()</span><br><span class="line">[&apos;message&apos;, &apos;fm87.7&apos;, &apos;test2&apos;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; recv.get_message()  #非阻塞，如果没有消息立即返回，有消息立即处理</span><br><span class="line">&#123;&apos;pattern&apos;: None, &apos;type&apos;: &apos;message&apos;, &apos;channel&apos;: &apos;fm87.7&apos;, &apos;data&apos;: &apos;whoami&apos;&#125;</span><br><span class="line"></span><br><span class="line">===========================================================================</span><br><span class="line">++++++++++++++++https://pypi.python.org/pypi/redis/2.10.5++++++++++++++++++</span><br><span class="line">Publish / Subscribe</span><br><span class="line">redis-py includes a PubSub object that subscribes to channels and listens for new messages. Creating a PubSub object is easy.</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; r = redis.StrictRedis(...)</span><br><span class="line">&gt;&gt;&gt; p = r.pubsub()</span><br><span class="line">Once a PubSub instance is created, channels and patterns can be subscribed to.</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; p.subscribe(&apos;my-first-channel&apos;, &apos;my-second-channel&apos;, ...)</span><br><span class="line">&gt;&gt;&gt; p.psubscribe(&apos;my-*&apos;, ...)</span><br><span class="line">The PubSub instance is now subscribed to those channels/patterns. The subscription confirmations can be seen by reading messages from the PubSub instance.</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; p.get_message()</span><br><span class="line">&#123;&apos;pattern&apos;: None, &apos;type&apos;: &apos;subscribe&apos;, &apos;channel&apos;: &apos;my-second-channel&apos;, &apos;data&apos;: 1L&#125;</span><br><span class="line">&gt;&gt;&gt; p.get_message()</span><br><span class="line">&#123;&apos;pattern&apos;: None, &apos;type&apos;: &apos;subscribe&apos;, &apos;channel&apos;: &apos;my-first-channel&apos;, &apos;data&apos;: 2L&#125;</span><br><span class="line">&gt;&gt;&gt; p.get_message()</span><br><span class="line">&#123;&apos;pattern&apos;: None, &apos;type&apos;: &apos;psubscribe&apos;, &apos;channel&apos;: &apos;my-*&apos;, &apos;data&apos;: 3L&#125;</span><br><span class="line">Every message read from a PubSub instance will be a dictionary with the following keys.</span><br><span class="line"></span><br><span class="line">type: One of the following: ‘subscribe’, ‘unsubscribe’, ‘psubscribe’, ‘punsubscribe’, ‘message’, ‘pmessage’</span><br><span class="line">channel: The channel [un]subscribed to or the channel a message was published to</span><br><span class="line">pattern: The pattern that matched a published message’s channel. Will be None in all cases except for ‘pmessage’ types.</span><br><span class="line">data: The message data. With [un]subscribe messages, this value will be the number of channels and patterns the connection is currently subscribed to. With [p]message messages, this value will be the actual published message.</span><br><span class="line">===========================================================================</span><br></pre></td></tr></table></figure>
<h1 id="list"><a href="#list" class="headerlink" title="list"></a>list</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPUSH list &apos;whoami&apos; &apos;root&apos;</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 2</span><br><span class="line">1) &quot;root&quot;</span><br><span class="line">2) &quot;whoami&quot;</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 1 2</span><br><span class="line">1) &quot;whoami&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; RPUSH list &apos;rain&apos; &apos;boot&apos;</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 4</span><br><span class="line">1) &quot;root&quot;</span><br><span class="line">2) &quot;whoami&quot;</span><br><span class="line">3) &quot;rain&quot;</span><br><span class="line">4) &quot;boot&quot;</span><br><span class="line"></span><br><span class="line"># 持久化数据到磁盘</span><br><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line">127.0.0.1:6379&gt; help save</span><br><span class="line"></span><br><span class="line">  SAVE -</span><br><span class="line">  summary: Synchronously save the dataset to disk</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: server</span><br></pre></td></tr></table></figure>
<h1 id="Command-Test"><a href="#Command-Test" class="headerlink" title="Command Test"></a>Command Test</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">$ less README</span><br><span class="line"></span><br><span class="line">$ src/redis-benchmark </span><br><span class="line">====== PING_INLINE ======</span><br><span class="line">  100000 requests completed in 0.97 seconds</span><br><span class="line">  50 parallel clients</span><br><span class="line">  3 bytes payload</span><br><span class="line">  keep alive: 1</span><br><span class="line"></span><br><span class="line">99.49% &lt;= 1 milliseconds</span><br><span class="line">100.00% &lt;= 1 milliseconds</span><br><span class="line">102669.41 requests per second</span><br><span class="line">====== MSET (10 keys) ======</span><br><span class="line">  100000 requests completed in 1.78 seconds</span><br><span class="line">  50 parallel clients</span><br><span class="line">  3 bytes payload</span><br><span class="line">  keep alive: 1</span><br><span class="line"></span><br><span class="line">85.98% &lt;= 1 milliseconds</span><br><span class="line">98.14% &lt;= 2 milliseconds</span><br><span class="line">99.32% &lt;= 3 milliseconds</span><br><span class="line">99.95% &lt;= 4 milliseconds</span><br><span class="line">99.95% &lt;= 11 milliseconds</span><br><span class="line">99.95% &lt;= 15 milliseconds</span><br><span class="line">100.00% &lt;= 15 milliseconds</span><br><span class="line">56053.81 requests per second</span><br><span class="line"></span><br><span class="line">$ src/redis-</span><br><span class="line">redis-benchmark   </span><br><span class="line">redis-check-aof   </span><br><span class="line">redis-check-dump  </span><br><span class="line">redis-cli         </span><br><span class="line">redis-sentinel    </span><br><span class="line">redis-server      </span><br><span class="line">redis-trib.rb     </span><br><span class="line"></span><br><span class="line"># help redis server</span><br><span class="line">$ redis-server --help</span><br><span class="line"></span><br><span class="line"># starting redis</span><br><span class="line">$ export PATH=/home/whoami/redis-3.0.5/src</span><br><span class="line"></span><br><span class="line">$ which redis-server</span><br><span class="line">~/redis-3.0.5/src/redis-server</span><br><span class="line"></span><br><span class="line">$ redis-server </span><br><span class="line">  WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &apos;vm.overcommit_memory = 1&apos; to /etc/sysctl.conf and then reboot or run the command &apos;sysctl vm.overcommit_memory=1&apos; for this to take effect.</span><br><span class="line">  </span><br><span class="line">  WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &apos;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&apos; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span><br><span class="line">  </span><br><span class="line">  WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line"></span><br><span class="line">    $ sudo sysctl vm.overcommit_memory=1</span><br><span class="line">    # echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">    # echo 511 &gt; /proc/sys/net/core/somaxconn  </span><br><span class="line">    </span><br><span class="line">    $ lsof -i :6379</span><br><span class="line">    redis-ser 4487 whoami    4u  IPv6  20311      0t0  TCP *:6379 (LISTEN)</span><br><span class="line"></span><br><span class="line">    -- $ killall redis-server</span><br><span class="line">    $ src/redis-cli shutdown</span><br><span class="line">    $ lsof -i :6379         </span><br><span class="line">    [1]+  Done                    src/redis-server</span><br><span class="line"></span><br><span class="line"># redis cli</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ redis-cli </span><br><span class="line">127.0.0.1:6379&gt; KEYS *</span><br><span class="line">1) &quot;key:__rand_int__&quot;</span><br><span class="line">2) &quot;mylist&quot;</span><br><span class="line">3) &quot;counter:__rand_int__&quot;</span><br><span class="line"></span><br><span class="line"># starting redis &amp;&amp; Test redis</span><br><span class="line"># 交互方式一</span><br><span class="line">$ src/redis-cli --help</span><br><span class="line">$ src/redis-cli -h localhost -p 6379 </span><br><span class="line">localhost:6379&gt; help @string</span><br><span class="line">localhost:6379&gt; help get</span><br><span class="line"></span><br><span class="line">  GET key</span><br><span class="line">  summary: Get the value of a key</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: string</span><br><span class="line"></span><br><span class="line">localhost:6379&gt; set whoami beijing</span><br><span class="line">OK</span><br><span class="line">localhost:6379&gt; get whoami</span><br><span class="line">&quot;beijing&quot;</span><br><span class="line"></span><br><span class="line">#交互方式二</span><br><span class="line">$ src/redis-cli -h localhost -p 6379 set whoami shanghai</span><br><span class="line">OK</span><br><span class="line">$ src/redis-cli -h localhost -p 6379 get whoami</span><br><span class="line">&quot;shanghai&quot;</span><br><span class="line"></span><br><span class="line">$ src/redis-cli -h localhost -p 6379 del whoami</span><br><span class="line">(integer) 1</span><br><span class="line">$ src/redis-cli -h localhost -p 6379 get whoami</span><br><span class="line">(nil)</span><br><span class="line"></span><br><span class="line">$ telnet 127.0.0.1 6379</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is &apos;^]&apos;.</span><br><span class="line">set whoami beijing</span><br><span class="line">+OK</span><br><span class="line">get whoami</span><br><span class="line">$7</span><br><span class="line">beijing</span><br><span class="line">^]</span><br><span class="line">telnet&gt; quit</span><br><span class="line">Connection closed.</span><br><span class="line"></span><br><span class="line"># 多数据类型</span><br><span class="line">1、字符串，值可以是任何种类的字符串(包括二进制)，列如可以在一个键下面保存一副图片，值得长度不能超过1G!</span><br><span class="line">$ src/redis-cli set mykey &apos;my binary safe value&apos;</span><br><span class="line">OK</span><br><span class="line">$ src/redis-cli get mykey</span><br><span class="line">&quot;my binary safe value&quot;</span><br><span class="line"></span><br><span class="line">1.1、counter incr自增命令</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli set counter 100</span><br><span class="line">OK</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli incr counter</span><br><span class="line">(integer) 101</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli incr counter</span><br><span class="line">(integer) 102</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli incr counter</span><br><span class="line">(integer) 103</span><br><span class="line"></span><br><span class="line">2、列表类型</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli rpush message &apos;Hello how are you?&apos;</span><br><span class="line">(integer) 1</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli rpush message &apos;Hello how are you?&apos;</span><br><span class="line">(integer) 1</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli rpush message &apos;who am i ?&apos;        </span><br><span class="line">(integer) 2</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli rpush message &apos;this is the...&apos;</span><br><span class="line">(integer) 3</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli lrange message 0 2</span><br><span class="line">1) &quot;Hello how are you?&quot;</span><br><span class="line">2) &quot;who am i ?&quot;</span><br><span class="line">3) &quot;this is the...&quot;</span><br><span class="line"></span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli lrange message 0 1</span><br><span class="line">1) &quot;Hello how are you?&quot;</span><br><span class="line">2) &quot;who am i ?&quot;</span><br><span class="line"></span><br><span class="line">3、集合</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli sadd myset a</span><br><span class="line">(integer) 1</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli sadd myset b</span><br><span class="line">(integer) 1</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli sadd myset c</span><br><span class="line">(integer) 1</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli smembers myset</span><br><span class="line">1) &quot;b&quot;</span><br><span class="line">2) &quot;a&quot;</span><br><span class="line">3) &quot;c&quot;</span><br><span class="line"></span><br><span class="line">4、常见5种数据类型</span><br><span class="line">  - string 字符串</span><br><span class="line">  - hash 哈希</span><br><span class="line">  - list 列表数据</span><br><span class="line">  - set 集合</span><br><span class="line">  - sorted set 排序集合</span><br></pre></td></tr></table></figure>
<h1 id="redis配置文件"><a href="#redis配置文件" class="headerlink" title="redis配置文件"></a>redis配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ cat redis.conf |grep 16</span><br><span class="line"># bind 192.168.1.100 10.0.0.1</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line">#保存数据到disk</span><br><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line">#</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
<h1 id="主从同步"><a href="#主从同步" class="headerlink" title="主从同步"></a>主从同步</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">---启动主库</span><br><span class="line">$ src/redis-server ../redis-3.0.5/redis.conf &amp;</span><br><span class="line"></span><br><span class="line">---slave配置</span><br><span class="line">yum install gcc</span><br><span class="line">[whoami@server1 ~]$ wget http://download.redis.io/releases/redis-3.0.5.tar.gz</span><br><span class="line">[whoami@server1 ~]$ tar -zxvf redis-3.0.5.tar.gz</span><br><span class="line">[whoami@server1 ~]$ cd redis-3.0.5</span><br><span class="line">[whoami@server1 redis-3.0.5]$ make PREFIX=/home/whoami/redis install          </span><br><span class="line">cd src &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">[whoami@server1 redis-3.0.5]$ mkdir /home/whoami/redis/conf</span><br><span class="line"></span><br><span class="line">[whoami@server1 redis-3.0.5]$ cd /home/whoami/redis/conf/</span><br><span class="line"></span><br><span class="line">[whoami@server1 conf]$ cat redis.conf |grep slaveof</span><br><span class="line"># Master-Slave replication. Use slaveof to make a Redis instance a copy of</span><br><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">slaveof 192.168.2.125 6379</span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line"></span><br><span class="line">#关闭防火墙</span><br><span class="line">[whoami@server1 conf]$ /etc/init.d/network stop</span><br><span class="line"></span><br><span class="line">#启动从库</span><br><span class="line">[whoami@server1 redis]$ ../redis/bin/redis-server /home/whoami/redis/conf/redis.conf &amp;</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">                                    从库信息</span><br><span class="line">5306:S 02 Jan 18:37:05.235 * Connecting to MASTER 192.168.2.125:6379</span><br><span class="line">5306:S 02 Jan 18:37:05.235 * MASTER &lt;-&gt; SLAVE sync started</span><br><span class="line">5306:S 02 Jan 18:37:05.238 * Non blocking connect for SYNC fired the event.</span><br><span class="line">5306:S 02 Jan 18:37:05.238 * Master replied to PING, replication can continue...</span><br><span class="line">5306:S 02 Jan 18:37:05.238 * Partial resynchronization not possible (no cached master)</span><br><span class="line">5306:S 02 Jan 18:37:05.266 * Full resync from master: 56fcc0b35ec0a8b0bcfb4c8929d2b82ebe6c0c55:1</span><br><span class="line">5306:S 02 Jan 18:37:05.396 * MASTER &lt;-&gt; SLAVE sync: receiving 400209 bytes from master</span><br><span class="line">5306:S 02 Jan 18:37:05.408 * MASTER &lt;-&gt; SLAVE sync: Flushing old data</span><br><span class="line">5306:S 02 Jan 18:37:05.409 * MASTER &lt;-&gt; SLAVE sync: Loading DB in memory</span><br><span class="line">5306:S 02 Jan 18:37:05.448 * MASTER &lt;-&gt; SLAVE sync: Finished with success</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">                                  主库信息</span><br><span class="line">1469:M 02 Jan 17:54:52.913 * DB loaded from disk: 0.029 seconds</span><br><span class="line">1469:M 02 Jan 17:54:52.913 * The server is now ready to accept connections on port 6379</span><br><span class="line">1469:M 02 Jan 18:20:49.134 * Slave 192.168.2.200:6379 asks for synchronization</span><br><span class="line">1469:M 02 Jan 18:20:49.134 * Full resync requested by slave 192.168.2.200:6379</span><br><span class="line">1469:M 02 Jan 18:20:49.134 * Starting BGSAVE for SYNC with target: disk</span><br><span class="line">1469:M 02 Jan 18:20:49.148 * Background saving started by pid 1503</span><br><span class="line">1503:C 02 Jan 18:20:49.198 * DB saved on disk</span><br><span class="line">1503:C 02 Jan 18:20:49.198 * RDB: 10 MB of memory used by copy-on-write</span><br><span class="line">1469:M 02 Jan 18:20:49.291 * Background saving terminated with success</span><br><span class="line">1469:M 02 Jan 18:20:49.303 * Synchronization with slave 192.168.2.200:6379 succeeded</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># 从库启动监控</span><br><span class="line">[whoami@server1 redis]$ /home/whoami/redis/bin/redis-cli -h localhost -p 6379 monitor</span><br><span class="line">OK</span><br><span class="line">1451731377.726230 [0 192.168.2.125:6379] &quot;PING&quot;</span><br><span class="line"></span><br><span class="line">#测试主从同步</span><br><span class="line">---主库操作</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli -h localhost -p 6379 set whoami 123</span><br><span class="line">OK</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli -h localhost -p 6379 get whoami</span><br><span class="line">&quot;123&quot;</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli -h localhost -p 6379 set whoami abc</span><br><span class="line">OK</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli -h localhost -p 6379 get whoami</span><br><span class="line">&quot;abc&quot;</span><br><span class="line"></span><br><span class="line">---从库验证</span><br><span class="line">[whoami@apache-server redis-3.0.5]$ src/redis-cli -h 192.168.2.200 -p 6379 get whoami         </span><br><span class="line">&quot;123&quot;</span><br><span class="line"></span><br><span class="line">---查看从库监控</span><br><span class="line">[whoami@server1 redis]$ /home/whoami/redis/bin/redis-cli -h localhost -p 6379 monitor</span><br><span class="line">OK</span><br><span class="line">1451731377.726230 [0 192.168.2.125:6379] &quot;PING&quot;</span><br><span class="line">1451731387.824175 [0 192.168.2.125:6379] &quot;PING&quot;</span><br><span class="line">1451731397.922070 [0 192.168.2.125:6379] &quot;PING&quot;</span><br><span class="line">1451731407.875624 [0 192.168.2.125:6379] &quot;SELECT&quot; &quot;0&quot;</span><br><span class="line">1451731407.875640 [0 192.168.2.125:6379] &quot;set&quot; &quot;whoami&quot; &quot;abc&quot;</span><br><span class="line">1451731408.009269 [0 192.168.2.125:6379] &quot;PING&quot;</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ killall redis-server</span><br></pre></td></tr></table></figure>
<h1 id="redis-监控信息"><a href="#redis-监控信息" class="headerlink" title="redis 监控信息"></a>redis 监控信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ /home/whoami/redis/bin/redis-cli -h localhost -p 6379 info|wc -l</span><br><span class="line">100</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ /home/whoami/redis/bin/redis-cli -h localhost -p 6379 info Replication</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.2.125</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:1</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:1039</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ /home/whoami/redis/bin/redis-cli -h localhost -p 6379 info CPU</span><br><span class="line"># CPU</span><br><span class="line">used_cpu_sys:0.36</span><br><span class="line">used_cpu_user:0.15</span><br><span class="line">used_cpu_sys_children:0.00</span><br><span class="line">used_cpu_user_children:0.00</span><br></pre></td></tr></table></figure>
<h1 id="redis负载均衡"><a href="#redis负载均衡" class="headerlink" title="redis负载均衡"></a>redis负载均衡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lvs--&gt;master</span><br><span class="line">     |--slave</span><br></pre></td></tr></table></figure>
<h1 id="redis-cluster"><a href="#redis-cluster" class="headerlink" title="redis cluster"></a>redis cluster</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后续更新...</span><br></pre></td></tr></table></figure>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/redis/">redis</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/01/02/Zabbix-Use/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Zabbix Use</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2015/11/23/How-to-Install-VMware-Workstation-11-on-CentOS-7/">
        <span class="next-text nav-default">How to Install VMware Workstation 11 on CentOS 7</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">加载 Disqus 评论</button>
    </div>
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2023
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/realXuJiang/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'itweet-cn';
  var disqus_identifier = '2015/11/26/redis-use/';

  var disqus_title = "redis use";


  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
