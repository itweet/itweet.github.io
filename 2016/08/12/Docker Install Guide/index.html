<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="Docker Install Guide">




  <meta name="keywords" content="docker,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2016/08/12/Docker Install Guide/">


<meta name="description" content="使用docker已经有1年多了，打算写一个系列，不知道能坚持吗？我太懒，只当为自己纪录吧！这一篇为docker基本使用文档！ Docker 是一個開源專案，誕生於 2013 年初，最初是 dotCloud 公司內部的一個業餘專案。它基於 Google 公司推出的 Go 語言實作。 專案後來加入了 Linux 基金會，遵從了 Apache 2.0 協議，原始碼在 GitHub 上進行維護。 网上文档">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Install Guide">
<meta property="og:url" content="http://itweet.github.io/2016/08/12/Docker Install Guide/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="使用docker已经有1年多了，打算写一个系列，不知道能坚持吗？我太懒，只当为自己纪录吧！这一篇为docker基本使用文档！ Docker 是一個開源專案，誕生於 2013 年初，最初是 dotCloud 公司內部的一個業餘專案。它基於 Google 公司推出的 Go 語言實作。 專案後來加入了 Linux 基金會，遵從了 Apache 2.0 協議，原始碼在 GitHub 上進行維護。 网上文档">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-07-02T13:09:15.505Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker Install Guide">
<meta name="twitter:description" content="使用docker已经有1年多了，打算写一个系列，不知道能坚持吗？我太懒，只当为自己纪录吧！这一篇为docker基本使用文档！ Docker 是一個開源專案，誕生於 2013 年初，最初是 dotCloud 公司內部的一個業餘專案。它基於 Google 公司推出的 Go 語言實作。 專案後來加入了 Linux 基金會，遵從了 Apache 2.0 協議，原始碼在 GitHub 上進行維護。 网上文档">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> Docker Install Guide - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Docker Install Guide
        
      </h1>

      <time class="post-time">
          8月 12 2016
      </time>
    </header>



    
            <div class="post-content">
            <p>使用docker已经有1年多了，打算写一个系列，不知道能坚持吗？我太懒，只当为自己纪录吧！这一篇为docker基本使用文档！</p>
<p>Docker 是一個開源專案，誕生於 2013 年初，最初是 dotCloud 公司內部的一個業餘專案。它基於 Google 公司推出的 Go 語言實作。 專案後來加入了 Linux 基金會，遵從了 Apache 2.0 協議，原始碼在 GitHub 上進行維護。</p>
<p>网上文档成片，我就简单写写最佳实践吧。更多详细基础知识请参考文章最后的参考链接！</p>
<h1 id="Docker-for-Centos-6-x"><a href="#Docker-for-Centos-6-x" class="headerlink" title="Docker for Centos 6.x"></a>Docker for Centos 6.x</h1><p>Docker最为一个目前最流行的容器技术，可以支持多平台，主流unix系统，甚至是windows系列都能安装！这里演示Centos安装docker方式。并且给予这个版本给一些案例演示！</p>
<h2 id="Docker-Install"><a href="#Docker-Install" class="headerlink" title="Docker Install"></a>Docker Install</h2><p>Centos 6.x默认没用docker的镜像源，需要手动安装一个epel源才可以找到包，并且包名docker-io，而在centos 7.x的包名确实docker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum info docker-io</span><br><span class="line"></span><br><span class="line">sudo yum -y install docker-io</span><br></pre></td></tr></table></figure></p>
<h2 id="start-docker"><a href="#start-docker" class="headerlink" title="start docker"></a>start docker</h2><p>手动启动docker，并且设置为开机自动启动！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/docker start</span><br><span class="line"></span><br><span class="line">chkconfig docker on</span><br></pre></td></tr></table></figure></p>
<h2 id="docker-hub"><a href="#docker-hub" class="headerlink" title="docker hub"></a>docker hub</h2><p>docker提供一个类似github的平台，可以供大家上传自己制作好的images，带有一定软件功能的docker容器，供全球使用者随意pull下来使用，并且修改参与共享。这就是docker hub。但是由于网络种种原因，很多源下载很慢或者失败，重拾几次或者用一些国内提供的docker hub源地址替代官方提供的docker hub，这样加快镜像的构建速度！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker search centos</span><br><span class="line"></span><br><span class="line">docker pull centos # For example: docker pull centos:5.11 or docker pull </span><br><span class="line"></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure></p>
<h2 id="dcoker-container"><a href="#dcoker-container" class="headerlink" title="dcoker container"></a>dcoker container</h2><ul>
<li>启动容器：docker run –name -h hostname</li>
<li>停止容器：docker stop CONTAINER ID</li>
<li>查看容器：docker ps </li>
<li>进入容器：docker exec | docker attach</li>
<li>删除容器：docker rm option [-f]</li>
<li>运行容器日志：docker logs CONTAINER ID</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker run centos /bin/echo &apos;Hello world&apos;</span><br><span class="line">Hello world</span><br></pre></td></tr></table></figure>
<h3 id="查看容器运行状态"><a href="#查看容器运行状态" class="headerlink" title="查看容器运行状态"></a>查看容器运行状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS                          PORTS               NAMES</span><br><span class="line">8c0e090d5b87        centos              &quot;/bin/echo &apos;Hello wo   About a minute ago   Exited (0) About a minute ago                       sharp_cori</span><br></pre></td></tr></table></figure>
<h3 id="进入docker容器"><a href="#进入docker容器" class="headerlink" title="进入docker容器"></a>进入docker容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker run --name mydocker -it centos /bin/bash </span><br><span class="line"></span><br><span class="line">[root@4875a51a97cb /]# ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0  11720  1864 ?        Ss   10:12   0:00 /bin/bash</span><br><span class="line">root        18  0.0  0.0  35836  1488 ?        R+   10:13   0:00 ps aux</span><br><span class="line"></span><br><span class="line">[root@4875a51a97cb tmp]# ls</span><br><span class="line">ks-script-06FeP3</span><br><span class="line"></span><br><span class="line">[root@4875a51a97cb tmp]# mkdir test</span><br><span class="line"></span><br><span class="line">[root@4875a51a97cb tmp]# ls</span><br><span class="line">ks-script-06FeP3  test</span><br><span class="line"></span><br><span class="line">[root@4875a51a97cb tmp]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.2.1511 (Core) </span><br><span class="line"></span><br><span class="line">[root@4875a51a97cb tmp]# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">4875a51a97cb        centos              &quot;/bin/bash&quot;            12 minutes ago      Exited (0) 27 seconds ago                       mydocker            </span><br><span class="line">8c0e090d5b87        centos              &quot;/bin/echo &apos;Hello wo   16 minutes ago      Exited (0) 16 minutes ago                       sharp_cori</span><br></pre></td></tr></table></figure>
<h3 id="获取centos6-6容器"><a href="#获取centos6-6容器" class="headerlink" title="获取centos6.6容器"></a>获取centos6.6容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker pull centos:6.6</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker run --name mycentos -it centos:6.6 /bin/bash </span><br><span class="line"></span><br><span class="line">[root@eae421cf2af9 /]# ip ad li # CentOS 7 容器没有自带这个命令</span><br><span class="line">13: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.3/16 scope global eth0</span><br><span class="line">    inet6 fe80::42:acff:fe11:3/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">[root@eae421cf2af9 /]# ifconfig eth0</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:03  </span><br><span class="line">          inet addr:172.17.0.3  Bcast:0.0.0.0  Mask:255.255.0.0</span><br><span class="line"></span><br><span class="line">[root@eae421cf2af9 /]# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">centos              latest              60e65a8e4030        6 weeks ago         196.6 MB</span><br><span class="line">centos              6.6                 12c9d795d85a        4 months ago        202.6 MB</span><br></pre></td></tr></table></figure>
<h3 id="启动终止容器"><a href="#启动终止容器" class="headerlink" title="启动终止容器"></a>启动终止容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker ps -a  # CONTAINER ID</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker start eae421cf2af9</span><br><span class="line">eae421cf2af9</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">eae421cf2af9        centos:6.6          &quot;/bin/bash&quot;            4 minutes ago       Up 19 seconds                                   mycentos            </span><br><span class="line">4875a51a97cb        centos              &quot;/bin/bash&quot;            19 minutes ago      Exited (0) 7 minutes ago                        mydocker            </span><br><span class="line">8c0e090d5b87        centos              &quot;/bin/echo &apos;Hello wo   24 minutes ago      Exited (0) 24 minutes ago                       sharp_cori  </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker stop eae421cf2af9 </span><br><span class="line">eae421cf2af9</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                       PORTS               NAMES</span><br><span class="line">eae421cf2af9        centos:6.6          &quot;/bin/bash&quot;            5 minutes ago       Exited (137) 8 seconds ago                       mycentos            </span><br><span class="line">4875a51a97cb        centos              &quot;/bin/bash&quot;            20 minutes ago      Exited (0) 8 minutes ago                         mydocker            </span><br><span class="line">8c0e090d5b87        centos              &quot;/bin/echo &apos;Hello wo   25 minutes ago      Exited (0) 25 minutes ago                        sharp_cori</span><br></pre></td></tr></table></figure>
<h3 id="容器后台运行"><a href="#容器后台运行" class="headerlink" title="容器后台运行"></a>容器后台运行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker run -d --name myid centos </span><br><span class="line">e2e9964282ab789a8f7cab4a397cbf22a8f91d83dbb80173698f1f64aa46b75e</span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS                          PORTS               NAMES</span><br><span class="line">e2e9964282ab        centos              &quot;/bin/bash&quot;            3 seconds ago        Exited (0) 3 seconds ago                            myid   </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker run -d --name mycentos2 centos:6.6 /bin/bash </span><br><span class="line">986e7a8976c2be2d2bb1707eacd3277a2c3368f95bb02ed0919c2abf7e4ef5ed</span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS                          PORTS               NAMES</span><br><span class="line">986e7a8976c2        centos:6.6          &quot;/bin/bash&quot;            5 seconds ago        Exited (0) 4 seconds ago                            mycentos2    </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker run -d --name mynginx nginx</span><br><span class="line">Unable to find image &apos;nginx:latest&apos; locally</span><br><span class="line">latest: Pulling from nginx</span><br><span class="line">77e39ee82117: Pull complete </span><br><span class="line">5eb1402f0414: Pull complete </span><br><span class="line">2f4509f0578a: Pull complete </span><br><span class="line">cc87edc856de: Pull complete </span><br><span class="line">9b35f2e19927: Pull complete </span><br><span class="line">6fbf62f05baf: Pull complete </span><br><span class="line">d4202c2d289c: Pull complete </span><br><span class="line">2b1e900b514d: Pull complete </span><br><span class="line">Digest: sha256:c42cbe1c6f4e91aa873a23c988826e3604b0a1ae90aaf3351923db855a953399</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">2d7a73f9f499f65a3ed5d27ff7f85660611dedc8dbefb475371bfa9c7643d9d6</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS                        PORTS               NAMES</span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   About a minute ago   Up About a minute             80/tcp, 443/tcp     mynginx      </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a|grep nginx</span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   2 minutes ago       Up 2 minutes                  80/tcp, 443/tcp     mynginx</span><br></pre></td></tr></table></figure>
<h3 id="删除容器-必须先停止容器"><a href="#删除容器-必须先停止容器" class="headerlink" title="删除容器,必须先停止容器"></a>删除容器,必须先停止容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker rm 2d7a73f9f499</span><br><span class="line">Error response from daemon: Cannot destroy container 2d7a73f9f499: Conflict, You cannot remove a running container. Stop the container before attempting removal or use -f</span><br><span class="line">Error: failed to remove containers: [2d7a73f9f499]</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker rm 064fcc873164  #rm删除容器，rmi删除镜像</span><br><span class="line">064fcc873164</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker rm 8965a9ba1b17 e2e9964282ab 986e7a8976c2</span><br><span class="line">8965a9ba1b17</span><br><span class="line">e2e9964282ab</span><br><span class="line">986e7a8976c2</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   7 minutes ago       Up 7 minutes                80/tcp, 443/tcp     mynginx             </span><br><span class="line">8c0e090d5b87        centos              &quot;/bin/echo &apos;Hello wo   46 minutes ago      Exited (0) 46 minutes ago                       sharp_cori</span><br></pre></td></tr></table></figure>
<h3 id="进入已经运行的容器方式"><a href="#进入已经运行的容器方式" class="headerlink" title="进入已经运行的容器方式"></a>进入已经运行的容器方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker ps -l  #最后一个运行容器</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   15 minutes ago      Up 15 minutes       80/tcp, 443/tcp     mynginx </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker attach 2d7a73f9f499  #此命令有些时候无法进去容器,或者不支持,如果ctrl+c,那么容器会自动停止</span><br><span class="line">^C[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   19 minutes ago      Exited (0) 3 seconds ago                       mynginx   </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# yum install util-linux   #通过这个软件包提供的命令进入容器</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker start 2d7a73f9f499</span><br><span class="line">2d7a73f9f499</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a             </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   23 minutes ago      Up 11 seconds       80/tcp, 443/tcp     mynginx</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker inspect --format &quot;&#123;&#123;.State.Pid&#125;&#125;&quot; mynginx  #获取容器运行的pid</span><br><span class="line">5782</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# nsenter --target 5782 --mount --uts --ipc --net --pid</span><br><span class="line">root@2d7a73f9f499:/# </span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.1  31484  2948 ?        Ss   11:09   0:00 nginx: master process nginx -g daemon off;</span><br><span class="line">nginx        6  0.0  0.0  31860  1716 ?        S    11:09   0:00 nginx: worker process</span><br><span class="line">root         7  0.0  0.1  20232  2028 ?        S    11:13   0:00 -bash</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# cat /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# cd /etc/nginx/</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/etc/nginx# cat conf.d/default.conf |grep root</span><br><span class="line">        root   /usr/share/nginx/html;   #nginx root目录</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:~# exit </span><br><span class="line">logout</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# cat in.sh  #进入容器脚本</span><br><span class="line">#!/bin/bash</span><br><span class="line">CNAME=$1</span><br><span class="line">CPID=$(docker inspect --format &quot;&#123;&#123;.State.Pid&#125;&#125;&quot; $CNAME)</span><br><span class="line">nsenter --target &quot;$CPID&quot; --mount --uts --ipc --net --pid</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# sh in.sh mynginx</span><br><span class="line">root@2d7a73f9f499:/# exit</span><br><span class="line">logout</span><br></pre></td></tr></table></figure>
<h2 id="docker-网络访问"><a href="#docker-网络访问" class="headerlink" title="docker 网络访问"></a>docker 网络访问</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# brctl show</span><br><span class="line">bridge name     bridge id               STP enabled     interfaces</span><br><span class="line">docker0         8000.dad9e43403b6       no              veth44be944</span><br><span class="line">virbr0          8000.525400353d8e       yes             virbr0-nic</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# iptables -t nat -L -n</span><br><span class="line">Chain PREROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER     all  --  0.0.0.0/0            0.0.0.0/0           ADDRTYPE match dst-type LOCAL </span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">MASQUERADE  tcp  --  192.168.122.0/24    !192.168.122.0/24    masq ports: 1024-65535 </span><br><span class="line">MASQUERADE  udp  --  192.168.122.0/24    !192.168.122.0/24    masq ports: 1024-65535 </span><br><span class="line">MASQUERADE  all  --  192.168.122.0/24    !192.168.122.0/24    </span><br><span class="line">MASQUERADE  all  --  172.17.0.0/16        0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER     all  --  0.0.0.0/0           !127.0.0.0/8         ADDRTYPE match dst-type LOCAL </span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line">target     prot opt source               destination      </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# sh in.sh mynginx  #进入容器可以上网</span><br><span class="line">root@2d7a73f9f499:/# ping baidu.com</span><br><span class="line">PING baidu.com (123.125.114.144): 56 data bytes</span><br><span class="line">64 bytes from 123.125.114.144: icmp_seq=0 ttl=50 time=77.808 ms</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# ip ad li</span><br><span class="line">37: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP </span><br><span class="line">    link/ether 02:42:ac:11:00:0b brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.11/16 scope global eth0</span><br><span class="line">    inet6 fe80::42:acff:fe11:b/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">39: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# ping 192.168.2.1</span><br><span class="line">PING 192.168.2.1 (192.168.2.1): 56 data bytes</span><br><span class="line">64 bytes from 192.168.2.1: icmp_seq=0 ttl=63 time=2.125 ms</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# ping 192.168.199.1  </span><br><span class="line">PING 192.168.199.1 (192.168.199.1): 56 data bytes</span><br><span class="line">64 bytes from 192.168.199.1: icmp_seq=0 ttl=251 time=6.571 ms</span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# ip ro li</span><br><span class="line">172.17.0.0/16 dev eth0  proto kernel  scope link  src 172.17.0.11 </span><br><span class="line">default via 172.17.42.1 dev eth0 </span><br><span class="line"></span><br><span class="line">root@2d7a73f9f499:/# exit </span><br><span class="line">logout</span><br><span class="line">[root@server1 ~]# ifconfig </span><br><span class="line">docker0   Link encap:Ethernet  HWaddr DA:D9:E4:34:03:B6  </span><br><span class="line">          inet addr:172.17.42.1  Bcast:0.0.0.0  Mask:255.255.0.0</span><br><span class="line">          inet6 addr: fe80::7458:f8ff:fe2d:bec/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:62 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:21 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:4163 (4.0 KiB)  TX bytes:1891 (1.8 KiB)</span><br></pre></td></tr></table></figure>
<p>docker提供一种端口映射功能，可以让我们访问宿主机IP，可以转发到容器内部，某个服务的端口，从而达到访问容器内服务的目的。有两种端口映射方式：1.随机映射 2.指定映射</p>
<h3 id="随机映射容器端口到宿主机"><a href="#随机映射容器端口到宿主机" class="headerlink" title="随机映射容器端口到宿主机"></a>随机映射容器端口到宿主机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker run -P -d --name mynginx1 nginx</span><br><span class="line">711c8bc3077d27196c4263cc75bb7fcb7f0bf2c02fb120054f011b9b9b134847</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                                           NAMES</span><br><span class="line">711c8bc3077d        nginx               &quot;nginx -g &apos;daemon of   27 seconds ago      Up 27 seconds       0.0.0.0:32769-&gt;80/tcp, 0.0.0.0:32768-&gt;443/tcp   mynginx1            </span><br><span class="line">2d7a73f9f499        nginx               &quot;nginx -g &apos;daemon of   59 minutes ago      Up 35 minutes       80/tcp, 443/tcp                                 mynginx</span><br></pre></td></tr></table></figure>
<p>运行如上命令后，通过<code>docker ps -l</code>可以看到最后运行容器的信息，在这个时候通过宿主机IP:32769即可访问到容器中的nginx服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#获取运行容器的ip地址</span><br><span class="line">[root@server1 ~]# docker inspect --format=&quot;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&quot; 39979df7a280</span><br><span class="line">172.17.0.13</span><br><span class="line">[root@server1 ~]# docker inspect --format=&quot;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&quot; mynginx2</span><br><span class="line">172.17.0.13</span><br><span class="line">[root@server1 ~]# docker inspect --format=&quot;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&quot; mynginx1</span><br><span class="line">172.17.0.12</span><br></pre></td></tr></table></figure>
<h3 id="指定映射"><a href="#指定映射" class="headerlink" title="指定映射"></a>指定映射</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker stop 2d7a73f9f499</span><br><span class="line">2d7a73f9f499</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker rm 2d7a73f9f499</span><br><span class="line">2d7a73f9f499</span><br><span class="line">[root@server1 ~]#  docker ps -a           </span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker run -d -p 91:80 --name mynginx2 nginx</span><br><span class="line">39979df7a280af50b1778094064002c413ebc47bba76133790c6c82663e242ed</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                                           NAMES</span><br><span class="line">39979df7a280        nginx               &quot;nginx -g &apos;daemon of   22 seconds ago      Up 21 seconds       443/tcp, 0.0.0.0:91-&gt;80/tcp</span><br></pre></td></tr></table></figure>
<p>运行如上命令，访问宿主机ip:91即可访问到容器中的nginx.</p>
<h2 id="docker-数据管理"><a href="#docker-数据管理" class="headerlink" title="docker 数据管理"></a>docker 数据管理</h2><p>docker提供volume映射的方式，达到容器数据的持久化，为了保证容器一次构建全世界运行，所以不能依赖太多系统的特定变量。无状态的服务最理想化，但是很多时候有状态的服务有需要持久化存储数据，所以诞生这个功能。</p>
<h3 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">nginx               latest              2b1e900b514d        2 weeks ago         134.4 MB</span><br><span class="line">centos              latest              60e65a8e4030        6 weeks ago         196.6 MB</span><br><span class="line">centos              6.6                 12c9d795d85a        4 months ago        202.6 MB</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES</span><br><span class="line">39979df7a280        nginx               &quot;nginx -g &apos;daemon of   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:91-&gt;80/tcp   mynginx2   </span><br><span class="line"></span><br><span class="line">#启动一个容器centos,并且创建一个/data的数据卷</span><br><span class="line">[root@server1 ~]# docker run -it --name volume-test1 -h nginx -v /data centos</span><br><span class="line">[root@nginx /]# ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0  11720  1868 ?        Ss   14:11   0:00 /bin/bash</span><br><span class="line"></span><br><span class="line">[root@nginx /]# ls -ld /data/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 11 14:11 /data/</span><br><span class="line"></span><br><span class="line">[root@nginx /]# df -h|grep data</span><br><span class="line">/dev/sda1                                                                                         20G  6.3G   13G  34% /data</span><br><span class="line"></span><br><span class="line">#通过数据卷，容器把数据写入到物理主机那个地方，下面命令查看？</span><br><span class="line">[root@server1 ~]# docker inspect -f &#123;&#123;.Volumes&#125;&#125; volume-test1</span><br><span class="line">map[/data:/var/lib/docker/volumes/3f68063a817fee1155f4f50826eee3cf13827d4118fc4f614159dcb44431f88a/_data]</span><br><span class="line"></span><br><span class="line">[root@server1~]# ls /var/lib/docker/volumes/3f68063a817fee1155f4f50826eee3cf13827d4118fc4f614159dcb44431f88a/_data/</span><br><span class="line"></span><br><span class="line">[root@nginx /]# cd /data/</span><br><span class="line">[root@nginx data]# pwd</span><br><span class="line">/data</span><br><span class="line">[root@nginx data]# touch docker_v</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# ls -l /var/lib/docker/volumes/3f68063a817fee1155f4f50826eee3cf13827d4118fc4f614159dcb44431f88a/_data/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Feb 11 22:18 docker_v</span><br><span class="line"></span><br><span class="line">#指定物理主机的一个目录，挂载到容器中的如何实现？</span><br><span class="line">[root@server1 ~]# docker run -it --name volume-test2 -h centos -v /data:/data centos</span><br><span class="line">[root@centos /]# ls /data/</span><br><span class="line">CentOS-6.6-x86_64-bin-DVD1.iso  Centos-6.6-x68_64.raw  dfs  journal</span><br><span class="line"></span><br><span class="line">[root@centos /]# ping baidu.com</span><br><span class="line">PING baidu.com (220.181.57.217) 56(84) bytes of data.</span><br><span class="line">64 bytes from 220.181.57.217: icmp_seq=1 ttl=53 time=76.7 ms</span><br><span class="line"></span><br><span class="line">#挂载的目录为只读，不能写！在容器中无法写…</span><br><span class="line">[root@server1 ~]# docker run -it --name volume-test2 -h centos -v /data:/data:ro centos</span><br><span class="line"></span><br><span class="line">#挂载文件到容器,没有生效，新版可能不支持了</span><br><span class="line">[root@server1 ~]# docker run -it --name volume-test3 -h centos -v /etc/hosts:/etc/hosts centos</span><br><span class="line">[root@centos /]# cat /etc/hosts</span><br><span class="line">172.17.0.17     centos</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br></pre></td></tr></table></figure>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@server1 ~]# docker run -it --name volume-test1 -h centos -v /data:/data centos  </span><br><span class="line">[root@centos /]# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                     PORTS                         NAMES</span><br><span class="line">af47fece9654        centos              &quot;/bin/bash&quot;            7 seconds ago       Exited (0) 4 seconds ago                                 volume-test1        </span><br><span class="line">39979df7a280        nginx               &quot;nginx -g &apos;daemon of   2 hours ago         Up 2 hours                 443/tcp, 0.0.0.0:91-&gt;80/tcp   mynginx2</span><br><span class="line"></span><br><span class="line">#数据卷容器,使用其他容器已经挂载的数据卷路径,所有容器共享一个数据卷？</span><br><span class="line">[root@server1 ~]# docker run -it --name volume-test2 -h centos --volumes-from volume-test1 centos      </span><br><span class="line">[root@centos /]# ls /data/</span><br><span class="line">CentOS-6.6-x86_64-bin-DVD1.iso  Centos-6.6-x68_64.raw  dfs  journal</span><br></pre></td></tr></table></figure>
<h2 id="docker-镜像构建"><a href="#docker-镜像构建" class="headerlink" title="docker 镜像构建"></a>docker 镜像构建</h2><h3 id="手动构建镜像"><a href="#手动构建镜像" class="headerlink" title="手动构建镜像"></a>手动构建镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">#基于源码构建nginx镜像</span><br><span class="line">$   yum install gcc-c++  </span><br><span class="line">$   yum install zlib zlib-devel  </span><br><span class="line">$   yum install openssl openssl--devel  </span><br><span class="line">[root@nginx /]# rpm -ivh  http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@server1 ~]# docker run --name nginx -h nginx -it centos:6.6 /bin/bash </span><br><span class="line">  注意：centos的镜像，不知道为何,在redhat宿主机运行,编译nginx不能通过…最后我只能在centos虚拟机重新尝试…编译报错：checking for C compiler ... found；替换了操作系统为centos依然如此,说明不是操作系统的问题，而是镜像问题，可忽略继续安装！</span><br><span class="line"></span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">[root@centos ~]# cat /etc/redhat-release </span><br><span class="line">CentOS release 6.6 (Final)</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker run --name nginx -h nginx -it centos:6.6 /bin/bash</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker ps -a </span><br><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker images</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker pull nginx</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">nginx               latest              2b1e900b514d        2 weeks ago         134.4 MB</span><br><span class="line">centos              6.6                 12c9d795d85a        4 months ago        202.6 MB</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker run --name nginx -h nginx -it centos:6.6 /bin/bash</span><br><span class="line">[root@nginx /]# yum install -y wget gcc gcc-c++ make openssl openssl-devel tar</span><br><span class="line"></span><br><span class="line">[root@nginx /]# wget http://nginx.org/download/nginx-1.9.11.tar.gz</span><br><span class="line"></span><br><span class="line">---nginx的pcre模块</span><br><span class="line">http://www.pcre.org/</span><br><span class="line">[root@nginx /]# wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.37.tar.gz</span><br><span class="line"></span><br><span class="line">[root@nginx /]# mv *.gz /usr/local/src/</span><br><span class="line">[root@nginx /]# cd /usr/local/src/</span><br><span class="line"></span><br><span class="line">[root@nginx src]# tar zxf pcre-8.37.tar.gz</span><br><span class="line">[root@nginx src]# tar zxf nginx-1.9.11.tar.gz</span><br><span class="line"></span><br><span class="line">[root@nginx src]# useradd -s /sbin/nologin -M www</span><br><span class="line"></span><br><span class="line">[root@nginx src]# cd nginx-1.9.11</span><br><span class="line">[root@nginx nginx-1.9.11]# ./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_ssl_module --with-http_sub_module --with-pcre=/usr/local/src/pcre-8.37</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.9.11]# make</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.9.11]# make install</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.9.11]# ls -ld /usr/local/nginx</span><br><span class="line">drwxr-xr-x 6 root root 4096 Feb 11 15:50 /usr/local/nginx</span><br><span class="line"></span><br><span class="line"># 让容器启动的时候自动启动nginx,而nginx必须前台运行，nginx默认后台运行；docker会判断运行状态，导致运行之后就结束了，而没有达到启动nginx的目的</span><br><span class="line">[root@nginx nginx-1.9.11]# yum install vim -y</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.9.11]# vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line">[root@nginx nginx-1.9.11]# head -1 /usr/local/nginx/conf/nginx.conf</span><br><span class="line">daemon off;</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.9.11]# echo &apos;/usr/local/nginx/sbin/nginx&apos; &gt; /etc/rc.local</span><br><span class="line">[root@nginx nginx-1.9.11]# tail -1 /etc/rc.local    </span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br><span class="line">[root@nginx nginx-1.9.11]# exit;</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">f0031b268b26        centos:6.6          &quot;/bin/bash&quot;         About an hour ago   Exited (0) 24 seconds ago                       nginx     </span><br><span class="line">[root@centos ~]# docker commit -m &quot;centos6.6 and nginx-1.9.11&quot; f0031b268b26 skyneteye/nginx:v1</span><br><span class="line">9e78179003020986a7c970c314faff22706b55d762913d7b7f9e2d16702371e5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#测试构建的镜像</span><br><span class="line">[root@centos ~]# docker run -d -p 92:80 skyneteye/nginx:v1</span><br><span class="line">012e567670badb4983ba17066077ac27247c4befa8e999bedf4769a885db0795</span><br><span class="line"></span><br><span class="line">============== 运行完成之后就自动退出了….</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker run -it -h nginx skyneteye/nginx:v1</span><br><span class="line">[root@nginx /]# vim /etc/rc.local </span><br><span class="line">[root@nginx /]# cat /etc/rc.local</span><br><span class="line">#!/bin/sh</span><br><span class="line">#</span><br><span class="line"># This script will be executed *after* all the other init scripts.</span><br><span class="line"># You can put your own initialization stuff in here if you don&apos;t</span><br><span class="line"># want to do the full Sys V style init stuff.</span><br><span class="line"></span><br><span class="line">touch /var/lock/subsys/local</span><br><span class="line">[root@nginx /]# exit;</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND             CREATED              STATUS                      PORTS               NAMES</span><br><span class="line">5bfbd3201b47        skyneteye/nginx:v1   &quot;/bin/bash&quot;         About a minute ago   Exited (0) 29 seconds ago                       kickass_wozniak     </span><br><span class="line">[root@centos ~]# docker commit -m &quot;nginx v2&quot; 5bfbd3201b47 skyneteye/nginx:v2</span><br><span class="line">09c13432f72b6222df4aad7c71722354916a6dc7e03ecefbf43a530aedae8e09</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker images</span><br><span class="line"></span><br><span class="line">[root@centos ~]# docker run -d -p 99:80 skyneteye/nginx:v2 /usr/local/nginx/sbin/nginx</span><br><span class="line">e30d529b741fe2c8152c6deba08dc9068cc59635fb3e2648992ea7910988c2d3</span><br><span class="line">[root@centos ~]# docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                CREATED             STATUS              PORTS                NAMES</span><br><span class="line">e30d529b741f        skyneteye/nginx:v2   &quot;/usr/local/nginx/sb   17 seconds ago      Up 16 seconds       0.0.0.0:99-&gt;80/tcp   boring_franklin</span><br></pre></td></tr></table></figure>
<p>执行如上最后一步命令，可以在宿主机IP:99访问到我们自己手动构建的nginx镜像。</p>
<h3 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h3><ul>
<li>基础语法<ul>
<li>FROM 依赖的基础镜像</li>
<li>MAINTAINER  维护者信息</li>
<li>RUN   Linux命令都加到RUN命令</li>
<li>ADD   COPY文件，会自动解压</li>
<li>WORKDIR   当前工作目录</li>
<li>VOLUME    目录挂在映射</li>
<li>EXPOSE    端口</li>
<li>RUN       运行容器</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# mkdir /opt/docker-file</span><br><span class="line">[root@centos ~]# cd /opt/docker-file/</span><br><span class="line">[root@centos docker-file]# mkdir nginx</span><br><span class="line">[root@centos docker-file]# cd nginx/</span><br><span class="line">[root@centos nginx]# pwd</span><br><span class="line">/opt/docker-file/nginx</span><br><span class="line">[root@centos nginx]# ls</span><br><span class="line">nginx-1.9.11.tar.gz  pcre-8.37.tar.gz</span><br><span class="line"></span><br><span class="line">[root@centos nginx]# vim Dockerfile</span><br><span class="line">[root@centos nginx]# cat Dockerfile </span><br><span class="line"># This is My first Dockerfile</span><br><span class="line"># version 1.0</span><br><span class="line"># Author: whoami</span><br><span class="line"></span><br><span class="line"># Base images</span><br><span class="line">FROM centos:6.6</span><br><span class="line"></span><br><span class="line"># MAINTAINER info</span><br><span class="line">MAINTAINER &quot;you&quot; &lt;skynet199@foxmail.com&gt;</span><br><span class="line"></span><br><span class="line"># ADD</span><br><span class="line">ADD nginx-1.9.11.tar.gz /usr/local/src</span><br><span class="line">ADD pcre-8.37.tar.gz /usr/local/src</span><br><span class="line"></span><br><span class="line"># RUN</span><br><span class="line">RUN yum install -y wget gcc gcc-c++ make openssl-devel tar</span><br><span class="line">RUN useradd -s /sbin/nologin -M www</span><br><span class="line"></span><br><span class="line">#WORKDIR</span><br><span class="line">WORKDIR /usr/local/src/nginx-1.9.11</span><br><span class="line">RUN  ./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_ssl_module --with-http_sub_module --with-pcre=/usr/local/src/pcre-8.37 &amp;&amp; make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">RUN echo &quot;daemon off;&quot; &gt;&gt; /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"># ENV</span><br><span class="line">ENV PATH /usr/local/nginx/sbin:$PATH</span><br><span class="line"></span><br><span class="line"># EXPOSE</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"># VOLUME </span><br><span class="line"># VOLUME [ &quot;/sys/fs/cgroup&quot; ]</span><br><span class="line"></span><br><span class="line"># CMD</span><br><span class="line">CMD [&quot;nginx&quot;]</span><br><span class="line"></span><br><span class="line">[root@centos nginx]# docker build -t nginx:1.9.11 /opt/docker-file/nginx/</span><br><span class="line"></span><br><span class="line">此命令构建成功之后，即可开始测试容器的构建是否正确</span><br><span class="line"></span><br><span class="line">[root@centos nginx]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                         PORTS               NAMES</span><br><span class="line">f0031b268b26        centos:6.6          &quot;/bin/bash&quot;         2 hours ago         Exited (0) About an hour ago                       nginx  </span><br><span class="line"></span><br><span class="line">#前台运行</span><br><span class="line">[root@centos nginx]# docker run -ti -v /data:/data:ro -p 80:80 nginx:1.9.11</span><br><span class="line"></span><br><span class="line">#进入容器</span><br><span class="line">[root@centos nginx]# docker run –d -h nginx -ti -v /data:/data:ro -p 80:80 nginx:1.9.11</span><br><span class="line">247d1840b02e439872972832024517f306630f96f122a981e80f0a2a3948cd71</span><br><span class="line"></span><br><span class="line">[root@centos nginx]# docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                NAMES</span><br><span class="line">247d1840b02e        nginx:1.9.11        &quot;nginx&quot;             18 seconds ago      Up 17 seconds       0.0.0.0:80-&gt;80/tcp   distracted_meitner</span><br><span class="line"></span><br><span class="line">[root@centos nginx]# docker inspect --format &quot;&#123;&#123;.State.Pid&#125;&#125;&quot; 247d1840b02e</span><br><span class="line">52876</span><br><span class="line">[root@centos nginx]# nsenter --target 52876 --mount --uts --ipc --net --pid</span><br><span class="line"></span><br><span class="line">[root@247d1840b02e /]# yum install lsof -y</span><br><span class="line"></span><br><span class="line">#删除镜像</span><br><span class="line">[root@centos nginx]# docker rmi -f nginx:1.9.11</span><br></pre></td></tr></table></figure>
<h2 id="DockerUI-amp-Shipyard-amp-amp-swarm"><a href="#DockerUI-amp-Shipyard-amp-amp-swarm" class="headerlink" title="DockerUI &amp; Shipyard &amp;&amp; swarm"></a>DockerUI &amp; Shipyard &amp;&amp; swarm</h2><p>  docker可视化管理软件，docker集群的实现，后续内容介绍！</p>
<h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><pre><code>https://www.docker.com/products/docker-compose
</code></pre><h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><pre><code>https://www.docker.com/products/docker-swarm
</code></pre><h2 id="Docker-machine"><a href="#Docker-machine" class="headerlink" title="Docker-machine"></a>Docker-machine</h2><pre><code>https://www.docker.com/products/docker-machine
</code></pre><h2 id="Install-kali-linux-docker-for-Mac"><a href="#Install-kali-linux-docker-for-Mac" class="headerlink" title="Install kali-linux-docker for Mac"></a>Install kali-linux-docker for Mac</h2><pre><code>http://linux.im/2015/05/28/kali-linux-docker.html
</code></pre><h2 id="优雅退出容器不会导致容器停止"><a href="#优雅退出容器不会导致容器停止" class="headerlink" title="优雅退出容器不会导致容器停止"></a>优雅退出容器不会导致容器停止</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+P+Q</span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://www.docker.com/" target="_blank" rel="noopener">https://www.docker.com/</a><br>    <a href="https://philipzheng.gitbooks.io/docker_practice/content/introduction/what.html" target="_blank" rel="noopener">https://philipzheng.gitbooks.io/docker_practice/content/introduction/what.html</a><br>    <a href="https://yeasy.gitbooks.io/docker_practice/content/introduction/what.html" target="_blank" rel="noopener">https://yeasy.gitbooks.io/docker_practice/content/introduction/what.html</a></p>
<p>原创文章，转载请注明： 转载自<a href="http://www.itweet.cn" target="_blank" rel="noopener">Itweet</a>的博客<br><code>本博客的文章集合:</code> <a href="http://www.itweet.cn/blog/archive/" target="_blank" rel="noopener">http://www.itweet.cn/blog/archive/</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/docker/">docker</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/08/13/Docker Install for centos 7/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Docker Install for centos 7</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2016/08/09/openstack image guide /">
        <span class="next-text nav-default">openstack image guide</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
