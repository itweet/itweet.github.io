<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="kubernetes-create-pods">




  <meta name="keywords" content="kubernates,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2016/08/15/kubernetes-create-pods/">


<meta name="description" content="根据前一篇文章，安装好kubernetes集群，集群正常在运行，下面开始创建pods吧！ 你可以选择，从github下载kubernetes源码，切换到kubernetes/examples/guestbook参考官网文档搭建一个完整的应用来验证集群的基本功能。 12345[root@kubernetes-controller ~]#  kubectl get nodesNAME">
<meta name="keywords" content="kubernates">
<meta property="og:type" content="article">
<meta property="og:title" content="kubernetes-create-pods">
<meta property="og:url" content="http://itweet.github.io/2016/08/15/kubernetes-create-pods/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="根据前一篇文章，安装好kubernetes集群，集群正常在运行，下面开始创建pods吧！ 你可以选择，从github下载kubernetes源码，切换到kubernetes/examples/guestbook参考官网文档搭建一个完整的应用来验证集群的基本功能。 12345[root@kubernetes-controller ~]#  kubectl get nodesNAME">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-09-25T15:55:49.096Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kubernetes-create-pods">
<meta name="twitter:description" content="根据前一篇文章，安装好kubernetes集群，集群正常在运行，下面开始创建pods吧！ 你可以选择，从github下载kubernetes源码，切换到kubernetes/examples/guestbook参考官网文档搭建一个完整的应用来验证集群的基本功能。 12345[root@kubernetes-controller ~]#  kubectl get nodesNAME">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> kubernetes-create-pods - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          kubernetes-create-pods
        
      </h1>

      <time class="post-time">
          8月 15 2016
      </time>
    </header>



    
            <div class="post-content">
            <p>根据前一篇文章，安装好kubernetes集群，集群正常在运行，下面开始创建pods吧！</p>
<p>你可以选择，从github下载kubernetes源码，切换到kubernetes/examples/guestbook参考<a href="https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook" target="_blank" rel="noopener">官网文档</a>搭建一个完整的应用来验证集群的基本功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]#  kubectl get nodes</span><br><span class="line">NAME                STATUS    AGE</span><br><span class="line">kubernetes-node-1   Ready     37m</span><br><span class="line">kubernetes-node-2   Ready     30m</span><br><span class="line">kubernetes-node-3   Ready     22m</span><br></pre></td></tr></table></figure>
<p>创建Namespace：kube-system<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]# vi namespace.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-system</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get namespace</span><br><span class="line">NAME      STATUS    AGE</span><br><span class="line">default   Active    5h</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl create -f namespace.yaml</span><br><span class="line">namespace &quot;kube-system&quot; created</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get namespace           </span><br><span class="line">NAME          STATUS    AGE</span><br><span class="line">default       Active    5h</span><br><span class="line">kube-system   Active    3s</span><br></pre></td></tr></table></figure></p>
<p>启动一个nginx<br> 新建一个pod-nginx.yaml文件，用于描述 pod.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]#  kubectl api-versions</span><br><span class="line">autoscaling/v1</span><br><span class="line">batch/v1</span><br><span class="line">extensions/v1beta1</span><br><span class="line">v1</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# vi pod-nginx.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx</span><br><span class="line">    image: nginx</span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 80</span><br></pre></td></tr></table></figure></p>
<p>然后启动这个pod，检查状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># create Pod</span><br><span class="line">[root@kubernetes-controller ~]# kubectl create -f pod-nginx.yaml</span><br><span class="line">pod &quot;nginx&quot; created</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods --all-namespaces</span><br><span class="line">NAMESPACE   NAME      READY     STATUS              RESTARTS   AGE</span><br><span class="line">default     nginx     0/1       ContainerCreating   0          15s</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl describe pods nginx</span><br></pre></td></tr></table></figure></p>
<p>可以看到，这个nginx-pod被调度到kubernetes-node3启动。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]# kubectl describe pods nginx|tail -5</span><br><span class="line">  FirstSeen     LastSeen        Count   From                    SubobjectPath   Type            Reason          Message</span><br><span class="line">  ---------     --------        -----   ----                    -------------   --------        ------          -------</span><br><span class="line">  2m            2m              1       &#123;default-scheduler &#125;                    Normal          Scheduled       Successfully assigned nginx to kubernetes-node-3</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods</span><br><span class="line">NAME      READY     STATUS              RESTARTS   AGE</span><br><span class="line">nginx     0/1       ContainerCreating   0          11m</span><br></pre></td></tr></table></figure></p>
<p>接下来我们可以去kubernetes-node-3节点，看看是否有对应的镜像被拉取并启动,发现没用镜像也没有启动容器，额，再次检查发现，连接超时，国内网络环境，不得不说一句fuck！到那个节点search一下。等待好久都没结果，我们去配置文件找找为啥会有这样一个容器被pull！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> &lt;invalid&gt;     &lt;invalid&gt;       1       &#123;kubelet kubernetes-node-3&#125;                     Warning         FailedSync      Error syncing pod, skipping: failed to &quot;StartContainer&quot; for &quot;POD&quot; with ErrImagePull: &quot;image pull failed for registry.access.redhat.com/rhel7/pod-infrastructure:latest, this may be because there are no credentials on this request.  details: (unable to ping registry endpoint https://registry.access.redhat.com/v0/\nv2 ping attempt failed with error: https://registry.access.redhat.com/v2/ does not appear to be a v2 registry endpoint\n v1 ping attempt failed with error: Get https://registry.access.redhat.com/v1/_ping: read tcp 192.168.2.123:42613-&gt;209.132.182.63:443: read: connection timed out)&quot;</span><br><span class="line"></span><br><span class="line">日志：</span><br><span class="line">No such image: registry.access.redhat.com/rhel7/pod-infrastructure:latest&quot;</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# docker search registry.access.redhat.com/rhel7/pod-infrastructure:latest</span><br></pre></td></tr></table></figure></p>
<p>在kubernetes-node的节点上都会有这样的一个基础镜像，<code>registry.access.redhat.com/rhel7/pod-infrastructure:latest</code>这个镜像是Pod 启动时的一个基础容器，你可以通过dokcer ps -a命令看到这个容器，类似windows系统服务,供kubenetes内部使用。pods无法运行，好可恶，只能提前下载下来导入进去啦！docker.io没用提供，google源又被封，只能考虑其他方式了！发现时间不同步，待我同步所有节点时间后，居然镜像就自己下载下来了。会自动run起这个容器。<br><a href="http://kubernetes.io/docs/user-guide/images/" target="_blank" rel="noopener">http://kubernetes.io/docs/user-guide/images/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-node-2 kubernetes]# cat /etc/kubernetes/kubelet |grep KUBELET_POD_INFRA_CONTAINER</span><br><span class="line">KUBELET_POD_INFRA_CONTAINER=&quot;--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest&quot;</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# docker images</span><br><span class="line">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.access.redhat.com/rhel7/pod-infrastructure   latest              ee020ceeef01        3 months ago        215.4 MB</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                                        COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3c00d5e7d1e9        registry.access.redhat.com/rhel7/pod-infrastructure:latest   &quot;/pod&quot;              7 minutes ago       Up 7 minutes                            k8s_POD.c36b0a77_nginx_default_e7bd8714-616f-11e6-a406-000c2980ea46_b03d011b</span><br><span class="line"></span><br><span class="line">＃主节点,查看pod状态，正在pull nginx镜像！</span><br><span class="line">[root@kubernetes-controller ~]# kubectl describe pods nginx|tail -6</span><br><span class="line">  ---------     --------        -----   ----                            -------------           --------        ------                  -------</span><br><span class="line">  8m            8m              1       &#123;kubelet kubernetes-node-3&#125;                             Warning         MissingClusterDNS       kubelet does not have ClusterDNS IP configured and cannot create Pod using &quot;ClusterFirst&quot; policy. Falling back to DNSDefault policy.</span><br><span class="line">  8m            8m              1       &#123;default-scheduler &#125;                                    Normal          Scheduled               Successfully assigned nginx to kubernetes-node-3</span><br><span class="line">  8m            8m              1       &#123;kubelet kubernetes-node-3&#125;     spec.containers&#123;nginx&#125;  Normal          Pulling                 pulling image &quot;nginx&quot;</span><br></pre></td></tr></table></figure>
<p>经过我多次重试，终于把nginx下载下来了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-node-3 ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">Trying to pull repository docker.io/library/nginx ... </span><br><span class="line">latest: Pulling from docker.io/library/nginx</span><br><span class="line">51f5c6a04d83: Already exists </span><br><span class="line">a3ed95caeb02: Pulling fs layer </span><br><span class="line">51d229e136d0: Pull complete </span><br><span class="line">bcd41daec8cc: Pull complete </span><br><span class="line">Digest: sha256:0fe6413f3e30fcc5920bc8fa769280975b10b1c26721de956e1428b9e2f29d04</span><br><span class="line">Status: Image is up to date for docker.io/nginx:latest</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]#  docker images</span><br><span class="line">REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/nginx                                       latest              0d409d33b27e        10 weeks ago        182.7 MB</span><br><span class="line">registry.access.redhat.com/rhel7/pod-infrastructure   latest              ee020ceeef01        3 months ago        215.4 MB</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# docker ps -a     </span><br><span class="line">CONTAINER ID        IMAGE                                                        COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2f2de065fd05        nginx                                                        &quot;nginx -g &apos;daemon off&quot;   21 seconds ago      Up 20 seconds                           k8s_nginx.fa5127aa_nginx_default_e7bd8714-616f-11e6-a406-000c2980ea46_f5a8b2ec</span><br><span class="line">3c00d5e7d1e9        registry.access.redhat.com/rhel7/pod-infrastructure:latest   &quot;/pod&quot;                   53 minutes ago      Up 53 minutes                           k8s_POD.c36b0a77_nginx_default_e7bd8714-616f-11e6-a406-000c2980ea46_b03d011b</span><br></pre></td></tr></table></figure></p>
<p>如上最后一条命了执行完成，可以看到up了两个容器，一个是pod系统基础容器，另一个是我创建的容器！</p>
<p>主节点查看pod状态,pod从创建经历了几个过程：Scheduled－&gt;Pulling-&gt;Pulled-&gt;Created-&gt;Started<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]#  kubectl describe pod|tail -8</span><br><span class="line">  58m           58m             1       &#123;default-scheduler &#125;                                    Normal          Scheduled               Successfully assigned nginx to kubernetes-node-3</span><br><span class="line">  58m           58m             1       &#123;kubelet kubernetes-node-3&#125;     spec.containers&#123;nginx&#125;  Normal          Pulling                 pulling image &quot;nginx&quot;</span><br><span class="line">  58m           5m              2       &#123;kubelet kubernetes-node-3&#125;                             Warning         MissingClusterDNS       kubelet does not have ClusterDNS IP configured and cannot create Pod using &quot;ClusterFirst&quot; policy. Falling back to DNSDefault policy.</span><br><span class="line">  5m            5m              1       &#123;kubelet kubernetes-node-3&#125;     spec.containers&#123;nginx&#125;  Normal          Pulled                  Successfully pulled image &quot;nginx&quot;</span><br><span class="line">  5m            5m              1       &#123;kubelet kubernetes-node-3&#125;     spec.containers&#123;nginx&#125;  Normal          Created                 Created container with docker id 2f2de065fd05</span><br><span class="line">  5m            5m              1       &#123;kubelet kubernetes-node-3&#125;     spec.containers&#123;nginx&#125;  Normal          Started                 Started container with docker id 2f2de065fd05</span><br></pre></td></tr></table></figure></p>
<p>查看pod日志内容,这个容器木有日志可看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]# kubectl logs --tail=10 nginx  </span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl logs -f nginx</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]#  docker logs 2f2de065fd05</span><br></pre></td></tr></table></figure></p>
<p>进入容器验证nginx,挺智能的，我进入容器失败,容器不支持，卡住,容器自动退出，docker ps -a里面立马启动一个新nginx容器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]# kubectl get pods</span><br><span class="line">NAME      READY     STATUS    RESTARTS   AGE</span><br><span class="line">nginx     1/1       Running   0          1h</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]#  docker inspect 3c00d5e7d1e9|grep IPAddress</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.16.60.2&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.16.60.2&quot;,</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# yum install util-linux</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# docker inspect -f &apos;&#123;&#123;.State.Pid&#125;&#125;&apos; d1ea6b36b77e</span><br><span class="line">24765</span><br><span class="line"></span><br><span class="line">[root@kubernetes-node-3 ~]# nsenter --target 24765 --mount --uts --ipc --net --pid</span><br><span class="line">-bash: warning: setlocale: LC_ALL: cannot change locale (en_US.utf-8)</span><br><span class="line">root@nginx:/# ps aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.0  31680  2868 ?        Ss   17:28   0:00 nginx: master process nginx -g daemon off;</span><br><span class="line">nginx        10  0.0  0.0  32072  1692 ?        S    17:28   0:00 nginx: worker process</span><br><span class="line">root         11  0.1  0.0  20288  1912 ?        S    17:49   0:00 -bash</span><br><span class="line">root         15  0.0  0.0  17492  1164 ?        R+   17:49   0:00 ps aux</span><br><span class="line">root@nginx:/# ps -ef|grep nginx</span><br><span class="line">root          1      0  0 17:28 ?        00:00:00 nginx: master process nginx -g daemon off;</span><br><span class="line">nginx        10      1  0 17:28 ?        00:00:00 nginx: worker process</span><br><span class="line">root         17     11  0 17:50 ?        00:00:00 grep nginx</span><br><span class="line"></span><br><span class="line">root@nginx:/# cat /etc/hosts|tail -1</span><br><span class="line">172.16.60.2     nginx</span><br><span class="line"></span><br><span class="line">root@nginx:/# ip addr           </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: eth0@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:10:3c:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.16.60.2/24 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:acff:fe10:3c02/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">root@nginx:/# exit</span><br><span class="line">logout</span><br><span class="line"></span><br><span class="line">退出不会影响容器状态</span><br><span class="line">[root@kubernetes-node-3 ~]# docker ps -l</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">d1ea6b36b77e        nginx               &quot;nginx -g &apos;daemon off&quot;   24 minutes ago      Up 24 minutes                           k8s_nginx.fa5127aa_nginx_default_e7bd8714-616f-11e6-a406-000c2980ea46_831516c2</span><br><span class="line"></span><br><span class="line"># show Pods list</span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods -o wide </span><br><span class="line">NAME      READY     STATUS    RESTARTS   AGE       NODE</span><br><span class="line">nginx     1/1       Running   1          1h        kubernetes-node-3</span><br><span class="line"></span><br><span class="line"># display assigned IP address on the Pod</span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods nginx -o yaml | grep &quot;podIP&quot;  </span><br><span class="line">  podIP: 172.16.60.2</span><br><span class="line"></span><br><span class="line"># access to the Pod</span><br><span class="line">[root@kubernetes-controller ~]# curl http://172.16.60.2/</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>kubernetes-dashboard 下载被墙，只能找个hosts映射下,如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]# tail -2 /etc/hosts</span><br><span class="line">220.255.2.153   www.gcr.io</span><br><span class="line">220.255.2.153   gcr.io</span><br></pre></td></tr></table></figure></p>
<p>时速云，国内镜像站，挺不错，不过这里我没有采用 - <a href="https://hub.tenxcloud.com/search?q=kubernetes-dashboard&amp;source=tenxcloud" target="_blank" rel="noopener">https://hub.tenxcloud.com/search?q=kubernetes-dashboard&amp;source=tenxcloud</a></p>
<h1 id="kubernetes-dashboard-UI-pods-service"><a href="#kubernetes-dashboard-UI-pods-service" class="headerlink" title="kubernetes-dashboard UI pods service"></a>kubernetes-dashboard UI pods service</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]# wget https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# vi kubernetes-dashboard.yaml </span><br><span class="line">#change 48 line</span><br><span class="line">args:</span><br><span class="line">- --apiserver-host=http://192.168.2.120:8080</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl create -f kubernetes-dashboard.yaml</span><br><span class="line">deployment &quot;kubernetes-dashboard&quot; created</span><br><span class="line">You have exposed your service on an external port on all nodes in your</span><br><span class="line">cluster.  If you want to expose this service to the external internet, you may</span><br><span class="line">need to set up firewall rules for the service port(s) (tcp:32763) to serve traffic.</span><br><span class="line"></span><br><span class="line">See http://releases.k8s.io/release-1.2/docs/user-guide/services-firewalls.md for more details.</span><br><span class="line">service &quot;kubernetes-dashboard&quot; created</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods --namespace=kube-system</span><br><span class="line">NAME                                   READY     STATUS              RESTARTS   AGE</span><br><span class="line">kubernetes-dashboard-564869829-9ipet   0/1       ContainerCreating   0          11m</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods --namespace=default</span><br><span class="line">NAME      READY     STATUS    RESTARTS   AGE</span><br><span class="line">nginx     1/1       Running   0          40m</span><br><span class="line"></span><br><span class="line">-- 调度到第一个node上面启动UI</span><br><span class="line">[root@kubernetes-controller ~]# kubectl describe pods --namespace=kube-system|tail -3</span><br><span class="line">  13m           13m             1       &#123;default-scheduler &#125;                    Normal          Scheduled       Successfully assigned kubernetes-dashboard-564869829-9ipet to kubernetes-node-1</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get svc --namespace=kube-system</span><br><span class="line">NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes-dashboard   10.254.247.205   nodes         80/TCP    29m</span><br><span class="line"></span><br><span class="line"># ui启动报错，猜测是yaml缩近问题！修改yaml重新提交！</span><br><span class="line">[root@kubernetes-node-1 ~]# docker logs 34d4de854cb7</span><br><span class="line">Starting HTTP server on port 9090</span><br><span class="line">Creating API server client for http://kubernetes-controller:8080</span><br><span class="line">Error while initializing connection to Kubernetes apiserver. This most likely means that the cluster is misconfigured (e.g., it has invalid apiserver certificates or service accounts configuration) or the --apiserver-host param points to a server that does not exist. Reason: Get http://kubernetes-controller:8080/version: dial tcp: lookup kubernetes-controller on 114.114.114.114:53: no such host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get po --namespace=kube-system</span><br><span class="line">NAME                                   READY     STATUS             RESTARTS   AGE</span><br><span class="line">kubernetes-dashboard-564869829-9ipet   0/1       CrashLoopBackOff   13         1h</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl --namespace=kube-system get ep kubernetes-dashboard</span><br><span class="line">NAME                   ENDPOINTS   AGE</span><br><span class="line">kubernetes-dashboard               1h</span><br><span class="line"></span><br><span class="line">#删除kubernetes-dashboard services,然后重建</span><br><span class="line">[root@kubernetes-controller ~]# kubectl --namespace=kube-system delete deployments kubernetes-dashboard</span><br><span class="line">deployment &quot;kubernetes-dashboard&quot; deleted</span><br><span class="line">[root@kubernetes-controller ~]# kubectl --namespace=kube-system delete services kubernetes-dashboard   </span><br><span class="line">service &quot;kubernetes-dashboard&quot; deleted</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl --namespace=kube-system get ep kubernetes-dashboard            </span><br><span class="line">Error from server: endpoints &quot;kubernetes-dashboard&quot; not found</span><br><span class="line">[root@kubernetes-controller ~]# kubectl get po --namespace=kube-system  </span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl create -f kubernetes-dashboard.yaml</span><br><span class="line"></span><br><span class="line"># 查看那个节点启动的kubernetes-dashboard 服务</span><br><span class="line">[root@kubernetes-controller ~]# kubectl describe pods --namespace=kube-system </span><br><span class="line"></span><br><span class="line">#节点3调度起来了，就是yaml缩近问题</span><br><span class="line">[root@kubernetes-node-3 ~]#  docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                                        COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br><span class="line">653605a9be93        gcr.io/google_containers/kubernetes-dashboard-amd64:v1.1.1   &quot;/dashboard --port=90&quot;   About a minute ago   Up About a minute                       k8s_kubernetes-dashboard.9b6ddaae_kubernetes-dashboard-1221276838-zh52d_kube-system_926ac1f1-61da-11e6-a406-000c2980ea46_11d0d1fc</span><br><span class="line">d9efdc702581        registry.access.redhat.com/rhel7/pod-infrastructure:latest   &quot;/pod&quot;                   About a minute ago   Up About a minute                       k8s_POD.42430ae1_kubernetes-dashboard-1221276838-zh52d_kube-system_926ac1f1-61da-11e6-a406-000c2980ea46_c69022c9</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get svc --namespace=kube-system</span><br><span class="line">NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes-dashboard   10.254.217.183   nodes         80/TCP    4m</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get svc  --namespace=kube-system -o wide</span><br><span class="line">NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE       SELECTOR</span><br><span class="line">kubernetes-dashboard   10.254.217.183   nodes         80/TCP    1h        app=kubernetes-dashboard</span><br></pre></td></tr></table></figure>
<p>最后通过<a href="http://192.168.2.120:8080/ui" target="_blank" rel="noopener">http://192.168.2.120:8080/ui</a>  即可访问kubernetes-dashboard</p>
<h1 id="验证kubernetes集群基本功能"><a href="#验证kubernetes集群基本功能" class="headerlink" title="验证kubernetes集群基本功能"></a>验证kubernetes集群基本功能</h1><p>快速启动,一键部署kubernetes 提供的guestbook,redis services example.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/kubernetes/kubernetes.git</span><br><span class="line"></span><br><span class="line">$ cd kubernetes</span><br><span class="line"></span><br><span class="line">$ kubectl create -f examples/guestbook/all-in-one/guestbook-all-in-one.yaml</span><br><span class="line">service &quot;redis-master&quot; created</span><br><span class="line">deployment &quot;redis-master&quot; created</span><br><span class="line">service &quot;redis-slave&quot; created</span><br><span class="line">deployment &quot;redis-slave&quot; created</span><br><span class="line">service &quot;frontend&quot; created</span><br><span class="line">deployment &quot;frontend&quot; created</span><br></pre></td></tr></table></figure>
<p>列表所有的kubernetes services<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller kubernetes]# kubectl get services</span><br><span class="line">NAME           CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">frontend       10.254.210.70    &lt;none&gt;        80/TCP     1m</span><br><span class="line">kubernetes     10.254.0.1       &lt;none&gt;        443/TCP    2h</span><br><span class="line">redis-master   10.254.177.239   &lt;none&gt;        6379/TCP   1m</span><br><span class="line">redis-slave    10.254.234.101   &lt;none&gt;        6379/TCP   1m</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]#  kubectl get pods</span><br><span class="line">NAME                            READY     STATUS    RESTARTS   AGE</span><br><span class="line">frontend-440143558-0iiy1        1/1       Running   0          8m</span><br><span class="line">frontend-440143558-u5uja        1/1       Running   0          8m</span><br><span class="line">frontend-440143558-xtlh3        1/1       Running   0          8m</span><br><span class="line">nginx                           1/1       Running   0          1h</span><br><span class="line">redis-master-2353460263-fqdoc   1/1       Running   0          8m</span><br><span class="line">redis-slave-1691881626-fs9m6    1/1       Running   0          8m</span><br><span class="line">redis-slave-1691881626-xex67    1/1       Running   0          8m</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# curl http://172.16.49.3/</span><br><span class="line">&lt;html ng-app=&quot;redis&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Guestbook&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;controllers.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.0/ui-bootstrap-tpls.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body ng-controller=&quot;RedisCtrl&quot;&gt;</span><br><span class="line">    &lt;div style=&quot;width: 50%; margin-left: 20px&quot;&gt;</span><br><span class="line">      &lt;h2&gt;Guestbook&lt;/h2&gt;</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">    &lt;input ng-model=&quot;msg&quot; placeholder=&quot;Messages&quot; class=&quot;form-control&quot; type=&quot;text&quot; name=&quot;input&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; ng-click=&quot;controller.onRedis()&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div ng-repeat=&quot;msg in messages track by $index&quot;&gt;</span><br><span class="line">        &#123;&#123;msg&#125;&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl describe pods redis-master-2353460263-fqdoc</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]#  kubectl logs redis-master-2353460263-fqdoc</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ &apos;&apos;-._                                             </span><br><span class="line">      _.-``    `.  `_.  &apos;&apos;-._           Redis 2.8.19 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &apos;&apos;-._                                   </span><br><span class="line"> (    &apos;      ,       .-`  | `,    )     Running in stand alone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&apos;` _.-&apos;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&apos;    |     PID: 1</span><br><span class="line">  `-._    `-._  `-./  _.-&apos;    _.-&apos;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&apos;    _.-&apos;_.-&apos;|                                  </span><br><span class="line"> |    `-._`-._        _.-&apos;_.-&apos;    |           http://redis.io        </span><br><span class="line">  `-._    `-._`-.__.-&apos;_.-&apos;    _.-&apos;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&apos;    _.-&apos;_.-&apos;|                                  </span><br><span class="line"> |    `-._`-._        _.-&apos;_.-&apos;    |                                  </span><br><span class="line">  `-._    `-._`-.__.-&apos;_.-&apos;    _.-&apos;                                   </span><br><span class="line">      `-._    `-.__.-&apos;    _.-&apos;                                       </span><br><span class="line">          `-._        _.-&apos;                                           </span><br><span class="line">              `-.__.-&apos;                  </span><br><span class="line"></span><br><span class="line">[1] 17 Aug 10:40:38.156 # Server started, Redis version 2.8.19</span><br><span class="line">[1] 17 Aug 10:40:38.157 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &apos;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&apos; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span><br><span class="line">[1] 17 Aug 10:40:38.157 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">[1] 17 Aug 10:40:38.157 * The server is now ready to accept connections on port 6379</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get services</span><br><span class="line">NAME           CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">frontend       10.254.210.70    &lt;none&gt;        80/TCP     15h</span><br><span class="line">kubernetes     10.254.0.1       &lt;none&gt;        443/TCP    18h</span><br><span class="line">redis-master   10.254.177.239   &lt;none&gt;        6379/TCP   15h</span><br><span class="line">redis-slave    10.254.234.101   &lt;none&gt;        6379/TCP   15h</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get deployments</span><br><span class="line">NAME           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">frontend       3         3         3            3           15h</span><br><span class="line">redis-master   1         1         1            1           15h</span><br><span class="line">redis-slave    2         2         2            2           15h</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods</span><br><span class="line">NAME                            READY     STATUS    RESTARTS   AGE</span><br><span class="line">frontend-440143558-0iiy1        1/1       Running   0          15h</span><br><span class="line">frontend-440143558-u5uja        1/1       Running   0          15h</span><br><span class="line">frontend-440143558-xtlh3        1/1       Running   0          15h</span><br><span class="line">nginx                           1/1       Running   0          17h</span><br><span class="line">redis-master-2353460263-fqdoc   1/1       Running   0          15h</span><br><span class="line">redis-slave-1691881626-fs9m6    1/1       Running   0          15h</span><br><span class="line">redis-slave-1691881626-xex67    1/1       Running   0          15h</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl get pods -L tier</span><br><span class="line">NAME                            READY     STATUS    RESTARTS   AGE       TIER</span><br><span class="line">frontend-440143558-0iiy1        1/1       Running   0          15h       frontend</span><br><span class="line">frontend-440143558-u5uja        1/1       Running   0          15h       frontend</span><br><span class="line">frontend-440143558-xtlh3        1/1       Running   0          15h       frontend</span><br><span class="line">nginx                           1/1       Running   0          17h       &lt;none&gt;</span><br><span class="line">redis-master-2353460263-fqdoc   1/1       Running   0          15h       backend</span><br><span class="line">redis-slave-1691881626-fs9m6    1/1       Running   0          15h       backend</span><br><span class="line">redis-slave-1691881626-xex67    1/1       Running   0          15h       backend</span><br></pre></td></tr></table></figure></p>
<p>清理redis相关服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@kubernetes-controller ~]#  kubectl get pods -o wide </span><br><span class="line">NAME                            READY     STATUS    RESTARTS   AGE       NODE</span><br><span class="line">apache-httpd                    1/1       Running   0          41m       kubernetes-node-3</span><br><span class="line">frontend-440143558-0iiy1        1/1       Running   0          4d        kubernetes-node-1</span><br><span class="line">frontend-440143558-u5uja        1/1       Running   1          4d        kubernetes-node-3</span><br><span class="line">frontend-440143558-xtlh3        1/1       Running   1          4d        kubernetes-node-2</span><br><span class="line">nginx                           1/1       Running   0          4d        kubernetes-node-3</span><br><span class="line">redis-master-2353460263-fqdoc   1/1       Running   0          4d        kubernetes-node-2</span><br><span class="line">redis-slave-1691881626-fs9m6    1/1       Running   1          4d        kubernetes-node-3</span><br><span class="line">redis-slave-1691881626-xex67    1/1       Running   0          4d        kubernetes-node-1</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]# kubectl delete deployments,services -l &quot;app in (redis, guestbook)&quot;</span><br><span class="line">deployment &quot;frontend&quot; deleted</span><br><span class="line">deployment &quot;redis-master&quot; deleted</span><br><span class="line">deployment &quot;redis-slave&quot; deleted</span><br><span class="line">service &quot;frontend&quot; deleted</span><br><span class="line">service &quot;redis-master&quot; deleted</span><br><span class="line">service &quot;redis-slave&quot; deleted</span><br><span class="line"></span><br><span class="line">[root@kubernetes-controller ~]#  kubectl get pods -o wide </span><br><span class="line">NAME           READY     STATUS    RESTARTS   AGE       NODE</span><br><span class="line">apache-httpd   1/1       Running   0          42m       kubernetes-node-3</span><br><span class="line">nginx          1/1       Running   0          4d        kubernetes-node-3</span><br></pre></td></tr></table></figure></p>
<p>原创文章，转载请注明： 转载自<a href="http://www.itweet.cn" target="_blank" rel="noopener">Itweet</a>的博客<br><code>本博客的文章集合:</code> <a href="http://www.itweet.cn/blog/archive/" target="_blank" rel="noopener">http://www.itweet.cn/blog/archive/</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/kubernates/">kubernates</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/08/16/Kubernetes-Use-Persistent-Storage/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Kubernetes Use Persistent Storage</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2016/08/14/kubernetes-cluster-install/">
        <span class="next-text nav-default">kubernetes-cluster-install</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/realXuJiang/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
