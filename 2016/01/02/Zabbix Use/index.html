<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="Zabbix Use">




  <meta name="keywords" content="zabbix,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2016/01/02/Zabbix Use/">


<meta name="description" content="监控概述 1、主机监控  1.1 硬件 1.2 Cpu 1.3 Memory IO 2.1 Disk IO 2.2 Network IO     2、业务监控  3、故障检测分析 4、应用监控  1234567891011不同业务类型CPU,MEM各种指标不同，IO密集型，CPU密集型，比如数据库服务器(IO,CPU)，大数据集群服务器不同业务类型(IO密集型，CPU密集型)，对监控指标健康评判有">
<meta name="keywords" content="zabbix">
<meta property="og:type" content="article">
<meta property="og:title" content="Zabbix Use">
<meta property="og:url" content="http://itweet.github.io/2016/01/02/Zabbix Use/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="监控概述 1、主机监控  1.1 硬件 1.2 Cpu 1.3 Memory IO 2.1 Disk IO 2.2 Network IO     2、业务监控  3、故障检测分析 4、应用监控  1234567891011不同业务类型CPU,MEM各种指标不同，IO密集型，CPU密集型，比如数据库服务器(IO,CPU)，大数据集群服务器不同业务类型(IO密集型，CPU密集型)，对监控指标健康评判有">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-07-02T13:09:15.492Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zabbix Use">
<meta name="twitter:description" content="监控概述 1、主机监控  1.1 硬件 1.2 Cpu 1.3 Memory IO 2.1 Disk IO 2.2 Network IO     2、业务监控  3、故障检测分析 4、应用监控  1234567891011不同业务类型CPU,MEM各种指标不同，IO密集型，CPU密集型，比如数据库服务器(IO,CPU)，大数据集群服务器不同业务类型(IO密集型，CPU密集型)，对监控指标健康评判有">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> Zabbix Use - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Zabbix Use
        
      </h1>

      <time class="post-time">
          1月 02 2016
      </time>
    </header>



    
            <div class="post-content">
            <h1 id="监控概述"><a href="#监控概述" class="headerlink" title="监控概述"></a>监控概述</h1><ul>
<li><p>1、主机监控</p>
<ul>
<li>1.1 硬件</li>
<li>1.2 Cpu</li>
<li>1.3 Memory</li>
<li>IO<ul>
<li>2.1 Disk IO</li>
<li>2.2 Network IO</li>
</ul>
</li>
</ul>
</li>
<li><p>2、业务监控</p>
</li>
<li>3、故障检测分析</li>
<li>4、应用监控</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">不同业务类型CPU,MEM各种指标不同，IO密集型，CPU密集型，比如数据库服务器(IO,CPU)，大数据集群服务器不同业务类型(IO密集型，CPU密集型)，对监控指标健康评判有很大区别！</span><br><span class="line"></span><br><span class="line">1、CPU监控，idle time,user time,system time</span><br><span class="line"></span><br><span class="line">2、内存监控，total,used,free,shared,buffers(缓冲-加速操作),cached(减少IO,mem交互,增强数据读取效率)</span><br><span class="line"></span><br><span class="line">监控系统: </span><br><span class="line">    a.首先确定业务类型;</span><br><span class="line">    b.熟悉监控指标;</span><br><span class="line">    c.确定性能基准线;</span><br><span class="line">    d.使用工具-获取数据-展示-设置阈值-触发报警-告警通知-通知升级;</span><br></pre></td></tr></table></figure>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="1-install-EPEL"><a href="#1-install-EPEL" class="headerlink" title="1. install EPEL"></a>1. install EPEL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server ~]$ sudo rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line">Retrieving https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line">warning: /var/tmp/rpm-tmp.UjvRv8: Header V3 RSA/SHA256 Signature, key ID 0608b895: NOKEY</span><br><span class="line">Preparing...                ########################################### [100%]</span><br><span class="line">   1:epel-release           ########################################### [100%]</span><br></pre></td></tr></table></figure>
<h2 id="2-install-io-util"><a href="#2-install-io-util" class="headerlink" title="2. install io util"></a>2. install io util</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">http://www.tecmint.com/install-iotop-monitor-linux-disk-io-in-rhel-centos-and-fedora/</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ sudo yum update kernel </span><br><span class="line">[whoami@apache-server ~]$ sudo yum install python python-ctypes</span><br><span class="line">[whoami@apache-server ~]$ sudo yum install iostat -y</span><br><span class="line">[whoami@apache-server ~]$ sudo yum install iftop -y</span><br><span class="line">[whoami@apache-server ~]$ sudo yum install iotop -y</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ iostat </span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.11    0.00    0.26    0.39    0.00   99.24</span><br><span class="line"></span><br><span class="line">Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn</span><br><span class="line">scd0              0.01         0.04         0.00        352          0</span><br><span class="line">sda               1.11        77.50        12.72     675406     110836</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$  iostat -n 1 2</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ iostat -x 1 1</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ sudo iftop -n </span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ sudo iotop -n 1</span><br></pre></td></tr></table></figure>
<h2 id="3-准备2台主机"><a href="#3-准备2台主机" class="headerlink" title="3. 准备2台主机"></a>3. 准备2台主机</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 提前做好hosts映射</span><br><span class="line">[whoami@apache-server ~]$ hostname </span><br><span class="line">apache-server</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ hostname </span><br><span class="line">server1</span><br><span class="line"></span><br><span class="line">-- 替换国内yum源</span><br><span class="line">http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line"></span><br><span class="line">[whoami@server1 yum.repos.d]$ sudo wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line">[whoami@server1 yum.repos.d]$ yum clean all &amp;&amp; yum makecache</span><br><span class="line"></span><br><span class="line">--关闭selinux，iptable</span><br><span class="line">[whoami@apache-server conf]$ sudo setenforce 0 </span><br><span class="line">[whoami@apache-server conf]$ cat /etc/selinux/config |grep SELINUX=disabled</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>
<h2 id="4-安装基础软件包"><a href="#4-安装基础软件包" class="headerlink" title="4. 安装基础软件包"></a>4. 安装基础软件包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server ~]$ sudo  yum install httpd php mysql mysql-server php-pdo php-mysql gcc gcc-c++ glibc mysql mysql-devel libxml2-devel curl curl-devel net-snmp net-snmp-devel libssh2-devel OpenIPMI-devel php-gd php-xml php-mbstring php-bcmath -y</span><br></pre></td></tr></table></figure>
<h1 id="zbbix-install"><a href="#zbbix-install" class="headerlink" title="zbbix install"></a>zbbix install</h1><h2 id="zabbix-iso"><a href="#zabbix-iso" class="headerlink" title="zabbix iso"></a>zabbix iso</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://www.zabbix.com/download.php</span><br><span class="line"></span><br><span class="line">Live CD/DVD (.iso) : </span><br><span class="line">    http://ncu.dl.sourceforge.net/project/zabbix/ZABBIX Latest Stable/2.4.6/Zabbix_2.4_x86_64_13.1.x86_64-2.4.6.iso</span><br><span class="line"></span><br><span class="line">[whoami@apache-server 6]$ yum list|grep zabbix|wc -l</span><br><span class="line">43</span><br></pre></td></tr></table></figure>
<h2 id="Zabbix-环境准备"><a href="#Zabbix-环境准备" class="headerlink" title="Zabbix 环境准备"></a>Zabbix 环境准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">http://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/2.4.7/zabbix-2.4.7.tar.gz/download</span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix]$ tar zxf zabbix-2.4.7.tar.gz </span><br><span class="line"></span><br><span class="line">-- start apache server</span><br><span class="line">[whoami@apache-server zabbix]$ sudo /etc/init.d/httpd restart</span><br><span class="line">Stopping httpd:                                            [  OK  ]</span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line"></span><br><span class="line">-- mysql 配置</span><br><span class="line">[whoami@apache-server zabbix]$ sudo cp /usr/share/mysql/my-medium.cnf /etc/my.cnf </span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix]$ sudo vim /etc/my.cnf </span><br><span class="line"># The MySQL server</span><br><span class="line">[mysqld]</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">init-connect = &apos;set NAMES utf8&apos;</span><br><span class="line">character-set-server = utf8</span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix]$ sudo /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix]$ sudo lsof -i :3306</span><br><span class="line">COMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">mysqld  3316 mysql   11u  IPv4  49880      0t0  TCP *:mysql (LISTEN)</span><br><span class="line"></span><br><span class="line">-- apache server test</span><br><span class="line">[whoami@apache-server zabbix]$ cd /var/www/html/</span><br><span class="line">[whoami@apache-server html]$ cat info.php </span><br><span class="line">&lt;?php</span><br><span class="line"> phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">   验证：http://apache-server/info.php</span><br></pre></td></tr></table></figure>
<h2 id="Zabbix-init-database"><a href="#Zabbix-init-database" class="headerlink" title="Zabbix init database"></a>Zabbix init database</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database zabbix;</span><br><span class="line">mysql&gt; grant all on zabbix.* to zabbix@localhost identified by &apos;admin&apos;; </span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line"></span><br><span class="line">--init database table</span><br><span class="line">[whoami@apache-server mysql]$ pwd</span><br><span class="line">/data/zabbix/zabbix-2.4.7/database/mysql</span><br><span class="line">[whoami@apache-server mysql]$ mysql -u zabbix -padmin zabbix &lt; schema.sql </span><br><span class="line">[whoami@apache-server mysql]$ mysql -u zabbix -padmin zabbix &lt; images.sql </span><br><span class="line">[whoami@apache-server mysql]$ mysql -u zabbix -padmin zabbix &lt; data.sql</span><br><span class="line">[whoami@apache-server mysql]$ mysql -u zabbix -padmin -e &apos;use zabbix;show tables;&apos;|wc -l</span><br><span class="line">105</span><br></pre></td></tr></table></figure>
<h1 id="Zabbix-Source-install-Server"><a href="#Zabbix-Source-install-Server" class="headerlink" title="Zabbix Source install Server"></a>Zabbix Source install Server</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server zabbix-2.4.7]$ cd /data/zabbix/zabbix-2.4.7</span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix-2.4.7]$ ./configure --prefix=/data/zabbix/zabbix_server --enable-server --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2 --with-openipmi --with-ssh2</span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix-2.4.7]$ make install</span><br><span class="line"></span><br><span class="line">[whoami@apache-server zabbix-2.4.7]$ ls /data/zabbix/zabbix_server/</span><br><span class="line">etc  lib  sbin  share</span><br><span class="line"></span><br><span class="line">-- copy 源码中web页面到apache服务器根目录</span><br><span class="line">[whoami@apache-server php]$ cd /data/zabbix/zabbix-2.4.7/frontends/php</span><br><span class="line">[whoami@apache-server php]$ mkdir /data/html/zabbix/</span><br><span class="line">[whoami@apache-server php]$ cp -r * /data/html/zabbix/</span><br><span class="line">[whoami@apache-server html]$ sudo chown -R apache.apache /var/www/html/ </span><br><span class="line">[whoami@apache-server etc]$ sudo chown -R apache.apache /data/html/</span><br><span class="line"></span><br><span class="line">--修改配置文件，database,zabbix log</span><br><span class="line">[whoami@apache-server zabbix-2.4.7]$ cd /data/zabbix/zabbix_server/</span><br><span class="line">[whoami@apache-server etc]$ pwd</span><br><span class="line">/data/zabbix/zabbix_server/etc</span><br><span class="line"></span><br><span class="line">[whoami@apache-server etc]$ grep &apos;^[a-Z]&apos; zabbix_server.conf</span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=admin</span><br><span class="line"></span><br><span class="line">--- starting zabbix server</span><br><span class="line">[whoami@apache-server etc]$ /data/zabbix/zabbix_server/sbin/zabbix_server -c /data/zabbix/zabbix_server/etc/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">--日志目录&amp;&amp;端口</span><br><span class="line">[whoami@apache-server etc]$ cat /tmp/zabbix_server.log </span><br><span class="line">[whoami@apache-server etc]$ lsof -i :10051|wc -l</span><br><span class="line">55</span><br><span class="line"></span><br><span class="line">-- php 配置文件修改</span><br><span class="line">[whoami@apache-server etc]$ cat /etc/php.ini</span><br><span class="line">post_max_size = 16M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">date.timezone = PRC</span><br><span class="line">[whoami@apache-server etc]$ sudo /etc/init.d/httpd restart</span><br><span class="line">Stopping httpd:                                            [  OK  ]</span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line"></span><br><span class="line">-- 访问zabbix web页面</span><br><span class="line">    http://apache-server/zabbix/setup.php</span><br><span class="line">    web页面安装zabbix...</span><br><span class="line">    1. Check of pre-requisites 完全正常即可开始安装</span><br></pre></td></tr></table></figure>
<h1 id="Zabbix-yum-install-agent"><a href="#Zabbix-yum-install-agent" class="headerlink" title="Zabbix yum install agent"></a>Zabbix yum install agent</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server mysql]$ yum list|grep zabbix22</span><br><span class="line">zabbix22.x86_64                             2.2.11-1.el6                 epel  </span><br><span class="line"></span><br><span class="line">[whoami@apache-server mysql]$ sudo yum install zabbix22-agent -y</span><br><span class="line">[whoami@server1 ~]$ sudo yum install zabbix22-agent -y</span><br><span class="line"></span><br><span class="line">--agent 配置</span><br><span class="line">[whoami@apache-server html]$ sudo vim /etc/zabbix_agentd.conf</span><br><span class="line">[whoami@apache-server html]$ grep &apos;^[a-Z]&apos; /etc/zabbix/zabbix_agentd.conf |grep Server</span><br><span class="line">Server=apache-server</span><br><span class="line">ServerActive=127.0.0.1</span><br><span class="line"></span><br><span class="line">[whoami@apache-server html]$ grep &apos;^[a-Z]&apos; /etc/zabbix/zabbix_agentd.conf </span><br><span class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_agentd.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">Server=192.168.2.125</span><br><span class="line">ServerActive=127.0.0.1</span><br><span class="line">Hostname=Zabbix server</span><br><span class="line"></span><br><span class="line">-- staring zabbix agent</span><br><span class="line">[whoami@apache-server html]$ sudo /etc/init.d/zabbix-agentd start</span><br><span class="line">Starting Zabbix agent:                                     [  OK  ]</span><br></pre></td></tr></table></figure>
<h1 id="替换zabbix中文字体"><a href="#替换zabbix中文字体" class="headerlink" title="替换zabbix中文字体"></a>替换zabbix中文字体</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server fonts]$ pwd</span><br><span class="line">/data/html/zabbix/fonts</span><br><span class="line"></span><br><span class="line">[whoami@apache-server fonts]$ sudo mv DejaVuSans.ttf DejaVuSans.ttf.ori</span><br><span class="line"></span><br><span class="line">[whoami@apache-server fonts]$ sudo mv msyh.ttf DejaVuSans.ttf</span><br><span class="line"></span><br><span class="line">[whoami@apache-server fonts]$ sudo chown apache.apache *.ttf</span><br></pre></td></tr></table></figure>
<h1 id="添加zabbix监控主机"><a href="#添加zabbix监控主机" class="headerlink" title="添加zabbix监控主机"></a>添加zabbix监控主机</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ cat /etc/zabbix_agentd.conf |grep Server=192</span><br><span class="line">Server=192.168.2.125</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ sudo /etc/init.d/zabbix-agentd start</span><br><span class="line">Starting Zabbix agent:                                     [  OK  ]</span><br></pre></td></tr></table></figure>
<h1 id="zabbix发送邮件报警"><a href="#zabbix发送邮件报警" class="headerlink" title="zabbix发送邮件报警"></a>zabbix发送邮件报警</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server ~]$ sudo /etc/init.d/postfix start</span><br><span class="line"></span><br><span class="line">[whoami@apache-server ~]$ sudo lsof -i :25   </span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">master  1314 root   12u  IPv4  10348      0t0  TCP localhost:smtp (LISTEN)</span><br><span class="line">master  1314 root   13u  IPv6  10350      0t0  TCP localhost:smtp (LISTEN)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 手动停掉一个agent，触发报警测试</span><br><span class="line">[whoami@server1 ~]$ sudo /etc/init.d/zabbix-agentd stop      </span><br><span class="line">Shutting down Zabbix agent:                                [  OK  ]</span><br><span class="line"></span><br><span class="line">-- 自定义报警方式，上面方式无法发送邮件</span><br></pre></td></tr></table></figure>
<h1 id="zabbix自定义shell命令监控"><a href="#zabbix自定义shell命令监控" class="headerlink" title="zabbix自定义shell命令监控"></a>zabbix自定义shell命令监控</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[whoami@server1 ~]$ sudo ps aux | grep mysql|grep -v grep -c</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">--agent上面实现</span><br><span class="line">[whoami@server1 ~]$ vim /etc/zabbix_agentd.conf </span><br><span class="line">### Option: UserParameter</span><br><span class="line">#       User-defined parameter to monitor. There can be several user-defined parameters.</span><br><span class="line">#       Format: UserParameter=&lt;key&gt;,&lt;shell command&gt;</span><br><span class="line">#       See &apos;zabbix_agentd&apos; directory for examples.</span><br><span class="line">#</span><br><span class="line"># Mandatory: no</span><br><span class="line"># Default:</span><br><span class="line"># UserParameter=</span><br><span class="line">UserParameter = test,ps aux|wc -l</span><br><span class="line">UserParameters=mysql-check,ps aux | grep mysql|grep -v grep -c</span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ sudo /etc/init.d/zabbix-agentd restart</span><br><span class="line">Shutting down Zabbix agent:                                [  OK  ]</span><br><span class="line">Starting Zabbix agent:                                     [  OK  ]</span><br><span class="line"></span><br><span class="line">--另外一个节点验证，监控是否可获取值</span><br><span class="line">[whoami@apache-server ~]$ zabbix_get -s server1 -k mysql-check</span><br><span class="line">2</span><br><span class="line">[whoami@apache-server ~]$ zabbix_get -s server1 -k test</span><br><span class="line">133</span><br><span class="line"></span><br><span class="line">--在web页面添加监控项，定义触发器</span><br></pre></td></tr></table></figure>
<h1 id="zabbix自定义shell脚本监控报警"><a href="#zabbix自定义shell脚本监控报警" class="headerlink" title="zabbix自定义shell脚本监控报警"></a>zabbix自定义shell脚本监控报警</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">--server端实现</span><br><span class="line">[whoami@apache-server etc]$ sudo vim /data/zabbix/zabbix_server/etc/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">420 ### Option: AlertScriptsPath</span><br><span class="line">421 #       Full path to location of custom alert scripts.</span><br><span class="line">422 #       Default depends on compilation options.</span><br><span class="line">423 #</span><br><span class="line">424 # Mandatory: no</span><br><span class="line">425 # Default:</span><br><span class="line">426 # AlertScriptsPath=$&#123;datadir&#125;/zabbix/alertscripts</span><br><span class="line">AlertScriptsPath=/data/zabbix/zabbix_server/alertscripts</span><br><span class="line"></span><br><span class="line">[whoami@apache-server etc]$ mkdir /data/zabbix/zabbix_server/alertscripts</span><br><span class="line"></span><br><span class="line">--kill zabbix_server</span><br><span class="line">[whoami@apache-server alertscripts]$ ps -ef|grep zabbix_server</span><br><span class="line">[whoami@apache-server alertscripts]$ kill 1703</span><br><span class="line"></span><br><span class="line">[whoami@apache-server alertscripts]$ /data/zabbix/zabbix_server/sbin/zabbix_server -c /data/zabbix/zabbix_server/etc/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">--到脚本目录写报警脚本</span><br><span class="line">[whoami@apache-server alertscripts]$ cat sms.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">sms_demo()&#123;</span><br><span class="line">        echo &quot;$1&quot; &quot;$2&quot; &quot;$3&quot; &gt;&gt; /tmp/sms.txt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">        sms_demo &quot;$1&quot; &quot;$2&quot; &quot;$3&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main &quot;$1&quot; &quot;$2&quot; &quot;$3&quot;</span><br><span class="line"></span><br><span class="line">[whoami@apache-server alertscripts]$ sudo chown zabbix:zabbix sms.sh</span><br><span class="line">[whoami@apache-server alertscripts]$ sudo chmod u+x sms.sh </span><br><span class="line"></span><br><span class="line">[whoami@apache-server alertscripts]$ sh sms.sh 1 2 3</span><br><span class="line">[whoami@apache-server alertscripts]$ cat /tmp/sms.txt </span><br><span class="line">1 2 3</span><br><span class="line"></span><br><span class="line">---web页面做如下操作:</span><br><span class="line">    1、管理--&gt;示警媒介类型的组态--&gt;创建媒体类型，默认有三种sms,email,jabber</span><br><span class="line">    2、管理--&gt;用户--&gt;成员--&gt;示例媒介--&gt;添加报警方式</span><br><span class="line">    3、组态--&gt;动作--&gt;操作--&gt;编辑--&gt;修改发送方式</span><br><span class="line">    4、报警声音开启,基本资料--&gt;信息中--&gt;选择开启</span><br><span class="line"></span><br><span class="line">---测试报警</span><br><span class="line">[whoami@apache-server alertscripts]$ tail -f /tmp/sms.txt </span><br><span class="line"></span><br><span class="line">[whoami@server1 ~]$ sudo /etc/init.d/mysqld stop </span><br><span class="line">Stopping mysqld:                                           [  OK  ]</span><br><span class="line">[whoami@server1 ~]$ sudo /etc/init.d/mysqld start</span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br><span class="line"></span><br><span class="line">[whoami@apache-server alertscripts]$ cat /tmp/sms.txt </span><br><span class="line">whoami@itweet.cn PROBLEM: mysql is down Trigger: mysql is down</span><br><span class="line">Trigger status: PROBLEM</span><br><span class="line">Trigger severity: Disaster</span><br><span class="line">Trigger URL: </span><br><span class="line"></span><br><span class="line">Item values:</span><br><span class="line"></span><br><span class="line">1. mysql-check (linux-server1:mysql-check): 0</span><br><span class="line">2. *UNKNOWN* (*UNKNOWN*:*UNKNOWN*): *UNKNOWN*</span><br><span class="line">3. *UNKNOWN* (*UNKNOWN*:*UNKNOWN*): *UNKNOWN*</span><br><span class="line"></span><br><span class="line">Original event ID: 157</span><br><span class="line"></span><br><span class="line">whoami@itweet.cn OK: mysql is down Trigger: mysql is down</span><br><span class="line">Trigger status: OK</span><br><span class="line">Trigger severity: Disaster</span><br><span class="line">Trigger URL: </span><br><span class="line"></span><br><span class="line">Item values:</span><br><span class="line"></span><br><span class="line">1. mysql-check (linux-server1:mysql-check): 2</span><br><span class="line">2. *UNKNOWN* (*UNKNOWN*:*UNKNOWN*): *UNKNOWN*</span><br><span class="line">3. *UNKNOWN* (*UNKNOWN*:*UNKNOWN*): *UNKNOWN*</span><br><span class="line"></span><br><span class="line">Original event ID: 157</span><br><span class="line"></span><br><span class="line">--自定义报警信息值</span><br><span class="line">1、组态--&gt;动作--&gt;动作</span><br><span class="line">2、&lt;默认信息&gt;修改如下：</span><br><span class="line">    &#123;TRIGGER.NAME&#125;</span><br><span class="line">    &#123;ITEM.NAME1&#125; (&#123;HOST.NAME1&#125;:&#123;ITEM.KEY1&#125;): &#123;ITEM.VALUE1&#125;</span><br><span class="line">3、恢复信息</span><br><span class="line">    &#123;TRIGGER.NAME&#125;</span><br><span class="line">    &#123;ITEM.NAME1&#125; (&#123;HOST.NAME1&#125;:&#123;ITEM.KEY1&#125;): &#123;ITEM.VALUE1&#125;</span><br><span class="line"></span><br><span class="line">4、测试</span><br><span class="line">[whoami@apache-server alertscripts]$ tail -f /tmp/sms.txt </span><br><span class="line">whoami@itweet.cn PROBLEM: mysql is down mysql is down</span><br><span class="line">mysql-check (linux-server1:mysql-check): 0</span><br><span class="line"></span><br><span class="line">whoami@itweet.cn OK: mysql is down mysql is down</span><br><span class="line">mysql-check (linux-server1:mysql-check): 2</span><br></pre></td></tr></table></figure>
<h1 id="web监控"><a href="#web监控" class="headerlink" title="web监控"></a>web监控</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[whoami@apache-server alertscripts]$ curl --head http://apache-server/zabbix/dashboard.php</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Tue, 05 Jan 2016 00:37:20 GMT</span><br><span class="line">Server: Apache/2.2.15 (CentOS)</span><br><span class="line">X-Powered-By: PHP/5.3.3</span><br><span class="line">Set-Cookie: zbx_sessionid=9f0df7e514697a36becde98e2538c56c</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br></pre></td></tr></table></figure>
<p>原创文章，转载请注明： 转载自<a href="http://www.itweet.cn" target="_blank" rel="noopener">Itweet</a>的博客<br><code>本博客的文章集合:</code> <a href="http://www.itweet.cn/blog/archive/" target="_blank" rel="noopener">http://www.itweet.cn/blog/archive/</a></p>
<p>参考：<a href="https://www.zabbix.com/documentation/2.4/manual/installation/install_from_packages#red_hat_enterprise_linux_centos" target="_blank" rel="noopener">https://www.zabbix.com/documentation/2.4/manual/installation/install_from_packages#red_hat_enterprise_linux_centos</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/zabbix/">zabbix</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/01/09/Hbase-Region-split-policy/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Hbase-Region-split-policy</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2015/11/26/redis use/">
        <span class="next-text nav-default">redis use</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/realXuJiang/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
