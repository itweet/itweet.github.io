<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="openstack系列(4)-基础环境">




  <meta name="keywords" content="openstack,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2017/05/20/openstack系列(4)-基础环境/">


<meta name="description" content="主要介绍openstack需要依赖的环境和网络配置信息,使用静态IP地址，vmware桥接模式。 一台服务器虚拟4个虚拟机，服务器配置信息如下：  24核心、CPU x5650*2、32G内存、240G SSD，2TB硬盘.  openstack主机配置信息 openstack网络规划配置 openstack主机功能分类:  Linux系统安装及基础优化安装Linux CentOS 7.2系统时，">
<meta name="keywords" content="openstack">
<meta property="og:type" content="article">
<meta property="og:title" content="openstack系列(4)-基础环境">
<meta property="og:url" content="http://itweet.github.io/2017/05/20/openstack系列(4)-基础环境/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="主要介绍openstack需要依赖的环境和网络配置信息,使用静态IP地址，vmware桥接模式。 一台服务器虚拟4个虚拟机，服务器配置信息如下：  24核心、CPU x5650*2、32G内存、240G SSD，2TB硬盘.  openstack主机配置信息 openstack网络规划配置 openstack主机功能分类:  Linux系统安装及基础优化安装Linux CentOS 7.2系统时，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-hardware-configuration-list.png">
<meta property="og:image" content="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-network.png">
<meta property="og:image" content="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-role-list.png">
<meta property="og:updated_time" content="2018-07-02T13:09:15.513Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="openstack系列(4)-基础环境">
<meta name="twitter:description" content="主要介绍openstack需要依赖的环境和网络配置信息,使用静态IP地址，vmware桥接模式。 一台服务器虚拟4个虚拟机，服务器配置信息如下：  24核心、CPU x5650*2、32G内存、240G SSD，2TB硬盘.  openstack主机配置信息 openstack网络规划配置 openstack主机功能分类:  Linux系统安装及基础优化安装Linux CentOS 7.2系统时，">
<meta name="twitter:image" content="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-hardware-configuration-list.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> openstack系列(4)-基础环境 - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          openstack系列(4)-基础环境
        
      </h1>

      <time class="post-time">
          5月 20 2017
      </time>
    </header>



    
            <div class="post-content">
            <p>主要介绍openstack需要依赖的环境和网络配置信息,使用静态IP地址，vmware桥接模式。</p>
<p><em>一台服务器虚拟4个虚拟机，服务器配置信息如下：</em></p>
<ul>
<li>24核心、CPU x5650*2、32G内存、240G SSD，2TB硬盘.</li>
</ul>
<h3 id="openstack主机配置信息"><a href="#openstack主机配置信息" class="headerlink" title="openstack主机配置信息"></a>openstack主机配置信息</h3><p><img src="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-hardware-configuration-list.png" alt="主机配置信息"></p>
<h3 id="openstack网络规划配置"><a href="#openstack网络规划配置" class="headerlink" title="openstack网络规划配置"></a>openstack网络规划配置</h3><p><img src="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-network.png" alt="网络拓扑图"></p>
<p>openstack主机功能分类:</p>
<p><img src="https://github.com/itweet/labs/raw/master/openstack-series/img/openstack-role-list.png" alt="网络拓扑图"></p>
<h3 id="Linux系统安装及基础优化"><a href="#Linux系统安装及基础优化" class="headerlink" title="Linux系统安装及基础优化"></a>Linux系统安装及基础优化</h3><p>安装<code>Linux CentOS 7.2</code>系统时，使用最小化安装，在使用系统过程中，按需安装软件，避免引入带漏洞软件，导致服务器处于危险境地。</p>
<h4 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h4><p>如下所示，你需要修改主机IP地址为静态IP，所有主机都类似修改，所有主机需要修改的地方，如下需要改动的地方就是<code>BOOTPROTO</code>,<code>ONBOOT</code>,<code>IPADDR</code>,<code>NETMASK</code>,<code>GATEWAY</code>,<code>DNS1</code>,<code>DNS2</code>内容，其他保持不变即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr|grep &quot;inet &quot;|grep dynamic</span><br><span class="line">    inet 192.168.2.110/23 brd 192.168.1.255 scope global dynamic eno16777736</span><br><span class="line"></span><br><span class="line">$  vi /etc/sysconfig/network-scripts/ifcfg-eno16777736 </span><br><span class="line">BOOTPROTO=&quot;static&quot;</span><br><span class="line">ONBOOT=&quot;yes&quot;</span><br><span class="line">IPADDR=192.168.2.110</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.2.1</span><br><span class="line">DNS1=114.114.114.114</span><br><span class="line">DNS2=119.29.29.29</span><br></pre></td></tr></table></figure>
<p>重启网卡，让网络配置生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart network.service</span><br></pre></td></tr></table></figure></p>
<p>执行如下命令，检测是否修改已经生效，看到如下信息说明已经配置正确<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr|grep &quot;inet &quot;|grep eno16777736</span><br><span class="line">inet 192.168.2.110/24 brd 192.168.2.255 scope global eno16777736</span><br></pre></td></tr></table></figure></p>
<p>检测是否可以上外网,我们在安装openstack整个过程中，所有节点都必须处于联网状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (61.135.169.125) 56(84) bytes of data.</span><br><span class="line">64 bytes from 61.135.169.125: icmp_seq=1 ttl=52 time=2.39 ms</span><br></pre></td></tr></table></figure></p>
<h4 id="配置hostname"><a href="#配置hostname" class="headerlink" title="配置hostname"></a>配置hostname</h4><p>通过命令修改主机名，其他主机的主机名修改参考如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo hostnamectl set-hostname openstack-controller</span><br><span class="line">$ cat /etc/hostname </span><br><span class="line">openstack-controller</span><br></pre></td></tr></table></figure>
<h4 id="检测Linux版本"><a href="#检测Linux版本" class="headerlink" title="检测Linux版本"></a>检测Linux版本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ hostnamectl status</span><br><span class="line">   Static hostname: openstack-controller</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: f6133ba53e254a81a20c0fd6d5cf4f39</span><br><span class="line">           Boot ID: 96f32a152edc4a20b29a1fa9a2ec891f</span><br><span class="line">    Virtualization: vmware</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-327.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br><span class="line"></span><br><span class="line">$ cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br></pre></td></tr></table></figure>
<h4 id="关闭Selinux"><a href="#关闭Selinux" class="headerlink" title="关闭Selinux"></a>关闭Selinux</h4><p>关闭Selinux自动化shell命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sed -i &apos;s#SELINUX=enforcing#SELINUX=disabled#g&apos; /etc/selinux/config</span><br></pre></td></tr></table></figure></p>
<p>让关闭SELinux立即生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># setenforce 0</span><br></pre></td></tr></table></figure></p>
<p>检测关闭selinux配置,是否修改正确<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># grep SELINUX=disabled /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure></p>
<h4 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status firewalld.service</span><br><span class="line">sudo systemctl stop firewalld.service          </span><br><span class="line">sudo systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>
<h4 id="精简开机启动项"><a href="#精简开机启动项" class="headerlink" title="精简开机启动项"></a>精简开机启动项</h4><p>systemctl可以列出正在运行的服务状态,通过如下命令检测服务启动情况，可以关闭那些不需要的开机自动启动服务。</p>
<ul>
<li>启动一个服务：systemctl start postfix.service</li>
<li>关闭一个服务：systemctl stop postfix.service</li>
<li>重启一个服务：systemctl restart postfix.service</li>
<li>显示一个服务的状态：systemctl status postfix.service</li>
<li>在开机时启用一个服务：systemctl enable postfix.service</li>
<li>在开机时禁用一个服务：systemctl disable postfix.service</li>
<li>查看服务是否开机启动：systemctl is-enabled postfix.service</li>
<li>查看已启动的服务列表：systemctl list-unit-files|grep enabled</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># systemctl list-unit-files|grep enabled</span><br><span class="line">auditd.service                              enabled </span><br><span class="line">... 省略 ...</span><br></pre></td></tr></table></figure>
<h4 id="管理员用户"><a href="#管理员用户" class="headerlink" title="管理员用户"></a>管理员用户</h4><p>添加openstack管理员用户，并赋予相应的sudo权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># useradd openstack</span><br><span class="line"># echo &quot;openstack123&quot;|passwd --stdin openstack</span><br><span class="line"># echo &apos;openstack  ALL=(ALL)       NOPASSWD: ALL&apos; &gt;&gt; /etc/sudoers</span><br></pre></td></tr></table></figure>
<h4 id="修改文件描述符"><a href="#修改文件描述符" class="headerlink" title="修改文件描述符"></a>修改文件描述符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># echo &apos;* - nofile 65535&apos;  &gt;&gt;  /etc/security/limits.conf</span><br></pre></td></tr></table></figure>
<h4 id="配置ntp服务器"><a href="#配置ntp服务器" class="headerlink" title="配置ntp服务器"></a>配置ntp服务器</h4><p>让所有服务器时间保持一致，如果是非内网服务器可以直接安装启动<code>ntp</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># yum install ntp –y</span><br><span class="line"># systemctl start ntpd.service  # 如果同步公网时间，则不需要启动此服务</span><br><span class="line"># systemctl enable ntpd.service # 如果同步公网时间，则不需要设置此服务</span><br><span class="line"># ntpq –p                       # 查询网络中的NTP服务器</span><br><span class="line"># ntpdate time.nist.gov         ＃同步公网时间</span><br></pre></td></tr></table></figure>
<p>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[openstack@openstack-controller ~]$ sudo ntpdate time.nist.gov</span><br><span class="line">    13 Jun 22:22:20 ntpdate[2365]: step time server 216.229.0.179 offset 6.132085 sec</span><br></pre></td></tr></table></figure></p>
<h4 id="配置hosts映射-amp-amp-节点相互能ssh免密码访问"><a href="#配置hosts映射-amp-amp-节点相互能ssh免密码访问" class="headerlink" title="配置hosts映射&amp;&amp;节点相互能ssh免密码访问"></a>配置hosts映射&amp;&amp;节点相互能ssh免密码访问</h4><p>hosts映射配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack-controller ~]# cat /etc/hosts|tail -4</span><br><span class="line">192.168.2.110  openstack-controller</span><br><span class="line">192.168.2.111  openstack-compute-1</span><br><span class="line">192.168.2.112  openstack-compute-2</span><br><span class="line">192.168.2.113  openstack-compute-3</span><br><span class="line"></span><br><span class="line">[root@openstack-controller ~]# scp -r /etc/hosts  openstack-compute-1:/etc/</span><br><span class="line">[root@openstack-controller ~]# scp -r /etc/hosts  openstack-compute-2:/etc/</span><br><span class="line">[root@openstack-controller ~]# scp -r /etc/hosts  openstack-compute-3:/etc/</span><br></pre></td></tr></table></figure></p>
<p>配置ssh免密码登陆</p>
<p>在openstack-controller  &amp;&amp;  openstack-compute-2  &amp;&amp;  openstack-compute-3 执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub openstack-compute-1</span><br></pre></td></tr></table></figure></p>
<p>在 “openstack-compute-1” 节点执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub openstack-compute-1</span><br><span class="line"></span><br><span class="line">scp -r ~/.ssh/authorized_keys openstack-compute-2:~/.ssh/</span><br><span class="line">scp -r ~/.ssh/authorized_keys openstack-compute-3:~/.ssh/</span><br><span class="line">scp -r ~/.ssh/authorized_keys openstack-controller:~/.ssh/</span><br></pre></td></tr></table></figure></p>
<p><code>注意：</code>如果，在安装完openstack集群之后，还需要进行扩容添加节点，那么就不能删除免密码互信登录。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>openstack系列4，重点内容是在安装openstack集群之前的基础环境的准备，如何环境没有准备好，很可能导致安装失败，我们将会在下一节介绍一键部署openstack集群的方法。openstack部署方式多样，我们介绍的是最简单的一种，小白式安装，当然在后续我也会逐一展开说明，帮助大家进一步理解，更容易维护集群。</p>
<p>原创文章，转载请注明： 转载自<a href="http://www.itweet.cn" target="_blank" rel="noopener">Itweet</a>的博客<br><code>本博客的文章集合:</code> <a href="http://www.itweet.cn/blog/archive/" target="_blank" rel="noopener">http://www.itweet.cn/blog/archive/</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/openstack/">openstack</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/05/22/openstack系列(5)-M版_快速部署/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">openstack系列(5)-M版_快速部署</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2017/05/19/openstack系列(3)-架构规划/">
        <span class="next-text nav-default">openstack系列(3)-架构规划</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/realXuJiang/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
