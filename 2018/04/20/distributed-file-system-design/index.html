<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="distributed-file-system-design">




  <meta name="keywords" content="hdfs,">





  <link rel="alternate" href="/atom.xml" title="WHOAMI">




  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/itweet/itweet.github.io/master/favicon.ico?v=1.1">



<link rel="canonical" href="http://itweet.github.io/2018/04/20/distributed-file-system-design/">


<meta name="description" content="忙着开发软件，最近一直没什么时间写作。 今天我们谈一下关于分布式文件系统。 分布式文件系统在一直在存储领域拥有举足轻重的地位，涉及知识也比较多。 主流分布式系统设计，主要分为三个方向： [1] 分布式存储系统  [2] 分布式计算系统  [3] 分布式管理系统 今天我们谈分布式存储系统中我们比较熟悉的非结构化数据存储设计与实现。 谈到分布式文件系统，目前大家比较熟悉的GFS(Google File">
<meta name="keywords" content="hdfs">
<meta property="og:type" content="article">
<meta property="og:title" content="distributed-file-system-design">
<meta property="og:url" content="http://itweet.github.io/2018/04/20/distributed-file-system-design/index.html">
<meta property="og:site_name" content="WHOAMI">
<meta property="og:description" content="忙着开发软件，最近一直没什么时间写作。 今天我们谈一下关于分布式文件系统。 分布式文件系统在一直在存储领域拥有举足轻重的地位，涉及知识也比较多。 主流分布式系统设计，主要分为三个方向： [1] 分布式存储系统  [2] 分布式计算系统  [3] 分布式管理系统 今天我们谈分布式存储系统中我们比较熟悉的非结构化数据存储设计与实现。 谈到分布式文件系统，目前大家比较熟悉的GFS(Google File">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/itweet/labs/raw/master/JDP/dfs/img/gfs_architecture.jpg">
<meta property="og:image" content="https://github.com/itweet/labs/raw/master/common/img/weixin_public.gif">
<meta property="og:updated_time" content="2018-07-02T13:09:15.536Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="distributed-file-system-design">
<meta name="twitter:description" content="忙着开发软件，最近一直没什么时间写作。 今天我们谈一下关于分布式文件系统。 分布式文件系统在一直在存储领域拥有举足轻重的地位，涉及知识也比较多。 主流分布式系统设计，主要分为三个方向： [1] 分布式存储系统  [2] 分布式计算系统  [3] 分布式管理系统 今天我们谈分布式存储系统中我们比较熟悉的非结构化数据存储设计与实现。 谈到分布式文件系统，目前大家比较熟悉的GFS(Google File">
<meta name="twitter:image" content="https://github.com/itweet/labs/raw/master/JDP/dfs/img/gfs_architecture.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> distributed-file-system-design - WHOAMI </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WHOAMI</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          distributed-file-system-design
        
      </h1>

      <time class="post-time">
          4月 20 2018
      </time>
    </header>



    
            <div class="post-content">
            <p>忙着开发软件，最近一直没什么时间写作。</p>
<p>今天我们谈一下关于分布式文件系统。</p>
<p>分布式文件系统在一直在存储领域拥有举足轻重的地位，涉及知识也比较多。</p>
<p>主流分布式系统设计，主要分为三个方向：</p>
<p>[1] 分布式存储系统 </p>
<p>[2] 分布式计算系统 </p>
<p>[3] 分布式管理系统</p>
<p>今天我们谈<code>分布式存储系统</code>中我们比较熟悉的<code>非结构化数据存储</code>设计与实现。</p>
<p>谈到分布式文件系统，目前大家比较熟悉的GFS(Google File System)或者GFS开源实现HDFS。</p>
<p>目前在国内已经家喻户晓，稍微大一点的公司都在使用HDFS，可以说HDFS是大数据系统的基石。</p>
<p>Hadoop 3.1版本发布，增加对各种云端存储系统的支持，设计很有意思，以后内容会介绍。</p>
<h2 id="非结构化数据存储"><a href="#非结构化数据存储" class="headerlink" title="非结构化数据存储"></a>非结构化数据存储</h2><p>GFS是开发出来存储Google海量的日志数据，网页，文档等文本信息，并且对其进行批处理，比如：配合 mapreduce 为文档建立倒排索引，计算网页 PageRank。</p>
<p>设计初衷，为了支持更大规模数据处理和很高的合计吞吐量，拥有很强的扩展性，可容纳那么大了的非结构化数据。</p>
<p>因为数据分布式存储，需要大量取数据计算，必须支持很强的容错性，设计之初贴近实际生产，组合一堆普通机器形成集群，提供强大的存储能力，大量机器配合工作，系统故障和硬件故障被认为是常态。</p>
<p>GFS很好地解决了，大文件，大规模顺序数据追加写，提供很高的合计吞吐量。</p>
<p>GFS，HDFS一类的分布式文件系统，非常适合数据一旦写入，文件很少修改的场景。这样的设计导致几乎无法支持随机访问（random access）操作，面对低延迟、实时性要求高的场景不适合。</p>
<p>GFS分布式文件系统，并非标准的Posix标准实现，GFS主要提供快照和记录追加操作，多路结果合并。</p>
<ul>
<li>GFS架构</li>
</ul>
<p>使用Master-&gt;Slave设计，元数据信息主要由Master管理，这样的设计大大降低系统的实现难度。</p>
<p><img src="https://github.com/itweet/labs/raw/master/JDP/dfs/img/gfs_architecture.jpg" alt></p>
<p>为防止Master压力过大，限制了数据存储大量，GFS中数据存储单元使用Chunk表示，Chunk支持64M。</p>
<p>Master节点掌握整个集群数据存储核心数据，集群扩展能力受限于master节点内存，比如：大量小文件导致元数据信息爆满。</p>
<p>分布式文件系统多副本，可支持容错的读取数据，根据负载情况，最近副本取数据。</p>
<p>因为集群支持容错，故障自动恢复，所以整个集群可以扩展到很大规模，在传统MPI、MPP中无法支持很大规模。</p>
<p>而今天我们也看到MPP和支持超大规模分布式文件系统融合的案例，使得MPP计算层可扩展到更大规模。</p>
<ul>
<li>热点数据</li>
</ul>
<p>分布式文件系统，热点数据，导致系统局部过载而出现严重故障？</p>
<p>在分布式非结构化数据存储中，是非常常见的，比如我们某个公共库文件或程序，为使用方便和容错，大家把它存储在HDFS，它被切块存储于100个节点的集群某3个机器中，由于大量业务系统或者程序随机加载引用，导致某3个机器压力特别大，看到监控系统飘红。</p>
<p>我们可以通过增加副本数量，来让更多副本能提供访问服务，解决问题。</p>
<p>早期使用MapReduce/Spark系统，为缩短计算时间，默认3副本，我们提高到6，9个，增加数据本地化计算的几率。</p>
<ul>
<li>元数据</li>
</ul>
<p>集群扩展Slave受限于Master节点内容，元数据信息都存在Master，并且常驻内存，大量小文件也会造成Master性能下降。</p>
<ul>
<li>操作日志</li>
</ul>
<p>操作日志的作用</p>
<p>[1] 持久化存储metadata</p>
<p>[2] 存储完整的操作命令，保障最终的操作顺序</p>
<p>元数据信息的变更，全都是通过日志记录来实现的，通过日志复制到多个节点，保障可靠性，即使主节点损坏，也可恢复其他节点为主节点，继续提供服务。日志可复现任何一个时间点的操作行为，保障系统数据。</p>
<ul>
<li>Check point</li>
</ul>
<p>当operation log达到一定大小时，GFS master会做checkpoint，相当于把内存的B-Tree格式的信息dump到磁盘中。当master需要重启时，可以读最近一次的checkpoint，然后replay它之后的operation log，加快恢复的时间。</p>
<p>做checkpoint的时候，GFS master会先切换到新的operation log，然后开新线程做checkpoint，所以，对新来的请求是基本是不会有影响的。</p>
<p>状态数据，底层主要使用高度压缩的B-Tree存储。</p>
<ul>
<li>快照</li>
</ul>
<p>使用copy-on-writer实现，基本上不会对现有数据读取有影响。</p>
<h2 id="只读数据存储"><a href="#只读数据存储" class="headerlink" title="只读数据存储"></a>只读数据存储</h2><p>[1] 适合追加方式的写入和读取操作</p>
<p>[2] 很少有随机写入操作</p>
<p>目前HDFS，GFS主要用来存储海量的离线数据，提供海量非结构化数据存储场景。</p>
<p>如果需要支持随机写、更新、删除数据，就选其他系统，比如：Kudu</p>
<h2 id="冗余解决方案"><a href="#冗余解决方案" class="headerlink" title="冗余解决方案"></a>冗余解决方案</h2><p>容错考虑需要，有三倍冗余，目前主要有Erasure Codes实现，奇偶校验方法，可以缩小大量存储占用。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>[1] 没有在文件系层面提供任何的Cache机制，访问顺序读取加载大量文件，Cache支持意义不大</p>
<p>[2] 单个应用执行时机会不会重复读取数据</p>
<p>[3] GFS/HDFS适合流式读取一个大型数据集</p>
<p>[4] 在大型数据集中随机seek到某个位置，之后每次读取少量数据，提升效率。</p>
<p>[5] GFS/HDFS设计预期是使用大量的不可靠节点组件集群，因此，灾难冗余是此类系统设计的核心。</p>
<p>[6] 存储固定大小的Chunk，容易重新均衡数据。</p>
<p>[7] 原子记录追加，保障系统数据一致性。</p>
<p>[8] 中心Master设计，让复杂的分布式系统实现简单化，不用考虑数据一致性，元数据同步问题。</p>
<p>GFS/HDFS设计初衷，保障有大量并发读写操作时，能够提供很高的合计吞吐量。</p>
<p>通过分离控制流(Master)和数据流(Chunk client)来实现，所以我们经常提起的Edge节点会对整个系统性能有很大的影响。</p>
<p>Master节点负载过高，通过Chunk租约将控制权交给主副本(主Chunk)，将Master压力降到最低。</p>
<p>目前类似GFS的开源实现，主流选择HDFS，而且HDFS在实现上，弥补很多GFS中的不足。我也没看到有可替代HDFS的系统，因为有HDFS造就今天繁荣的Hadoop生态系统，数据分析引擎、数据存储引擎百花齐放。</p>
<p>软件系统的设计与实现是为解决现实问题而出现，设计上会有很多权衡，不同的权衡造就不同的系统，各自有擅长的场景。</p>
<p>欢迎关注微信公众号[Whoami]，阅读更多内容。<br><img src="https://github.com/itweet/labs/raw/master/common/img/weixin_public.gif" alt="Whoami公众号"></p>
<p>原创文章，转载请注明： 转载自<a href="http://www.itweet.cn" target="_blank" rel="noopener">Itweet</a>的博客<br><code>本博客的文章集合:</code> <a href="http://www.itweet.cn/blog/archive" target="_blank" rel="noopener">http://www.itweet.cn/blog/archive</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/hdfs/">hdfs</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/04/23/mapreduce-osdi04/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">mapreduce-osdi04</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2018/04/19/Minimalism-Live-a-Meaningful-Life/">
        <span class="next-text nav-default">Minimalism-Live-a-Meaningful-Life</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">Xu Jiang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
